{"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/ServerContext.ts":{"path":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/ServerContext.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":23}},"2":{"start":{"line":5,"column":0},"end":{"line":10,"column":50}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":44}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":48}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":56}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":50}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":18},"end":{"line":10,"column":1}},"line":5}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":11},"end":{"line":10,"column":48}},"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":24}},{"start":{"line":10,"column":29},"end":{"line":10,"column":47}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1},"f":{"0":1},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"file":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/ServerContext.ts","sources":["/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/ServerContext.ts"],"names":[],"mappings":";;;AAIA,IAAY,KAKX;AALD,WAAY,KAAK;IACf,uCAAO,CAAA,CAAC,uDAAuD;IAC/D,2CAAS,CAAA,CAAC,sCAAsC;IAChD,mDAAa,CAAA,CAAC,0CAA0C;IACxD,6CAAU,CAAA,CAAC,wCAAwC;AACrD,CAAC,EALW,KAAK,GAAL,aAAK,KAAL,aAAK,QAKhB","sourcesContent":["import { AppIdentifier, AppIntent } from '@finos/fdc3-standard';\nimport { Context } from '@finos/fdc3-context';\nimport { FDC3Server } from './FDC3Server';\n\nexport enum State {\n  Pending /* App has started, but not completed FDC3 Handshake */,\n  Connected /* App has completed FDC3 handshake */,\n  NotResponding /* App has not responded to a heartbeat */,\n  Terminated /* App has sent a termination message */,\n}\n\nexport type AppRegistration = {\n  state: State;\n  appId: string;\n  instanceId: InstanceID;\n};\n\n/**\n * This is a unique, long, unguessable string that identifies a particular instance of an app.\n * All messages arriving at the desktop agent will have this UUID attached to them.\n * It is important that this is unguessable as it is a shared secret used to identify the app\n * when reconnecting after navigation or refresh.\n */\nexport type InstanceID = string;\n\n/**\n * Handles messaging to apps and opening apps\n */\nexport interface ServerContext<X extends AppRegistration> {\n  /**\n   * UUID for outgoing message\n   */\n  createUUID(): string;\n\n  /**\n   * Post an outgoing message to a particular app\n   */\n  post(message: object, instanceId: InstanceID): Promise<void>;\n\n  /**\n   * Opens a new instance of an application.\n   * Promise completes once the application window is opened\n   */\n  open(appId: string): Promise<InstanceID>;\n\n  /** Set the FDC3Server instance associated with this context. This reference is\n   *  used to notify the server to cleanup state for apps that have been terminated.\n   *  The FDC3Server is passed a ServerContext when created and should call this fn\n   *  in its constructor.\n   */\n  setFDC3Server(server: FDC3Server): void;\n\n  /**\n   * Registers a particular instance id with a given app id\n   */\n  setInstanceDetails(uuid: InstanceID, details: X): void;\n\n  /**\n   * Returns the connection details for a particular instance of an app.\n   * Used in a variety of MessageHandler classes to retrieve details for\n   * an app and when validating an app's identity when connecting.\n   */\n  getInstanceDetails(uuid: InstanceID): X | undefined;\n\n  /**\n   * Registers an app as connected to the desktop agent.\n   */\n  setAppState(app: InstanceID, state: State): Promise<void>;\n\n  /**\n   * Returns the list of apps open and connected to FDC3 at the current time.\n   * Note, it is the implementor's job to ensure this list is\n   * up-to-date in the event of app crashes or disconnections.\n   */\n  getConnectedApps(): Promise<AppRegistration[]>;\n\n  /**\n   * Return the list of all apps that have ever been registered with the ServerContext.\n   */\n  getAllApps(): Promise<AppRegistration[]>;\n\n  /**\n   * Helper function for determining if an app is currently open and connected to the da\n   */\n  isAppConnected(app: InstanceID): Promise<boolean>;\n\n  /**\n   * Allows you to write a log message somewhere\n   */\n  log(message: string): void;\n\n  /**\n   * Name of the provider of this desktop agent server\n   */\n  provider(): string;\n\n  /**\n   * Version of the provider of this desktop agent server\n   */\n  providerVersion(): string;\n\n  /**\n   * Supported version of the FDC3 API of the desktop agent server.\n   */\n  fdc3Version(): string;\n\n  /**\n   * This is called prior to returning intents to the client.  It is a\n   * an opportunity for the server to either present an intent resolver\n   * or otherwise mess with the available intents, or do nothing.\n   */\n  narrowIntents(raiser: AppIdentifier, IappIntents: AppIntent[], context: Context): Promise<AppIntent[]>;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b07858e0beaf503407efdf6f6238b5a21c410f47","contentHash":"9bbed1bdc190ea520d823c6f6f39e74207bbc994b8a49d27f8bf30297ce1cb75"},"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/BasicFDC3Server.ts":{"path":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/BasicFDC3Server.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":61}},"2":{"start":{"line":4,"column":24},"end":{"line":4,"column":50}},"3":{"start":{"line":5,"column":27},"end":{"line":5,"column":65}},"4":{"start":{"line":6,"column":24},"end":{"line":6,"column":59}},"5":{"start":{"line":7,"column":22},"end":{"line":7,"column":55}},"6":{"start":{"line":8,"column":27},"end":{"line":8,"column":65}},"7":{"start":{"line":16,"column":8},"end":{"line":16,"column":33}},"8":{"start":{"line":17,"column":8},"end":{"line":17,"column":21}},"9":{"start":{"line":20,"column":8},"end":{"line":20,"column":79}},"10":{"start":{"line":20,"column":41},"end":{"line":20,"column":77}},"11":{"start":{"line":21,"column":8},"end":{"line":21,"column":74}},"12":{"start":{"line":24,"column":25},"end":{"line":24,"column":81}},"13":{"start":{"line":24,"column":48},"end":{"line":24,"column":80}},"14":{"start":{"line":25,"column":8},"end":{"line":25,"column":43}},"15":{"start":{"line":28,"column":8},"end":{"line":28,"column":49}},"16":{"start":{"line":28,"column":35},"end":{"line":28,"column":47}},"17":{"start":{"line":31,"column":0},"end":{"line":31,"column":42}},"18":{"start":{"line":34,"column":25},"end":{"line":38,"column":9}},"19":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"20":{"start":{"line":40,"column":12},"end":{"line":40,"column":142}},"21":{"start":{"line":42,"column":8},"end":{"line":42,"column":28}},"22":{"start":{"line":45,"column":0},"end":{"line":45,"column":46}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":30},"end":{"line":18,"column":5}},"line":15},"1":{"name":"(anonymous_1)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":24},"end":{"line":22,"column":5}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":20,"column":30},"end":{"line":20,"column":31}},"loc":{"start":{"line":20,"column":41},"end":{"line":20,"column":77}},"line":20},"3":{"name":"(anonymous_3)","decl":{"start":{"line":23,"column":4},"end":{"line":23,"column":5}},"loc":{"start":{"line":23,"column":33},"end":{"line":26,"column":5}},"line":23},"4":{"name":"(anonymous_4)","decl":{"start":{"line":24,"column":43},"end":{"line":24,"column":44}},"loc":{"start":{"line":24,"column":48},"end":{"line":24,"column":80}},"line":24},"5":{"name":"(anonymous_5)","decl":{"start":{"line":27,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":27,"column":15},"end":{"line":29,"column":5}},"line":27},"6":{"name":"(anonymous_6)","decl":{"start":{"line":28,"column":30},"end":{"line":28,"column":31}},"loc":{"start":{"line":28,"column":35},"end":{"line":28,"column":47}},"line":28},"7":{"name":"(anonymous_7)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":112},"end":{"line":43,"column":5}},"line":33}},"branchMap":{"0":{"loc":{"start":{"line":33,"column":57},"end":{"line":33,"column":80}},"type":"default-arg","locations":[{"start":{"line":33,"column":75},"end":{"line":33,"column":80}}],"line":33},"1":{"loc":{"start":{"line":33,"column":82},"end":{"line":33,"column":110}},"type":"default-arg","locations":[{"start":{"line":33,"column":105},"end":{"line":33,"column":110}}],"line":33},"2":{"loc":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"type":"if","locations":[{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},{"start":{},"end":{}}],"line":39}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":176,"8":176,"9":6,"10":18,"11":6,"12":260,"13":789,"14":260,"15":3,"16":12,"17":1,"18":176,"19":176,"20":3,"21":176,"22":1},"f":{"0":176,"1":6,"2":18,"3":260,"4":789,"5":3,"6":12,"7":176},"b":{"0":[88],"1":[88],"2":[3,173]},"inputSourceMap":{"version":3,"file":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/BasicFDC3Server.ts","sources":["/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/BasicFDC3Server.ts"],"names":[],"mappings":";;;AACA,mDAAoF;AACpF,kEAA6E;AAC7E,4DAAyD;AAEzD,wDAAqD;AACrD,kEAA+D;AA2B/D;;GAEG;AACH,MAAa,eAAe;IACjB,QAAQ,CAAmB;IAC5B,EAAE,CAAiC;IAE3C,YAAY,QAA0B,EAAE,EAAkC;QACxE,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;IACf,CAAC;IAED,OAAO,CAAC,UAAsB;QAC5B,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;QACvE,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,UAAU,EAAE,qBAAK,CAAC,UAAU,CAAC,CAAC;IACpD,CAAC;IAED,KAAK,CAAC,OAAO,CACX,OAAsG,EACtG,IAAgB;QAEhB,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,CAAC;QAC1E,MAAM,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;IACrC,CAAC;IAED,QAAQ;QACN,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC3C,CAAC;CACF;AAzBD,0CAyBC;AAED,MAAa,iBAAkB,SAAQ,eAAe;IACpD,YACE,EAAkC,EAClC,SAAoB,EACpB,YAA4B,EAC5B,UAAmB,EACnB,kBAA0B,KAAK,EAC/B,uBAA+B,KAAK;QAEpC,MAAM,QAAQ,GAAqB;YACjC,IAAI,mCAAgB,CAAC,YAAY,CAAC;YAClC,IAAI,6BAAa,CAAC,SAAS,EAAE,eAAe,CAAC;YAC7C,IAAI,yBAAW,CAAC,SAAS,EAAE,oBAAoB,CAAC;SACjD,CAAC;QAEF,IAAI,UAAU,EAAE;YACd,QAAQ,CAAC,IAAI,CAAC,IAAI,mCAAgB,CAAC,oBAAoB,GAAG,EAAE,EAAE,oBAAoB,GAAG,CAAC,EAAE,oBAAoB,CAAC,CAAC,CAAC;SAChH;QAED,KAAK,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;IACtB,CAAC;CACF;AArBD,8CAqBC","sourcesContent":["import { FDC3Server } from './FDC3Server';\nimport { AppRegistration, InstanceID, ServerContext, State } from './ServerContext';\nimport { BroadcastHandler, ChannelState } from './handlers/BroadcastHandler';\nimport { IntentHandler } from './handlers/IntentHandler';\nimport { Directory } from './directory/DirectoryInterface';\nimport { OpenHandler } from './handlers/OpenHandler';\nimport { HeartbeatHandler } from './handlers/HeartbeatHandler';\nimport {\n  AppRequestMessage,\n  WebConnectionProtocol4ValidateAppIdentity,\n  WebConnectionProtocol6Goodbye,\n} from '@finos/fdc3-schema/dist/generated/api/BrowserTypes';\n\nexport interface MessageHandler {\n  /**\n   * Handles an AgentRequestMessage from the messaging source. This function\n   * is called by BasicFDC3Server on every message received and should only\n   * process those it supports.\n   */\n  accept(\n    msg: AppRequestMessage | WebConnectionProtocol4ValidateAppIdentity | WebConnectionProtocol6Goodbye,\n    sc: ServerContext<AppRegistration>,\n    from: InstanceID\n  ): Promise<void>;\n\n  /**\n   * Clean-up any state relating to a instance that has disconnected.\n   */\n  cleanup(instanceId: InstanceID, sc: ServerContext<AppRegistration>): void;\n\n  shutdown(): void;\n}\n\n/**\n * This defers all functionality to either MessageHandler's or the ServerContext objects.\n */\nexport class BasicFDC3Server implements FDC3Server {\n  readonly handlers: MessageHandler[];\n  private sc: ServerContext<AppRegistration>;\n\n  constructor(handlers: MessageHandler[], sc: ServerContext<AppRegistration>) {\n    this.handlers = handlers;\n    this.sc = sc;\n  }\n\n  cleanup(instanceId: InstanceID): void {\n    this.handlers.forEach(handler => handler.cleanup(instanceId, this.sc));\n    this.sc.setAppState(instanceId, State.Terminated);\n  }\n\n  async receive(\n    message: AppRequestMessage | WebConnectionProtocol4ValidateAppIdentity | WebConnectionProtocol6Goodbye,\n    from: InstanceID\n  ): Promise<void> {\n    const promises = this.handlers.map(h => h.accept(message, this.sc, from));\n    await Promise.allSettled(promises);\n  }\n\n  shutdown(): void {\n    this.handlers.forEach(h => h.shutdown());\n  }\n}\n\nexport class DefaultFDC3Server extends BasicFDC3Server {\n  constructor(\n    sc: ServerContext<AppRegistration>,\n    directory: Directory,\n    userChannels: ChannelState[],\n    heartbeats: boolean,\n    intentTimeoutMs: number = 20000,\n    openHandlerTimeoutMs: number = 10000\n  ) {\n    const handlers: MessageHandler[] = [\n      new BroadcastHandler(userChannels),\n      new IntentHandler(directory, intentTimeoutMs),\n      new OpenHandler(directory, openHandlerTimeoutMs),\n    ];\n\n    if (heartbeats) {\n      handlers.push(new HeartbeatHandler(openHandlerTimeoutMs / 10, openHandlerTimeoutMs / 2, openHandlerTimeoutMs));\n    }\n\n    super(handlers, sc);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"28e749dbe14a4f9c70856c10acddd972d4db7fb1","contentHash":"747c9c81719fdff6dca5aca8ad52d588bfc9547d35a7c73d99ced1df171e2fff"},"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/BroadcastHandler.ts":{"path":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/BroadcastHandler.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":56}},"2":{"start":{"line":4,"column":24},"end":{"line":4,"column":55}},"3":{"start":{"line":5,"column":18},"end":{"line":5,"column":38}},"4":{"start":{"line":7,"column":0},"end":{"line":11,"column":68}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":50}},"6":{"start":{"line":9,"column":4},"end":{"line":9,"column":48}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":56}},"8":{"start":{"line":13,"column":23},"end":{"line":13,"column":25}},"9":{"start":{"line":14,"column":35},"end":{"line":14,"column":37}},"10":{"start":{"line":15,"column":33},"end":{"line":15,"column":35}},"11":{"start":{"line":16,"column":12},"end":{"line":16,"column":14}},"12":{"start":{"line":17,"column":21},"end":{"line":17,"column":23}},"13":{"start":{"line":19,"column":8},"end":{"line":19,"column":41}},"14":{"start":{"line":23,"column":30},"end":{"line":23,"column":91}},"15":{"start":{"line":23,"column":64},"end":{"line":23,"column":90}},"16":{"start":{"line":25,"column":45},"end":{"line":25,"column":148}},"17":{"start":{"line":25,"column":71},"end":{"line":25,"column":147}},"18":{"start":{"line":25,"column":95},"end":{"line":25,"column":117}},"19":{"start":{"line":26,"column":44},"end":{"line":26,"column":53}},"20":{"start":{"line":27,"column":8},"end":{"line":32,"column":11}},"21":{"start":{"line":28,"column":12},"end":{"line":28,"column":148}},"22":{"start":{"line":29,"column":12},"end":{"line":31,"column":13}},"23":{"start":{"line":30,"column":16},"end":{"line":30,"column":61}},"24":{"start":{"line":33,"column":8},"end":{"line":35,"column":11}},"25":{"start":{"line":34,"column":12},"end":{"line":34,"column":111}},"26":{"start":{"line":37,"column":8},"end":{"line":37,"column":109}},"27":{"start":{"line":37,"column":73},"end":{"line":37,"column":107}},"28":{"start":{"line":38,"column":8},"end":{"line":38,"column":133}},"29":{"start":{"line":38,"column":97},"end":{"line":38,"column":131}},"30":{"start":{"line":39,"column":8},"end":{"line":39,"column":129}},"31":{"start":{"line":39,"column":93},"end":{"line":39,"column":127}},"32":{"start":{"line":42,"column":8},"end":{"line":42,"column":52}},"33":{"start":{"line":45,"column":22},"end":{"line":54,"column":9}},"34":{"start":{"line":55,"column":8},"end":{"line":55,"column":35}},"35":{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},"36":{"start":{"line":59,"column":12},"end":{"line":59,"column":24}},"37":{"start":{"line":61,"column":8},"end":{"line":61,"column":56}},"38":{"start":{"line":61,"column":36},"end":{"line":61,"column":46}},"39":{"start":{"line":64,"column":22},"end":{"line":73,"column":9}},"40":{"start":{"line":74,"column":8},"end":{"line":74,"column":35}},"41":{"start":{"line":77,"column":8},"end":{"line":84,"column":9}},"42":{"start":{"line":79,"column":16},"end":{"line":79,"column":29}},"43":{"start":{"line":81,"column":16},"end":{"line":81,"column":30}},"44":{"start":{"line":83,"column":16},"end":{"line":83,"column":33}},"45":{"start":{"line":87,"column":8},"end":{"line":87,"column":83}},"46":{"start":{"line":87,"column":49},"end":{"line":87,"column":81}},"47":{"start":{"line":90,"column":8},"end":{"line":94,"column":11}},"48":{"start":{"line":91,"column":25},"end":{"line":91,"column":46}},"49":{"start":{"line":93,"column":12},"end":{"line":93,"column":36}},"50":{"start":{"line":97,"column":19},"end":{"line":97,"column":49}},"51":{"start":{"line":98,"column":8},"end":{"line":101,"column":9}},"52":{"start":{"line":99,"column":12},"end":{"line":99,"column":72}},"53":{"start":{"line":99,"column":48},"end":{"line":99,"column":70}},"54":{"start":{"line":100,"column":12},"end":{"line":100,"column":40}},"55":{"start":{"line":104,"column":21},"end":{"line":104,"column":48}},"56":{"start":{"line":105,"column":8},"end":{"line":108,"column":9}},"57":{"start":{"line":107,"column":12},"end":{"line":107,"column":19}},"58":{"start":{"line":109,"column":8},"end":{"line":154,"column":9}},"59":{"start":{"line":110,"column":12},"end":{"line":149,"column":13}},"60":{"start":{"line":113,"column":20},"end":{"line":113,"column":72}},"61":{"start":{"line":116,"column":20},"end":{"line":116,"column":76}},"62":{"start":{"line":118,"column":20},"end":{"line":118,"column":80}},"63":{"start":{"line":120,"column":20},"end":{"line":120,"column":76}},"64":{"start":{"line":122,"column":20},"end":{"line":122,"column":78}},"65":{"start":{"line":125,"column":20},"end":{"line":125,"column":70}},"66":{"start":{"line":128,"column":20},"end":{"line":128,"column":79}},"67":{"start":{"line":130,"column":20},"end":{"line":130,"column":87}},"68":{"start":{"line":133,"column":20},"end":{"line":133,"column":81}},"69":{"start":{"line":135,"column":20},"end":{"line":135,"column":85}},"70":{"start":{"line":138,"column":20},"end":{"line":138,"column":91}},"71":{"start":{"line":140,"column":20},"end":{"line":140,"column":99}},"72":{"start":{"line":143,"column":20},"end":{"line":143,"column":78}},"73":{"start":{"line":146,"column":20},"end":{"line":146,"column":77}},"74":{"start":{"line":148,"column":20},"end":{"line":148,"column":85}},"75":{"start":{"line":152,"column":33},"end":{"line":152,"column":85}},"76":{"start":{"line":153,"column":12},"end":{"line":153,"column":86}},"77":{"start":{"line":157,"column":19},"end":{"line":162,"column":9}},"78":{"start":{"line":163,"column":8},"end":{"line":163,"column":49}},"79":{"start":{"line":164,"column":8},"end":{"line":164,"column":118}},"80":{"start":{"line":167,"column":18},"end":{"line":167,"column":109}},"81":{"start":{"line":167,"column":65},"end":{"line":167,"column":108}},"82":{"start":{"line":168,"column":8},"end":{"line":174,"column":9}},"83":{"start":{"line":169,"column":12},"end":{"line":169,"column":57}},"84":{"start":{"line":170,"column":12},"end":{"line":170,"column":99}},"85":{"start":{"line":173,"column":12},"end":{"line":173,"column":113}},"86":{"start":{"line":177,"column":19},"end":{"line":177,"column":34}},"87":{"start":{"line":178,"column":8},"end":{"line":183,"column":11}},"88":{"start":{"line":184,"column":8},"end":{"line":184,"column":175}},"89":{"start":{"line":187,"column":24},"end":{"line":187,"column":67}},"90":{"start":{"line":188,"column":21},"end":{"line":188,"column":45}},"91":{"start":{"line":189,"column":8},"end":{"line":195,"column":9}},"92":{"start":{"line":190,"column":28},"end":{"line":190,"column":117}},"93":{"start":{"line":190,"column":62},"end":{"line":190,"column":76}},"94":{"start":{"line":191,"column":12},"end":{"line":191,"column":110}},"95":{"start":{"line":194,"column":12},"end":{"line":194,"column":131}},"96":{"start":{"line":198,"column":18},"end":{"line":198,"column":111}},"97":{"start":{"line":198,"column":67},"end":{"line":198,"column":110}},"98":{"start":{"line":199,"column":8},"end":{"line":205,"column":9}},"99":{"start":{"line":200,"column":12},"end":{"line":200,"column":59}},"100":{"start":{"line":201,"column":12},"end":{"line":201,"column":113}},"101":{"start":{"line":204,"column":12},"end":{"line":204,"column":127}},"102":{"start":{"line":208,"column":30},"end":{"line":210,"column":63}},"103":{"start":{"line":209,"column":25},"end":{"line":209,"column":81}},"104":{"start":{"line":210,"column":25},"end":{"line":210,"column":62}},"105":{"start":{"line":211,"column":8},"end":{"line":213,"column":11}},"106":{"start":{"line":212,"column":12},"end":{"line":212,"column":159}},"107":{"start":{"line":214,"column":8},"end":{"line":214,"column":94}},"108":{"start":{"line":214,"column":66},"end":{"line":214,"column":92}},"109":{"start":{"line":215,"column":8},"end":{"line":215,"column":125}},"110":{"start":{"line":216,"column":8},"end":{"line":216,"column":95}},"111":{"start":{"line":219,"column":18},"end":{"line":219,"column":134}},"112":{"start":{"line":219,"column":55},"end":{"line":219,"column":133}},"113":{"start":{"line":220,"column":8},"end":{"line":229,"column":9}},"114":{"start":{"line":221,"column":23},"end":{"line":221,"column":47}},"115":{"start":{"line":222,"column":28},"end":{"line":222,"column":61}},"116":{"start":{"line":223,"column":12},"end":{"line":223,"column":157}},"117":{"start":{"line":224,"column":12},"end":{"line":224,"column":47}},"118":{"start":{"line":225,"column":12},"end":{"line":225,"column":101}},"119":{"start":{"line":228,"column":12},"end":{"line":228,"column":115}},"120":{"start":{"line":232,"column":24},"end":{"line":232,"column":28}},"121":{"start":{"line":233,"column":26},"end":{"line":233,"column":42}},"122":{"start":{"line":234,"column":8},"end":{"line":244,"column":9}},"123":{"start":{"line":235,"column":28},"end":{"line":235,"column":72}},"124":{"start":{"line":236,"column":12},"end":{"line":236,"column":60}},"125":{"start":{"line":237,"column":12},"end":{"line":243,"column":13}},"126":{"start":{"line":238,"column":16},"end":{"line":238,"column":136}},"127":{"start":{"line":239,"column":16},"end":{"line":239,"column":23}},"128":{"start":{"line":242,"column":16},"end":{"line":242,"column":39}},"129":{"start":{"line":245,"column":19},"end":{"line":252,"column":9}},"130":{"start":{"line":253,"column":8},"end":{"line":253,"column":39}},"131":{"start":{"line":254,"column":8},"end":{"line":254,"column":167}},"132":{"start":{"line":255,"column":8},"end":{"line":255,"column":120}},"133":{"start":{"line":258,"column":34},"end":{"line":260,"column":93}},"134":{"start":{"line":259,"column":25},"end":{"line":259,"column":62}},"135":{"start":{"line":260,"column":25},"end":{"line":260,"column":92}},"136":{"start":{"line":261,"column":29},"end":{"line":265,"column":41}},"137":{"start":{"line":263,"column":12},"end":{"line":263,"column":64}},"138":{"start":{"line":266,"column":8},"end":{"line":278,"column":11}},"139":{"start":{"line":267,"column":12},"end":{"line":277,"column":31}},"140":{"start":{"line":279,"column":8},"end":{"line":279,"column":78}},"141":{"start":{"line":280,"column":8},"end":{"line":280,"column":80}},"142":{"start":{"line":283,"column":31},"end":{"line":283,"column":59}},"143":{"start":{"line":284,"column":8},"end":{"line":295,"column":9}},"144":{"start":{"line":285,"column":12},"end":{"line":291,"column":44}},"145":{"start":{"line":294,"column":12},"end":{"line":294,"column":107}},"146":{"start":{"line":299,"column":27},"end":{"line":299,"column":70}},"147":{"start":{"line":300,"column":8},"end":{"line":302,"column":9}},"148":{"start":{"line":301,"column":12},"end":{"line":301,"column":136}},"149":{"start":{"line":304,"column":27},"end":{"line":304,"column":62}},"150":{"start":{"line":305,"column":8},"end":{"line":305,"column":53}},"151":{"start":{"line":306,"column":8},"end":{"line":306,"column":59}},"152":{"start":{"line":307,"column":8},"end":{"line":307,"column":69}},"153":{"start":{"line":308,"column":8},"end":{"line":308,"column":86}},"154":{"start":{"line":311,"column":27},"end":{"line":311,"column":62}},"155":{"start":{"line":312,"column":31},"end":{"line":312,"column":62}},"156":{"start":{"line":313,"column":8},"end":{"line":316,"column":9}},"157":{"start":{"line":314,"column":12},"end":{"line":314,"column":51}},"158":{"start":{"line":315,"column":12},"end":{"line":315,"column":54}},"159":{"start":{"line":317,"column":8},"end":{"line":317,"column":59}},"160":{"start":{"line":318,"column":8},"end":{"line":318,"column":90}},"161":{"start":{"line":321,"column":19},"end":{"line":321,"column":41}},"162":{"start":{"line":322,"column":22},"end":{"line":322,"column":45}},"163":{"start":{"line":323,"column":8},"end":{"line":331,"column":9}},"164":{"start":{"line":324,"column":12},"end":{"line":329,"column":14}},"165":{"start":{"line":330,"column":12},"end":{"line":330,"column":37}},"166":{"start":{"line":332,"column":8},"end":{"line":337,"column":9}},"167":{"start":{"line":333,"column":12},"end":{"line":333,"column":130}},"168":{"start":{"line":336,"column":12},"end":{"line":336,"column":142}},"169":{"start":{"line":340,"column":29},"end":{"line":340,"column":79}},"170":{"start":{"line":340,"column":52},"end":{"line":340,"column":78}},"171":{"start":{"line":341,"column":8},"end":{"line":347,"column":38}},"172":{"start":{"line":342,"column":49},"end":{"line":346,"column":13}},"173":{"start":{"line":350,"column":24},"end":{"line":350,"column":74}},"174":{"start":{"line":351,"column":8},"end":{"line":364,"column":9}},"175":{"start":{"line":352,"column":12},"end":{"line":352,"column":144}},"176":{"start":{"line":355,"column":23},"end":{"line":361,"column":13}},"177":{"start":{"line":362,"column":12},"end":{"line":362,"column":55}},"178":{"start":{"line":363,"column":12},"end":{"line":363,"column":136}},"179":{"start":{"line":367,"column":8},"end":{"line":386,"column":9}},"180":{"start":{"line":368,"column":24},"end":{"line":378,"column":13}},"181":{"start":{"line":379,"column":12},"end":{"line":379,"column":73}},"182":{"start":{"line":380,"column":12},"end":{"line":385,"column":15}},"183":{"start":{"line":381,"column":36},"end":{"line":381,"column":141}},"184":{"start":{"line":383,"column":16},"end":{"line":383,"column":103}},"185":{"start":{"line":384,"column":16},"end":{"line":384,"column":43}},"186":{"start":{"line":389,"column":0},"end":{"line":389,"column":44}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":1},"end":{"line":7,"column":2}},"loc":{"start":{"line":7,"column":24},"end":{"line":11,"column":1}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":18,"column":4},"end":{"line":18,"column":5}},"loc":{"start":{"line":18,"column":37},"end":{"line":20,"column":5}},"line":18},"2":{"name":"(anonymous_2)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":15},"end":{"line":21,"column":18}},"line":21},"3":{"name":"(anonymous_3)","decl":{"start":{"line":22,"column":4},"end":{"line":22,"column":5}},"loc":{"start":{"line":22,"column":28},"end":{"line":40,"column":5}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":23,"column":59},"end":{"line":23,"column":60}},"loc":{"start":{"line":23,"column":64},"end":{"line":23,"column":90}},"line":23},"5":{"name":"(anonymous_5)","decl":{"start":{"line":25,"column":66},"end":{"line":25,"column":67}},"loc":{"start":{"line":25,"column":71},"end":{"line":25,"column":147}},"line":25},"6":{"name":"(anonymous_6)","decl":{"start":{"line":25,"column":87},"end":{"line":25,"column":88}},"loc":{"start":{"line":25,"column":95},"end":{"line":25,"column":117}},"line":25},"7":{"name":"(anonymous_7)","decl":{"start":{"line":27,"column":45},"end":{"line":27,"column":46}},"loc":{"start":{"line":27,"column":50},"end":{"line":32,"column":9}},"line":27},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":44},"end":{"line":33,"column":45}},"loc":{"start":{"line":33,"column":52},"end":{"line":35,"column":9}},"line":33},"9":{"name":"(anonymous_9)","decl":{"start":{"line":37,"column":61},"end":{"line":37,"column":62}},"loc":{"start":{"line":37,"column":73},"end":{"line":37,"column":107}},"line":37},"10":{"name":"(anonymous_10)","decl":{"start":{"line":38,"column":85},"end":{"line":38,"column":86}},"loc":{"start":{"line":38,"column":97},"end":{"line":38,"column":131}},"line":38},"11":{"name":"(anonymous_11)","decl":{"start":{"line":39,"column":81},"end":{"line":39,"column":82}},"loc":{"start":{"line":39,"column":93},"end":{"line":39,"column":127}},"line":39},"12":{"name":"(anonymous_12)","decl":{"start":{"line":41,"column":4},"end":{"line":41,"column":5}},"loc":{"start":{"line":41,"column":28},"end":{"line":43,"column":5}},"line":41},"13":{"name":"(anonymous_13)","decl":{"start":{"line":44,"column":4},"end":{"line":44,"column":5}},"loc":{"start":{"line":44,"column":55},"end":{"line":56,"column":5}},"line":44},"14":{"name":"(anonymous_14)","decl":{"start":{"line":57,"column":4},"end":{"line":57,"column":5}},"loc":{"start":{"line":57,"column":23},"end":{"line":62,"column":5}},"line":57},"15":{"name":"(anonymous_15)","decl":{"start":{"line":61,"column":31},"end":{"line":61,"column":32}},"loc":{"start":{"line":61,"column":36},"end":{"line":61,"column":46}},"line":61},"16":{"name":"(anonymous_16)","decl":{"start":{"line":63,"column":4},"end":{"line":63,"column":5}},"loc":{"start":{"line":63,"column":59},"end":{"line":75,"column":5}},"line":63},"17":{"name":"(anonymous_17)","decl":{"start":{"line":76,"column":4},"end":{"line":76,"column":5}},"loc":{"start":{"line":76,"column":37},"end":{"line":85,"column":5}},"line":76},"18":{"name":"(anonymous_18)","decl":{"start":{"line":86,"column":4},"end":{"line":86,"column":5}},"loc":{"start":{"line":86,"column":24},"end":{"line":88,"column":5}},"line":86},"19":{"name":"(anonymous_19)","decl":{"start":{"line":87,"column":44},"end":{"line":87,"column":45}},"loc":{"start":{"line":87,"column":49},"end":{"line":87,"column":81}},"line":87},"20":{"name":"(anonymous_20)","decl":{"start":{"line":89,"column":4},"end":{"line":89,"column":5}},"loc":{"start":{"line":89,"column":45},"end":{"line":95,"column":5}},"line":89},"21":{"name":"(anonymous_21)","decl":{"start":{"line":91,"column":20},"end":{"line":91,"column":21}},"loc":{"start":{"line":91,"column":25},"end":{"line":91,"column":46}},"line":91},"22":{"name":"(anonymous_22)","decl":{"start":{"line":92,"column":21},"end":{"line":92,"column":22}},"loc":{"start":{"line":92,"column":26},"end":{"line":94,"column":9}},"line":92},"23":{"name":"(anonymous_23)","decl":{"start":{"line":96,"column":4},"end":{"line":96,"column":5}},"loc":{"start":{"line":96,"column":43},"end":{"line":102,"column":5}},"line":96},"24":{"name":"(anonymous_24)","decl":{"start":{"line":99,"column":43},"end":{"line":99,"column":44}},"loc":{"start":{"line":99,"column":48},"end":{"line":99,"column":70}},"line":99},"25":{"name":"(anonymous_25)","decl":{"start":{"line":103,"column":4},"end":{"line":103,"column":5}},"loc":{"start":{"line":103,"column":32},"end":{"line":155,"column":5}},"line":103},"26":{"name":"(anonymous_26)","decl":{"start":{"line":156,"column":4},"end":{"line":156,"column":5}},"loc":{"start":{"line":156,"column":50},"end":{"line":165,"column":5}},"line":156},"27":{"name":"(anonymous_27)","decl":{"start":{"line":166,"column":4},"end":{"line":166,"column":5}},"loc":{"start":{"line":166,"column":58},"end":{"line":175,"column":5}},"line":166},"28":{"name":"(anonymous_28)","decl":{"start":{"line":167,"column":60},"end":{"line":167,"column":61}},"loc":{"start":{"line":167,"column":65},"end":{"line":167,"column":108}},"line":167},"29":{"name":"(anonymous_29)","decl":{"start":{"line":176,"column":4},"end":{"line":176,"column":5}},"loc":{"start":{"line":176,"column":54},"end":{"line":185,"column":5}},"line":176},"30":{"name":"(anonymous_30)","decl":{"start":{"line":186,"column":4},"end":{"line":186,"column":5}},"loc":{"start":{"line":186,"column":51},"end":{"line":196,"column":5}},"line":186},"31":{"name":"(anonymous_31)","decl":{"start":{"line":190,"column":57},"end":{"line":190,"column":58}},"loc":{"start":{"line":190,"column":62},"end":{"line":190,"column":76}},"line":190},"32":{"name":"(anonymous_32)","decl":{"start":{"line":197,"column":4},"end":{"line":197,"column":5}},"loc":{"start":{"line":197,"column":72},"end":{"line":206,"column":5}},"line":197},"33":{"name":"(anonymous_33)","decl":{"start":{"line":198,"column":62},"end":{"line":198,"column":63}},"loc":{"start":{"line":198,"column":67},"end":{"line":198,"column":110}},"line":198},"34":{"name":"(anonymous_34)","decl":{"start":{"line":207,"column":4},"end":{"line":207,"column":5}},"loc":{"start":{"line":207,"column":58},"end":{"line":217,"column":5}},"line":207},"35":{"name":"(anonymous_35)","decl":{"start":{"line":209,"column":20},"end":{"line":209,"column":21}},"loc":{"start":{"line":209,"column":25},"end":{"line":209,"column":81}},"line":209},"36":{"name":"(anonymous_36)","decl":{"start":{"line":210,"column":20},"end":{"line":210,"column":21}},"loc":{"start":{"line":210,"column":25},"end":{"line":210,"column":62}},"line":210},"37":{"name":"(anonymous_37)","decl":{"start":{"line":211,"column":30},"end":{"line":211,"column":31}},"loc":{"start":{"line":211,"column":35},"end":{"line":213,"column":9}},"line":211},"38":{"name":"(anonymous_38)","decl":{"start":{"line":214,"column":61},"end":{"line":214,"column":62}},"loc":{"start":{"line":214,"column":66},"end":{"line":214,"column":92}},"line":214},"39":{"name":"(anonymous_39)","decl":{"start":{"line":218,"column":4},"end":{"line":218,"column":5}},"loc":{"start":{"line":218,"column":60},"end":{"line":230,"column":5}},"line":218},"40":{"name":"(anonymous_40)","decl":{"start":{"line":219,"column":50},"end":{"line":219,"column":51}},"loc":{"start":{"line":219,"column":55},"end":{"line":219,"column":133}},"line":219},"41":{"name":"(anonymous_41)","decl":{"start":{"line":231,"column":4},"end":{"line":231,"column":5}},"loc":{"start":{"line":231,"column":52},"end":{"line":256,"column":5}},"line":231},"42":{"name":"(anonymous_42)","decl":{"start":{"line":257,"column":4},"end":{"line":257,"column":5}},"loc":{"start":{"line":257,"column":43},"end":{"line":281,"column":5}},"line":257},"43":{"name":"(anonymous_43)","decl":{"start":{"line":259,"column":20},"end":{"line":259,"column":21}},"loc":{"start":{"line":259,"column":25},"end":{"line":259,"column":62}},"line":259},"44":{"name":"(anonymous_44)","decl":{"start":{"line":260,"column":20},"end":{"line":260,"column":21}},"loc":{"start":{"line":260,"column":25},"end":{"line":260,"column":92}},"line":260},"45":{"name":"(anonymous_45)","decl":{"start":{"line":262,"column":17},"end":{"line":262,"column":18}},"loc":{"start":{"line":262,"column":22},"end":{"line":264,"column":9}},"line":262},"46":{"name":"(anonymous_46)","decl":{"start":{"line":266,"column":29},"end":{"line":266,"column":30}},"loc":{"start":{"line":266,"column":36},"end":{"line":278,"column":9}},"line":266},"47":{"name":"(anonymous_47)","decl":{"start":{"line":282,"column":4},"end":{"line":282,"column":5}},"loc":{"start":{"line":282,"column":51},"end":{"line":296,"column":5}},"line":282},"48":{"name":"(anonymous_48)","decl":{"start":{"line":297,"column":4},"end":{"line":297,"column":5}},"loc":{"start":{"line":297,"column":49},"end":{"line":309,"column":5}},"line":297},"49":{"name":"(anonymous_49)","decl":{"start":{"line":310,"column":4},"end":{"line":310,"column":5}},"loc":{"start":{"line":310,"column":53},"end":{"line":319,"column":5}},"line":310},"50":{"name":"(anonymous_50)","decl":{"start":{"line":320,"column":4},"end":{"line":320,"column":5}},"loc":{"start":{"line":320,"column":45},"end":{"line":338,"column":5}},"line":320},"51":{"name":"(anonymous_51)","decl":{"start":{"line":339,"column":4},"end":{"line":339,"column":5}},"loc":{"start":{"line":339,"column":49},"end":{"line":348,"column":5}},"line":339},"52":{"name":"(anonymous_52)","decl":{"start":{"line":340,"column":47},"end":{"line":340,"column":48}},"loc":{"start":{"line":340,"column":52},"end":{"line":340,"column":78}},"line":340},"53":{"name":"(anonymous_53)","decl":{"start":{"line":342,"column":43},"end":{"line":342,"column":44}},"loc":{"start":{"line":342,"column":49},"end":{"line":346,"column":13}},"line":342},"54":{"name":"(anonymous_54)","decl":{"start":{"line":349,"column":4},"end":{"line":349,"column":5}},"loc":{"start":{"line":349,"column":64},"end":{"line":365,"column":5}},"line":349},"55":{"name":"(anonymous_55)","decl":{"start":{"line":366,"column":4},"end":{"line":366,"column":5}},"loc":{"start":{"line":366,"column":98},"end":{"line":387,"column":5}},"line":366},"56":{"name":"(anonymous_56)","decl":{"start":{"line":381,"column":24},"end":{"line":381,"column":25}},"loc":{"start":{"line":381,"column":36},"end":{"line":381,"column":141}},"line":381},"57":{"name":"(anonymous_57)","decl":{"start":{"line":382,"column":25},"end":{"line":382,"column":26}},"loc":{"start":{"line":382,"column":30},"end":{"line":385,"column":13}},"line":382}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":17},"end":{"line":11,"column":66}},"type":"binary-expr","locations":[{"start":{"line":11,"column":17},"end":{"line":11,"column":36}},{"start":{"line":11,"column":41},"end":{"line":11,"column":65}}],"line":11},"1":{"loc":{"start":{"line":28,"column":120},"end":{"line":28,"column":146}},"type":"binary-expr","locations":[{"start":{"line":28,"column":120},"end":{"line":28,"column":133}},{"start":{"line":28,"column":137},"end":{"line":28,"column":146}}],"line":28},"2":{"loc":{"start":{"line":29,"column":12},"end":{"line":31,"column":13}},"type":"if","locations":[{"start":{"line":29,"column":12},"end":{"line":31,"column":13}},{"start":{},"end":{}}],"line":29},"3":{"loc":{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},"type":"if","locations":[{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},{"start":{},"end":{}}],"line":58},"4":{"loc":{"start":{"line":61,"column":15},"end":{"line":61,"column":55}},"type":"binary-expr","locations":[{"start":{"line":61,"column":15},"end":{"line":61,"column":47}},{"start":{"line":61,"column":51},"end":{"line":61,"column":55}}],"line":61},"5":{"loc":{"start":{"line":77,"column":8},"end":{"line":84,"column":9}},"type":"switch","locations":[{"start":{"line":78,"column":12},"end":{"line":79,"column":29}},{"start":{"line":80,"column":12},"end":{"line":81,"column":30}},{"start":{"line":82,"column":12},"end":{"line":83,"column":33}}],"line":77},"6":{"loc":{"start":{"line":98,"column":8},"end":{"line":101,"column":9}},"type":"if","locations":[{"start":{"line":98,"column":8},"end":{"line":101,"column":9}},{"start":{},"end":{}}],"line":98},"7":{"loc":{"start":{"line":105,"column":8},"end":{"line":108,"column":9}},"type":"if","locations":[{"start":{"line":105,"column":8},"end":{"line":108,"column":9}},{"start":{},"end":{}}],"line":105},"8":{"loc":{"start":{"line":110,"column":12},"end":{"line":149,"column":13}},"type":"switch","locations":[{"start":{"line":112,"column":16},"end":{"line":113,"column":72}},{"start":{"line":115,"column":16},"end":{"line":116,"column":76}},{"start":{"line":117,"column":16},"end":{"line":118,"column":80}},{"start":{"line":119,"column":16},"end":{"line":120,"column":76}},{"start":{"line":121,"column":16},"end":{"line":122,"column":78}},{"start":{"line":124,"column":16},"end":{"line":125,"column":70}},{"start":{"line":127,"column":16},"end":{"line":128,"column":79}},{"start":{"line":129,"column":16},"end":{"line":130,"column":87}},{"start":{"line":132,"column":16},"end":{"line":133,"column":81}},{"start":{"line":134,"column":16},"end":{"line":135,"column":85}},{"start":{"line":137,"column":16},"end":{"line":138,"column":91}},{"start":{"line":139,"column":16},"end":{"line":140,"column":99}},{"start":{"line":142,"column":16},"end":{"line":143,"column":78}},{"start":{"line":145,"column":16},"end":{"line":146,"column":77}},{"start":{"line":147,"column":16},"end":{"line":148,"column":85}}],"line":110},"9":{"loc":{"start":{"line":153,"column":56},"end":{"line":153,"column":70}},"type":"binary-expr","locations":[{"start":{"line":153,"column":56},"end":{"line":153,"column":65}},{"start":{"line":153,"column":69},"end":{"line":153,"column":70}}],"line":153},"10":{"loc":{"start":{"line":159,"column":24},"end":{"line":159,"column":59}},"type":"binary-expr","locations":[{"start":{"line":159,"column":24},"end":{"line":159,"column":39}},{"start":{"line":159,"column":43},"end":{"line":159,"column":59}}],"line":159},"11":{"loc":{"start":{"line":161,"column":23},"end":{"line":161,"column":48}},"type":"binary-expr","locations":[{"start":{"line":161,"column":23},"end":{"line":161,"column":40}},{"start":{"line":161,"column":44},"end":{"line":161,"column":48}}],"line":161},"12":{"loc":{"start":{"line":168,"column":8},"end":{"line":174,"column":9}},"type":"if","locations":[{"start":{"line":168,"column":8},"end":{"line":174,"column":9}},{"start":{"line":172,"column":13},"end":{"line":174,"column":9}}],"line":168},"13":{"loc":{"start":{"line":189,"column":8},"end":{"line":195,"column":9}},"type":"if","locations":[{"start":{"line":189,"column":8},"end":{"line":195,"column":9}},{"start":{"line":193,"column":13},"end":{"line":195,"column":9}}],"line":189},"14":{"loc":{"start":{"line":190,"column":28},"end":{"line":190,"column":117}},"type":"cond-expr","locations":[{"start":{"line":190,"column":36},"end":{"line":190,"column":85}},{"start":{"line":190,"column":90},"end":{"line":190,"column":116}}],"line":190},"15":{"loc":{"start":{"line":190,"column":36},"end":{"line":190,"column":85}},"type":"binary-expr","locations":[{"start":{"line":190,"column":36},"end":{"line":190,"column":77}},{"start":{"line":190,"column":81},"end":{"line":190,"column":85}}],"line":190},"16":{"loc":{"start":{"line":190,"column":90},"end":{"line":190,"column":116}},"type":"binary-expr","locations":[{"start":{"line":190,"column":90},"end":{"line":190,"column":108}},{"start":{"line":190,"column":112},"end":{"line":190,"column":116}}],"line":190},"17":{"loc":{"start":{"line":199,"column":8},"end":{"line":205,"column":9}},"type":"if","locations":[{"start":{"line":199,"column":8},"end":{"line":205,"column":9}},{"start":{"line":203,"column":13},"end":{"line":205,"column":9}}],"line":199},"18":{"loc":{"start":{"line":209,"column":25},"end":{"line":209,"column":81}},"type":"binary-expr","locations":[{"start":{"line":209,"column":25},"end":{"line":209,"column":46}},{"start":{"line":209,"column":50},"end":{"line":209,"column":81}}],"line":209},"19":{"loc":{"start":{"line":212,"column":131},"end":{"line":212,"column":157}},"type":"binary-expr","locations":[{"start":{"line":212,"column":131},"end":{"line":212,"column":144}},{"start":{"line":212,"column":148},"end":{"line":212,"column":157}}],"line":212},"20":{"loc":{"start":{"line":219,"column":55},"end":{"line":219,"column":133}},"type":"binary-expr","locations":[{"start":{"line":219,"column":55},"end":{"line":219,"column":98}},{"start":{"line":219,"column":102},"end":{"line":219,"column":133}}],"line":219},"21":{"loc":{"start":{"line":220,"column":8},"end":{"line":229,"column":9}},"type":"if","locations":[{"start":{"line":220,"column":8},"end":{"line":229,"column":9}},{"start":{"line":227,"column":13},"end":{"line":229,"column":9}}],"line":220},"22":{"loc":{"start":{"line":223,"column":52},"end":{"line":223,"column":71}},"type":"binary-expr","locations":[{"start":{"line":223,"column":52},"end":{"line":223,"column":63}},{"start":{"line":223,"column":67},"end":{"line":223,"column":71}}],"line":223},"23":{"loc":{"start":{"line":223,"column":128},"end":{"line":223,"column":155}},"type":"binary-expr","locations":[{"start":{"line":223,"column":128},"end":{"line":223,"column":142}},{"start":{"line":223,"column":146},"end":{"line":223,"column":155}}],"line":223},"24":{"loc":{"start":{"line":234,"column":8},"end":{"line":244,"column":9}},"type":"if","locations":[{"start":{"line":234,"column":8},"end":{"line":244,"column":9}},{"start":{},"end":{}}],"line":234},"25":{"loc":{"start":{"line":236,"column":26},"end":{"line":236,"column":59}},"type":"binary-expr","locations":[{"start":{"line":236,"column":26},"end":{"line":236,"column":39}},{"start":{"line":236,"column":43},"end":{"line":236,"column":59}}],"line":236},"26":{"loc":{"start":{"line":237,"column":12},"end":{"line":243,"column":13}},"type":"if","locations":[{"start":{"line":237,"column":12},"end":{"line":243,"column":13}},{"start":{"line":241,"column":17},"end":{"line":243,"column":13}}],"line":237},"27":{"loc":{"start":{"line":247,"column":24},"end":{"line":247,"column":59}},"type":"binary-expr","locations":[{"start":{"line":247,"column":24},"end":{"line":247,"column":39}},{"start":{"line":247,"column":43},"end":{"line":247,"column":59}}],"line":247},"28":{"loc":{"start":{"line":254,"column":128},"end":{"line":254,"column":165}},"type":"binary-expr","locations":[{"start":{"line":254,"column":128},"end":{"line":254,"column":152}},{"start":{"line":254,"column":156},"end":{"line":254,"column":165}}],"line":254},"29":{"loc":{"start":{"line":260,"column":25},"end":{"line":260,"column":92}},"type":"binary-expr","locations":[{"start":{"line":260,"column":25},"end":{"line":260,"column":46}},{"start":{"line":260,"column":50},"end":{"line":260,"column":92}}],"line":260},"30":{"loc":{"start":{"line":284,"column":8},"end":{"line":295,"column":9}},"type":"if","locations":[{"start":{"line":284,"column":8},"end":{"line":295,"column":9}},{"start":{"line":293,"column":13},"end":{"line":295,"column":9}}],"line":284},"31":{"loc":{"start":{"line":300,"column":8},"end":{"line":302,"column":9}},"type":"if","locations":[{"start":{"line":300,"column":8},"end":{"line":302,"column":9}},{"start":{},"end":{}}],"line":300},"32":{"loc":{"start":{"line":300,"column":12},"end":{"line":300,"column":69}},"type":"binary-expr","locations":[{"start":{"line":300,"column":12},"end":{"line":300,"column":30}},{"start":{"line":300,"column":34},"end":{"line":300,"column":69}}],"line":300},"33":{"loc":{"start":{"line":304,"column":27},"end":{"line":304,"column":62}},"type":"binary-expr","locations":[{"start":{"line":304,"column":27},"end":{"line":304,"column":42}},{"start":{"line":304,"column":46},"end":{"line":304,"column":62}}],"line":304},"34":{"loc":{"start":{"line":311,"column":27},"end":{"line":311,"column":62}},"type":"binary-expr","locations":[{"start":{"line":311,"column":27},"end":{"line":311,"column":42}},{"start":{"line":311,"column":46},"end":{"line":311,"column":62}}],"line":311},"35":{"loc":{"start":{"line":313,"column":8},"end":{"line":316,"column":9}},"type":"if","locations":[{"start":{"line":313,"column":8},"end":{"line":316,"column":9}},{"start":{},"end":{}}],"line":313},"36":{"loc":{"start":{"line":323,"column":8},"end":{"line":331,"column":9}},"type":"if","locations":[{"start":{"line":323,"column":8},"end":{"line":331,"column":9}},{"start":{},"end":{}}],"line":323},"37":{"loc":{"start":{"line":332,"column":8},"end":{"line":337,"column":9}},"type":"if","locations":[{"start":{"line":332,"column":8},"end":{"line":337,"column":9}},{"start":{"line":335,"column":13},"end":{"line":337,"column":9}}],"line":332},"38":{"loc":{"start":{"line":351,"column":8},"end":{"line":364,"column":9}},"type":"if","locations":[{"start":{"line":351,"column":8},"end":{"line":364,"column":9}},{"start":{"line":354,"column":13},"end":{"line":364,"column":9}}],"line":351},"39":{"loc":{"start":{"line":351,"column":12},"end":{"line":351,"column":66}},"type":"binary-expr","locations":[{"start":{"line":351,"column":12},"end":{"line":351,"column":27}},{"start":{"line":351,"column":31},"end":{"line":351,"column":66}}],"line":351},"40":{"loc":{"start":{"line":367,"column":8},"end":{"line":386,"column":9}},"type":"if","locations":[{"start":{"line":367,"column":8},"end":{"line":386,"column":9}},{"start":{},"end":{}}],"line":367},"41":{"loc":{"start":{"line":381,"column":36},"end":{"line":381,"column":141}},"type":"binary-expr","locations":[{"start":{"line":381,"column":36},"end":{"line":381,"column":74}},{"start":{"line":381,"column":79},"end":{"line":381,"column":110}},{"start":{"line":381,"column":114},"end":{"line":381,"column":140}}],"line":381}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":176,"9":176,"10":176,"11":176,"12":176,"13":176,"14":6,"15":2,"16":6,"17":2,"18":5,"19":6,"20":6,"21":1,"22":1,"23":1,"24":6,"25":1,"26":6,"27":2,"28":6,"29":2,"30":6,"31":0,"32":2,"33":11,"34":11,"35":64,"36":1,"37":63,"38":124,"39":0,"40":0,"41":16,"42":0,"43":4,"44":12,"45":11,"46":2,"47":11,"48":2,"49":2,"50":17,"51":17,"52":17,"53":2,"54":17,"55":260,"56":260,"57":1,"58":259,"59":259,"60":2,"61":1,"62":1,"63":12,"64":2,"65":17,"66":19,"67":6,"68":12,"69":1,"70":7,"71":1,"72":7,"73":2,"74":3,"75":0,"76":0,"77":2,"78":2,"79":2,"80":3,"81":2,"82":3,"83":2,"84":2,"85":1,"86":12,"87":12,"88":12,"89":7,"90":7,"91":7,"92":7,"93":6,"94":7,"95":0,"96":1,"97":1,"98":1,"99":1,"100":1,"101":0,"102":1,"103":1,"104":1,"105":1,"106":1,"107":1,"108":1,"109":1,"110":1,"111":6,"112":5,"113":6,"114":3,"115":3,"116":3,"117":3,"118":3,"119":3,"120":19,"121":19,"122":19,"123":16,"124":16,"125":16,"126":1,"127":1,"128":15,"129":18,"130":18,"131":18,"132":18,"133":17,"134":11,"135":8,"136":17,"137":8,"138":17,"139":8,"140":17,"141":17,"142":2,"143":2,"144":1,"145":1,"146":12,"147":12,"148":2,"149":10,"150":10,"151":10,"152":10,"153":10,"154":1,"155":1,"156":1,"157":1,"158":1,"159":1,"160":1,"161":2,"162":2,"163":2,"164":1,"165":1,"166":2,"167":1,"168":1,"169":1,"170":3,"171":1,"172":3,"173":7,"174":7,"175":0,"176":7,"177":7,"178":7,"179":25,"180":21,"181":21,"182":21,"183":14,"184":6,"185":6,"186":1},"f":{"0":1,"1":176,"2":3,"3":6,"4":2,"5":2,"6":5,"7":1,"8":1,"9":2,"10":2,"11":0,"12":2,"13":11,"14":64,"15":124,"16":0,"17":16,"18":11,"19":2,"20":11,"21":2,"22":2,"23":17,"24":2,"25":260,"26":2,"27":3,"28":2,"29":12,"30":7,"31":6,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":6,"40":5,"41":19,"42":17,"43":11,"44":8,"45":8,"46":8,"47":2,"48":12,"49":1,"50":2,"51":1,"52":3,"53":3,"54":7,"55":25,"56":14,"57":6},"b":{"0":[1,1],"1":[1,0],"2":[1,0],"3":[1,63],"4":[63,3],"5":[0,4,12],"6":[17,0],"7":[1,259],"8":[2,1,1,12,2,17,19,6,12,1,7,1,7,2,3],"9":[0,0],"10":[2,0],"11":[2,1],"12":[2,1],"13":[7,0],"14":[5,2],"15":[5,2],"16":[2,1],"17":[1,0],"18":[1,1],"19":[1,0],"20":[5,4],"21":[3,3],"22":[3,1],"23":[3,0],"24":[16,3],"25":[16,1],"26":[1,15],"27":[18,0],"28":[18,5],"29":[8,5],"30":[1,1],"31":[2,10],"32":[12,11],"33":[10,0],"34":[1,0],"35":[1,0],"36":[1,1],"37":[1,1],"38":[0,7],"39":[7,7],"40":[21,4],"41":[14,14,8]},"inputSourceMap":{"version":3,"file":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/BroadcastHandler.ts","sources":["/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/BroadcastHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { MessageHandler } from '../BasicFDC3Server';\nimport { AppRegistration, InstanceID, ServerContext } from '../ServerContext';\nimport { AppIdentifier, ChannelError, DisplayMetadata, PrivateChannelEventTypes } from '@finos/fdc3-standard';\nimport { successResponse, errorResponse, FullAppIdentifier, onlyUnique } from './support';\nimport {\n  AddContextListenerRequest,\n  AddEventListenerRequest,\n  AgentResponseMessage,\n  AppRequestMessage,\n  BroadcastRequest,\n  ChannelChangedEvent,\n  ContextListenerUnsubscribeRequest,\n  CreatePrivateChannelRequest,\n  EventListenerUnsubscribeRequest,\n  GetCurrentChannelRequest,\n  GetCurrentContextRequest,\n  GetOrCreateChannelRequest,\n  GetUserChannelsRequest,\n  JoinUserChannelRequest,\n  LeaveCurrentChannelRequest,\n  PrivateChannelAddEventListenerRequest,\n  PrivateChannelDisconnectRequest,\n  PrivateChannelOnAddContextListenerEvent,\n  PrivateChannelOnDisconnectEvent,\n  PrivateChannelOnUnsubscribeEvent,\n  PrivateChannelUnsubscribeEventListenerRequest,\n} from '@finos/fdc3-schema/dist/generated/api/BrowserTypes';\nimport { Context } from '@finos/fdc3-context';\n\ntype PrivateChannelEvents =\n  | PrivateChannelOnAddContextListenerEvent\n  | PrivateChannelOnUnsubscribeEvent\n  | PrivateChannelOnDisconnectEvent;\n\ntype ContextListenerRegistration = {\n  appId: string;\n  instanceId: string;\n  listenerUuid: string;\n  channelId: string | null;\n  contextType: string | null;\n  userChannelListener: boolean;\n};\n\ntype PrivateChannelEventListener = {\n  appId: string;\n  instanceId: string;\n  channelId: string;\n  eventType: PrivateChannelEventTypes | null;\n  listenerUuid: string;\n};\n\ntype DesktopAgentEventListener = {\n  appId: string;\n  instanceId: string;\n  eventType: string | null;\n  listenerUuid: string;\n};\n\nexport enum ChannelType {\n  'user',\n  'app',\n  'private',\n}\n\nexport type ChannelState = {\n  id: string;\n  type: ChannelType;\n  context: Context[];\n  displayMetadata: DisplayMetadata;\n};\n\nexport class BroadcastHandler implements MessageHandler {\n  private contextListeners: ContextListenerRegistration[] = [];\n  private privateChannelEventListeners: PrivateChannelEventListener[] = [];\n  private desktopAgentEventListeners: DesktopAgentEventListener[] = [];\n  private readonly state: ChannelState[] = [];\n  private readonly currentChannel: { [instanceId: string]: ChannelState } = {};\n\n  constructor(initialChannelState: ChannelState[]) {\n    this.state = initialChannelState;\n  }\n\n  shutdown(): void {}\n\n  cleanup(instanceId: InstanceID, sc: ServerContext<AppRegistration>): void {\n    const toUnsubscribe = this.contextListeners.filter(r => r.instanceId == instanceId);\n\n    //handle privateChannel disconnects\n    const privateChannelsToUnsubscribe = toUnsubscribe.filter(\n      u => this.state.find(chan => chan.id == u.channelId)?.type == ChannelType.private\n    );\n\n    const privateChannelsToDisconnect = new Set<string>();\n    privateChannelsToUnsubscribe.forEach(u => {\n      this.invokePrivateChannelEventListeners(\n        u.channelId,\n        'unsubscribe',\n        'privateChannelOnUnsubscribeEvent',\n        sc,\n        u.contextType ?? undefined\n      );\n      if (u.channelId) {\n        privateChannelsToDisconnect.add(u.channelId);\n      }\n    });\n\n    privateChannelsToDisconnect.forEach(chan => {\n      this.invokePrivateChannelEventListeners(chan, 'disconnect', 'privateChannelOnDisconnectEvent', sc);\n    });\n\n    //clean up state entries\n    this.contextListeners = this.contextListeners.filter(listener => listener.instanceId !== instanceId);\n    this.privateChannelEventListeners = this.privateChannelEventListeners.filter(\n      listener => listener.instanceId !== instanceId\n    );\n    this.desktopAgentEventListeners = this.desktopAgentEventListeners.filter(\n      listener => listener.instanceId !== instanceId\n    );\n  }\n\n  getCurrentChannel(from: FullAppIdentifier): ChannelState | null {\n    return this.currentChannel[from.instanceId];\n  }\n\n  fireChannelChangedEvent(channelId: string | null, sc: ServerContext<AppRegistration>, instanceId: string) {\n    const event: ChannelChangedEvent = {\n      meta: {\n        eventUuid: sc.createUUID(),\n        timestamp: new Date(),\n      },\n      type: 'channelChangedEvent',\n      payload: {\n        newChannelId: channelId,\n      },\n    };\n\n    sc.post(event, instanceId);\n  }\n\n  getChannelById(id: string | null): ChannelState | null {\n    if (id == null) {\n      return null;\n    }\n    return this.state.find(c => c.id == id) ?? null;\n  }\n\n  fireUserChannelChangedEvent(channelId: string | null, sc: ServerContext<AppRegistration>, instanceId: string) {\n    const event: ChannelChangedEvent = {\n      meta: {\n        eventUuid: sc.createUUID(),\n        timestamp: new Date(),\n      },\n      type: 'channelChangedEvent',\n      payload: {\n        newChannelId: channelId,\n      },\n    };\n\n    sc.post(event, instanceId);\n  }\n  convertChannelTypeToString(type: ChannelType): string {\n    switch (type) {\n      case ChannelType.app:\n        return 'app';\n      case ChannelType.user:\n        return 'user';\n      case ChannelType.private:\n        return 'private';\n    }\n  }\n\n  getListeners(appId: AppIdentifier) {\n    return this.contextListeners.filter(r => r.instanceId == appId.instanceId);\n  }\n\n  moveUserChannelListeners(app: AppIdentifier, channelId: string | null) {\n    this.getListeners(app)\n      .filter(l => l.userChannelListener)\n      .forEach(l => {\n        l.channelId = channelId;\n      });\n  }\n\n  updateChannelState(channelId: string, context: Context) {\n    const cs = this.getChannelById(channelId);\n    if (cs) {\n      cs.context = cs.context.filter(c => c.type != context.type);\n      cs.context.unshift(context);\n    }\n  }\n\n  async accept(msg: AppRequestMessage, sc: ServerContext<AppRegistration>, uuid: InstanceID) {\n    const from = sc.getInstanceDetails(uuid);\n\n    if (from == null) {\n      // this handler only deals with connected apps\n      return;\n    }\n\n    try {\n      switch (msg.type as string | null) {\n        // app channels registration\n        case 'getOrCreateChannelRequest':\n          return this.handleGetOrCreateRequest(msg as GetOrCreateChannelRequest, sc, from);\n\n        // user channel management\n        case 'getUserChannelsRequest':\n          return this.handleGetUserChannelsRequest(msg as GetUserChannelsRequest, sc, from);\n        case 'leaveCurrentChannelRequest':\n          return this.handleLeaveCurrentChannelRequest(msg as LeaveCurrentChannelRequest, sc, from);\n        case 'joinUserChannelRequest':\n          return this.handleJoinUserChannelRequest(msg as JoinUserChannelRequest, sc, from);\n        case 'getCurrentChannelRequest':\n          return this.handleGetCurrentChannelRequest(msg as GetCurrentChannelRequest, sc, from);\n\n        // general broadcast\n        case 'broadcastRequest':\n          return this.handleBroadcastRequest(msg as BroadcastRequest, sc, from);\n\n        // context listeners\n        case 'addContextListenerRequest':\n          return this.handleAddContextListenerRequest(msg as AddContextListenerRequest, sc, from);\n        case 'contextListenerUnsubscribeRequest':\n          return this.handleContextListenerUnsubscribeRequest(msg as ContextListenerUnsubscribeRequest, sc, from);\n\n        // private channels create/disconnect\n        case 'createPrivateChannelRequest':\n          return this.handleCreatePrivateChannelRequest(msg as CreatePrivateChannelRequest, sc, from);\n        case 'privateChannelDisconnectRequest':\n          return this.handlePrivateChannelDisconnectRequest(msg as PrivateChannelDisconnectRequest, sc, from);\n\n        // private channel event listeners\n        case 'privateChannelAddEventListenerRequest':\n          return this.handlePrivateChannelAddEventListenerRequest(\n            msg as PrivateChannelAddEventListenerRequest,\n            from,\n            sc\n          );\n        case 'privateChannelUnsubscribeEventListenerRequest':\n          return this.handlePrivateChannelUnsubscribeEventListenerRequest(\n            msg as PrivateChannelUnsubscribeEventListenerRequest,\n            sc,\n            from\n          );\n\n        // handling state synchronization of channels\n        case 'getCurrentContextRequest':\n          return this.handleGetCurrentContextRequest(msg as GetCurrentContextRequest, sc, from);\n\n        // TODO: move this out when we no longer handle just channel-based events.\n        case 'addEventListenerRequest':\n          return this.handleAddEventListenerRequest(msg as AddEventListenerRequest, sc, from);\n        case 'eventListenerUnsubscribeRequest':\n          return this.handleEventListenerUnsubscribeRequest(msg as EventListenerUnsubscribeRequest, sc, from);\n      }\n    } catch (e) {\n      const responseType = msg.type.replace(new RegExp('Request$'), 'Response');\n      errorResponse(sc, msg, from, (e as Error).message ?? e, responseType as AgentResponseMessage['type']);\n    }\n  }\n\n  handleAddEventListenerRequest(\n    arg0: AddEventListenerRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const lr: DesktopAgentEventListener = {\n      appId: from.appId,\n      instanceId: from.instanceId ?? 'no-instance-id',\n      listenerUuid: sc.createUUID(),\n      eventType: arg0.payload.type ?? null,\n    };\n\n    this.desktopAgentEventListeners.push(lr);\n    successResponse(sc, arg0, from, { listenerUUID: lr.listenerUuid }, 'addEventListenerResponse');\n  }\n\n  handleEventListenerUnsubscribeRequest(\n    arg0: EventListenerUnsubscribeRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const i = this.desktopAgentEventListeners.findIndex(r => r.listenerUuid == arg0.payload.listenerUUID);\n    if (i > -1) {\n      this.desktopAgentEventListeners.splice(i, 1);\n      successResponse(sc, arg0, from, {}, 'eventListenerUnsubscribeResponse');\n    } else {\n      errorResponse(sc, arg0, from, 'ListenerNotFound', 'eventListenerUnsubscribeResponse');\n    }\n  }\n\n  handleCreatePrivateChannelRequest(\n    arg0: CreatePrivateChannelRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const id = sc.createUUID();\n    this.state.push({\n      id,\n      type: ChannelType.private,\n      context: [],\n      displayMetadata: {},\n    });\n\n    successResponse(\n      sc,\n      arg0,\n      from,\n      { privateChannel: { id, type: this.convertChannelTypeToString(ChannelType.private) } },\n      'createPrivateChannelResponse'\n    );\n  }\n\n  handleGetCurrentContextRequest(\n    arg0: GetCurrentContextRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const channel = this.getChannelById(arg0.payload.channelId);\n    const type = arg0.payload.contextType;\n\n    if (channel) {\n      const context = type ? (channel.context.find(c => c.type == type) ?? null) : (channel.context[0] ?? null);\n      successResponse(sc, arg0, from, { context: context }, 'getCurrentContextResponse');\n    } else {\n      errorResponse(sc, arg0, from, ChannelError.NoChannelFound, 'getCurrentContextResponse');\n    }\n  }\n\n  handlePrivateChannelUnsubscribeEventListenerRequest(\n    arg0: PrivateChannelUnsubscribeEventListenerRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const i = this.privateChannelEventListeners.findIndex(r => r.listenerUuid == arg0.payload.listenerUUID);\n    if (i > -1) {\n      this.privateChannelEventListeners.splice(i, 1);\n      successResponse(sc, arg0, from, {}, 'privateChannelUnsubscribeEventListenerResponse');\n    } else {\n      errorResponse(sc, arg0, from, 'ListenerNotFound', 'privateChannelUnsubscribeEventListenerResponse');\n    }\n  }\n\n  handlePrivateChannelDisconnectRequest(\n    arg0: PrivateChannelDisconnectRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const toUnsubscribe = this.contextListeners\n      .filter(r => r.appId == from.appId && r.instanceId == from.instanceId)\n      .filter(r => r.channelId == arg0.payload.channelId);\n\n    toUnsubscribe.forEach(u => {\n      this.invokePrivateChannelEventListeners(\n        arg0.payload.channelId,\n        'unsubscribe',\n        'privateChannelOnUnsubscribeEvent',\n        sc,\n        u.contextType ?? undefined\n      );\n    });\n\n    this.contextListeners = this.contextListeners.filter(r => !toUnsubscribe.includes(r));\n    this.invokePrivateChannelEventListeners(\n      arg0.payload.channelId,\n      'disconnect',\n      'privateChannelOnDisconnectEvent',\n      sc\n    );\n    successResponse(sc, arg0, from, {}, 'privateChannelDisconnectResponse');\n  }\n\n  handleContextListenerUnsubscribeRequest(\n    arg0: ContextListenerUnsubscribeRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const i = this.contextListeners.findIndex(\n      r => r.listenerUuid == arg0.payload.listenerUUID && r.instanceId == from.instanceId\n    );\n\n    if (i > -1) {\n      const rl = this.contextListeners[i];\n      const channel = this.getChannelById(rl.channelId);\n      this.invokePrivateChannelEventListeners(\n        channel?.id ?? null,\n        'unsubscribe',\n        'privateChannelOnUnsubscribeEvent',\n        sc,\n        rl.contextType ?? undefined\n      );\n      this.contextListeners.splice(i, 1);\n      successResponse(sc, arg0, from, {}, 'contextListenerUnsubscribeResponse');\n    } else {\n      errorResponse(sc, arg0, from, 'ListenerNotFound', 'contextListenerUnsubscribeResponse');\n    }\n  }\n\n  handleAddContextListenerRequest(\n    arg0: AddContextListenerRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    let channelId = null;\n    let channelType = ChannelType.user;\n\n    if (arg0.payload?.channelId) {\n      const channel = this.getChannelById(arg0.payload?.channelId);\n      channelType = channel?.type ?? ChannelType.user;\n\n      if (channel == null) {\n        errorResponse(sc, arg0, from, ChannelError.NoChannelFound, 'addContextListenerResponse');\n        return;\n      } else {\n        channelId = channel.id;\n      }\n    }\n\n    const lr: ContextListenerRegistration = {\n      appId: from.appId,\n      instanceId: from.instanceId ?? 'no-instance-id',\n      channelId: channelId,\n      listenerUuid: sc.createUUID(),\n      contextType: arg0.payload.contextType,\n      userChannelListener: channelType == ChannelType.user,\n    };\n\n    this.contextListeners.push(lr);\n    this.invokePrivateChannelEventListeners(\n      channelId,\n      'addContextListener',\n      'privateChannelOnAddContextListenerEvent',\n      sc,\n      arg0.payload.contextType ?? undefined\n    );\n    successResponse(sc, arg0, from, { listenerUUID: lr.listenerUuid }, 'addContextListenerResponse');\n  }\n\n  handleBroadcastRequest(arg0: BroadcastRequest, sc: ServerContext<AppRegistration>, from: FullAppIdentifier) {\n    const matchingListeners = this.contextListeners\n      .filter(r => r.channelId == arg0.payload.channelId)\n      .filter(r => r.contextType == null || r.contextType == arg0.payload.context.type);\n\n    const matchingApps: FullAppIdentifier[] = matchingListeners\n      .map(r => {\n        return { appId: r.appId, instanceId: r.instanceId };\n      })\n      .filter(onlyUnique);\n\n    matchingApps.forEach(app => {\n      sc.post(\n        {\n          meta: {\n            eventUuid: sc.createUUID(),\n            timestamp: new Date(),\n          },\n          type: 'broadcastEvent',\n          payload: {\n            channelId: arg0.payload.channelId,\n            context: arg0.payload.context,\n          },\n        },\n        app.instanceId\n      );\n    });\n\n    this.updateChannelState(arg0.payload.channelId, arg0.payload.context);\n    successResponse(sc, arg0, from, {}, 'broadcastResponse');\n  }\n\n  handleGetCurrentChannelRequest(\n    arg0: GetCurrentChannelRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const currentChannel = this.getCurrentChannel(from);\n    if (currentChannel) {\n      successResponse(\n        sc,\n        arg0,\n        from,\n        {\n          channel: {\n            id: currentChannel.id,\n            type: this.convertChannelTypeToString(currentChannel.type),\n            displayMetadata: currentChannel.displayMetadata,\n          },\n        },\n        'getCurrentChannelResponse'\n      );\n    } else {\n      successResponse(sc, arg0, from, { channel: null }, 'getCurrentChannelResponse');\n    }\n  }\n\n  handleJoinUserChannelRequest(\n    arg0: JoinUserChannelRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    // check it's a user channel\n    const newChannel = this.getChannelById(arg0.payload.channelId);\n    if (newChannel == null || newChannel.type != ChannelType.user) {\n      return errorResponse(sc, arg0, from, ChannelError.NoChannelFound, 'joinUserChannelResponse');\n    }\n\n    // join it.\n    const instanceId = from.instanceId ?? 'no-instance-id';\n    this.currentChannel[instanceId] = newChannel;\n    this.moveUserChannelListeners(from, newChannel.id);\n    this.fireChannelChangedEvent(newChannel?.id, sc, instanceId);\n    successResponse(sc, arg0, from, {}, 'joinUserChannelResponse');\n  }\n\n  handleLeaveCurrentChannelRequest(\n    arg0: LeaveCurrentChannelRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const instanceId = from.instanceId ?? 'no-instance-id';\n    const currentChannel = this.currentChannel[instanceId];\n    if (currentChannel) {\n      delete this.currentChannel[instanceId];\n      this.moveUserChannelListeners(from, null);\n    }\n\n    this.fireChannelChangedEvent(null, sc, instanceId);\n    successResponse(sc, arg0, from, {}, 'leaveCurrentChannelResponse');\n  }\n\n  handleGetOrCreateRequest(\n    arg0: GetOrCreateChannelRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const id = arg0.payload.channelId;\n    let channel = this.getChannelById(id);\n\n    if (!channel) {\n      channel = {\n        id: id,\n        type: ChannelType.app,\n        context: [],\n        displayMetadata: {},\n      };\n      this.state.push(channel);\n    }\n\n    if (channel.type != ChannelType.app) {\n      errorResponse(sc, arg0, from, ChannelError.AccessDenied, 'getOrCreateChannelResponse');\n    } else {\n      successResponse(\n        sc,\n        arg0,\n        from,\n        { channel: { id: channel.id, type: channel.type } },\n        'getOrCreateChannelResponse'\n      );\n    }\n  }\n\n  handleGetUserChannelsRequest(\n    arg0: GetUserChannelsRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ) {\n    const userChannels = this.state.filter(c => c.type == ChannelType.user);\n    successResponse(\n      sc,\n      arg0,\n      from,\n      {\n        userChannels: userChannels.map(c => ({\n          id: c.id,\n          type: this.convertChannelTypeToString(c.type),\n          displayMetadata: c.displayMetadata,\n        })),\n      },\n      'getUserChannelsResponse'\n    );\n  }\n\n  handlePrivateChannelAddEventListenerRequest(\n    arg0: PrivateChannelAddEventListenerRequest,\n    from: FullAppIdentifier,\n    sc: ServerContext<AppRegistration>\n  ) {\n    const channel = this.getChannelById(arg0.payload.privateChannelId);\n\n    if (channel == null || channel.type != ChannelType.private) {\n      errorResponse(sc, arg0, from, ChannelError.NoChannelFound, 'privateChannelAddEventListenerResponse');\n    } else {\n      const el = {\n        appId: from.appId,\n        instanceId: from.instanceId,\n        channelId: arg0.payload.privateChannelId,\n        eventType: arg0.payload.listenerType,\n        listenerUuid: sc.createUUID(),\n      } as PrivateChannelEventListener;\n      this.privateChannelEventListeners.push(el);\n      successResponse(sc, arg0, from, { listenerUUID: el.listenerUuid }, 'privateChannelAddEventListenerResponse');\n    }\n  }\n\n  invokePrivateChannelEventListeners(\n    privateChannelId: string | null,\n    eventType: PrivateChannelEventTypes,\n    messageType:\n      | 'privateChannelOnAddContextListenerEvent'\n      | 'privateChannelOnUnsubscribeEvent'\n      | 'privateChannelOnDisconnectEvent',\n    sc: ServerContext<AppRegistration>,\n    contextType?: string\n  ) {\n    if (privateChannelId) {\n      const msg: PrivateChannelEvents = {\n        type: messageType,\n        meta: {\n          eventUuid: sc.createUUID(),\n          timestamp: new Date(),\n        },\n        payload: {\n          privateChannelId,\n          contextType: contextType,\n        },\n      } as PrivateChannelEvents; //Typescript doesn't like comparing an object with a union property (messageType) with a union of object types\n\n      console.log('invokePrivateChannelEventListeners msg: ', msg);\n      this.privateChannelEventListeners\n        .filter(\n          listener =>\n            listener.channelId == privateChannelId && (listener.eventType == eventType || listener.eventType == null)\n        )\n        .forEach(e => {\n          console.log(`invokePrivateChannelEventListeners: posting to instance ${e.instanceId}`);\n          sc.post(msg, e.instanceId);\n        });\n    }\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e4ac30ec8497d508918f1f8709fcac716dfec351","contentHash":"51783231a0bfd0697dc457589f4f4f22b14336a138ddb3047fe6991ff2f15665"},"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/support.ts":{"path":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/support.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":162}},"2":{"start":{"line":5,"column":28},"end":{"line":5,"column":38}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":91}},"4":{"start":{"line":8,"column":0},"end":{"line":8,"column":50}},"5":{"start":{"line":10,"column":4},"end":{"line":10,"column":78}},"6":{"start":{"line":12,"column":0},"end":{"line":12,"column":42}},"7":{"start":{"line":14,"column":4},"end":{"line":14,"column":74}},"8":{"start":{"line":16,"column":0},"end":{"line":16,"column":38}},"9":{"start":{"line":18,"column":16},"end":{"line":26,"column":5}},"10":{"start":{"line":27,"column":4},"end":{"line":27,"column":32}},"11":{"start":{"line":29,"column":0},"end":{"line":29,"column":46}},"12":{"start":{"line":31,"column":4},"end":{"line":41,"column":22}},"13":{"start":{"line":43,"column":0},"end":{"line":43,"column":42}},"14":{"start":{"line":48,"column":4},"end":{"line":48,"column":41}},"15":{"start":{"line":50,"column":0},"end":{"line":50,"column":32}}},"fnMap":{"0":{"name":"isFullAppIdentifier","decl":{"start":{"line":4,"column":9},"end":{"line":4,"column":28}},"loc":{"start":{"line":4,"column":41},"end":{"line":7,"column":1}},"line":4},"1":{"name":"successResponse","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":24}},"loc":{"start":{"line":9,"column":57},"end":{"line":11,"column":1}},"line":9},"2":{"name":"errorResponse","decl":{"start":{"line":13,"column":9},"end":{"line":13,"column":22}},"loc":{"start":{"line":13,"column":53},"end":{"line":15,"column":1}},"line":13},"3":{"name":"successResponseId","decl":{"start":{"line":17,"column":9},"end":{"line":17,"column":26}},"loc":{"start":{"line":17,"column":61},"end":{"line":28,"column":1}},"line":17},"4":{"name":"errorResponseId","decl":{"start":{"line":30,"column":9},"end":{"line":30,"column":24}},"loc":{"start":{"line":30,"column":57},"end":{"line":42,"column":1}},"line":30},"5":{"name":"onlyUnique","decl":{"start":{"line":47,"column":9},"end":{"line":47,"column":19}},"loc":{"start":{"line":47,"column":40},"end":{"line":49,"column":1}},"line":47}},"branchMap":{"0":{"loc":{"start":{"line":6,"column":11},"end":{"line":6,"column":90}},"type":"binary-expr","locations":[{"start":{"line":6,"column":11},"end":{"line":6,"column":51}},{"start":{"line":6,"column":55},"end":{"line":6,"column":90}}],"line":6}},"s":{"0":1,"1":1,"2":25,"3":25,"4":1,"5":200,"6":1,"7":11,"8":1,"9":217,"10":217,"11":1,"12":27,"13":1,"14":8,"15":1},"f":{"0":25,"1":200,"2":11,"3":217,"4":27,"5":8},"b":{"0":[25,15]},"inputSourceMap":{"version":3,"file":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/support.ts","sources":["/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/support.ts"],"names":[],"mappings":";;;AAUA,SAAgB,mBAAmB,CAAC,UAA6C;IAC/E,MAAM,eAAe,GAAG,UAA+B,CAAC;IACxD,OAAO,eAAe,CAAC,UAAU,KAAK,SAAS,IAAI,eAAe,CAAC,KAAK,KAAK,SAAS,CAAC;AACzF,CAAC;AAHD,kDAGC;AAED,SAAgB,eAAe,CAC7B,EAAkC,EAClC,OAA0B,EAC1B,EAAqB,EACrB,OAAwC,EACxC,IAAkC;IAElC,OAAO,iBAAiB,CAAC,EAAE,EAAE,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;AAC5E,CAAC;AARD,0CAQC;AAED,SAAgB,aAAa,CAC3B,EAAkC,EAClC,OAA0B,EAC1B,EAAqB,EACrB,KAAa,EACb,IAAkC;IAElC,OAAO,eAAe,CAAC,EAAE,EAAE,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;AACxE,CAAC;AARD,sCAQC;AAED,SAAgB,iBAAiB,CAC/B,EAAkC,EAClC,SAAiB,EACjB,EAAqB,EACrB,OAAwC,EACxC,IAAkC;IAElC,MAAM,GAAG,GAAG;QACV,IAAI,EAAE;YACJ,YAAY,EAAE,EAAE,CAAC,UAAU,EAAE;YAC7B,WAAW,EAAE,SAAS;YACtB,SAAS,EAAE,IAAI,IAAI,EAAE;SACtB;QACD,IAAI;QACJ,OAAO;KACR,CAAC;IACF,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE,CAAC,UAAW,CAAC,CAAC;AAC/B,CAAC;AAjBD,8CAiBC;AAED,SAAgB,eAAe,CAC7B,EAAkC,EAClC,SAAiB,EACjB,EAAqB,EACrB,KAAa,EACb,IAAkC;IAElC,EAAE,CAAC,IAAI,CACL;QACE,IAAI,EAAE;YACJ,YAAY,EAAE,EAAE,CAAC,UAAU,EAAE;YAC7B,WAAW,EAAE,SAAS;YACtB,SAAS,EAAE,IAAI,IAAI,EAAE;SACtB;QACD,IAAI;QACJ,OAAO,EAAE;YACP,KAAK;SACN;KACsB,EACzB,EAAE,CAAC,UAAW,CACf,CAAC;AACJ,CAAC;AArBD,0CAqBC;AAED;;GAEG;AACH,SAAgB,UAAU,CAAI,KAAQ,EAAE,KAAa,EAAE,IAAS;IAC9D,OAAO,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,KAAK,CAAC;AACvC,CAAC;AAFD,gCAEC","sourcesContent":["import { AgentResponseMessage, AppRequestMessage } from '@finos/fdc3-schema/dist/generated/api/BrowserTypes';\nimport { AppRegistration, ServerContext } from '../ServerContext';\nimport { AppIdentifier } from '@finos/fdc3-standard';\n\n/** Interface representing a full specified app identifier (instanceId is optional in the API type). */\nexport interface FullAppIdentifier {\n  readonly appId: string;\n  readonly instanceId: string;\n}\n\nexport function isFullAppIdentifier(identifier: AppIdentifier | FullAppIdentifier): identifier is FullAppIdentifier {\n  const typedIdentifier = identifier as FullAppIdentifier;\n  return typedIdentifier.instanceId !== undefined && typedIdentifier.appId !== undefined;\n}\n\nexport function successResponse(\n  sc: ServerContext<AppRegistration>,\n  request: AppRequestMessage,\n  to: FullAppIdentifier,\n  payload: AgentResponseMessage['payload'],\n  type: AgentResponseMessage['type']\n) {\n  return successResponseId(sc, request.meta.requestUuid, to, payload, type);\n}\n\nexport function errorResponse(\n  sc: ServerContext<AppRegistration>,\n  request: AppRequestMessage,\n  to: FullAppIdentifier,\n  error: string,\n  type: AgentResponseMessage['type']\n) {\n  return errorResponseId(sc, request.meta.requestUuid, to, error, type);\n}\n\nexport function successResponseId(\n  sc: ServerContext<AppRegistration>,\n  requestId: string,\n  to: FullAppIdentifier,\n  payload: AgentResponseMessage['payload'],\n  type: AgentResponseMessage['type']\n) {\n  const msg = {\n    meta: {\n      responseUuid: sc.createUUID(),\n      requestUuid: requestId,\n      timestamp: new Date(),\n    },\n    type,\n    payload,\n  };\n  sc.post(msg, to.instanceId!);\n}\n\nexport function errorResponseId(\n  sc: ServerContext<AppRegistration>,\n  requestId: string,\n  to: FullAppIdentifier,\n  error: string,\n  type: AgentResponseMessage['type']\n) {\n  sc.post(\n    {\n      meta: {\n        responseUuid: sc.createUUID(),\n        requestUuid: requestId,\n        timestamp: new Date(),\n      },\n      type,\n      payload: {\n        error,\n      },\n    } as AgentResponseMessage,\n    to.instanceId!\n  );\n}\n\n/*\n * from: https://stackoverflow.com/questions/1960473/get-all-unique-values-in-a-javascript-array-remove-duplicates#14438954\n */\nexport function onlyUnique<X>(value: X, index: number, self: X[]) {\n  return self.indexOf(value) === index;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4f45e37bdd6a323fa38d1d7c06bd15b247ebf12a","contentHash":"61a83a3cc762c699a19432c7eaea06b3dfe64c5d0f5e34601dc735939b7a2417"},"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/IntentHandler.ts":{"path":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/IntentHandler.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":31}},"2":{"start":{"line":4,"column":24},"end":{"line":4,"column":55}},"3":{"start":{"line":5,"column":18},"end":{"line":5,"column":38}},"4":{"start":{"line":10,"column":16},"end":{"line":25,"column":5}},"5":{"start":{"line":27,"column":4},"end":{"line":27,"column":59}},"6":{"start":{"line":28,"column":4},"end":{"line":28,"column":38}},"7":{"start":{"line":29,"column":4},"end":{"line":34,"column":18}},"8":{"start":{"line":43,"column":15},"end":{"line":43,"column":20}},"9":{"start":{"line":49,"column":8},"end":{"line":49,"column":19}},"10":{"start":{"line":50,"column":8},"end":{"line":50,"column":27}},"11":{"start":{"line":51,"column":8},"end":{"line":51,"column":21}},"12":{"start":{"line":52,"column":8},"end":{"line":52,"column":21}},"13":{"start":{"line":54,"column":8},"end":{"line":59,"column":25}},"14":{"start":{"line":55,"column":12},"end":{"line":58,"column":13}},"15":{"start":{"line":56,"column":16},"end":{"line":56,"column":133}},"16":{"start":{"line":57,"column":16},"end":{"line":57,"column":52}},"17":{"start":{"line":62,"column":8},"end":{"line":68,"column":9}},"18":{"start":{"line":65,"column":12},"end":{"line":65,"column":33}},"19":{"start":{"line":66,"column":12},"end":{"line":66,"column":48}},"20":{"start":{"line":67,"column":12},"end":{"line":67,"column":105}},"21":{"start":{"line":73,"column":20},"end":{"line":73,"column":22}},"22":{"start":{"line":74,"column":21},"end":{"line":74,"column":30}},"23":{"start":{"line":75,"column":25},"end":{"line":75,"column":34}},"24":{"start":{"line":78,"column":8},"end":{"line":78,"column":27}},"25":{"start":{"line":79,"column":8},"end":{"line":79,"column":35}},"26":{"start":{"line":82,"column":8},"end":{"line":82,"column":92}},"27":{"start":{"line":82,"column":62},"end":{"line":82,"column":90}},"28":{"start":{"line":85,"column":8},"end":{"line":89,"column":11}},"29":{"start":{"line":86,"column":12},"end":{"line":88,"column":13}},"30":{"start":{"line":87,"column":16},"end":{"line":87,"column":52}},"31":{"start":{"line":93,"column":20},"end":{"line":93,"column":71}},"32":{"start":{"line":94,"column":8},"end":{"line":94,"column":19}},"33":{"start":{"line":97,"column":21},"end":{"line":97,"column":48}},"34":{"start":{"line":98,"column":8},"end":{"line":101,"column":9}},"35":{"start":{"line":100,"column":12},"end":{"line":100,"column":19}},"36":{"start":{"line":102,"column":8},"end":{"line":126,"column":9}},"37":{"start":{"line":103,"column":12},"end":{"line":121,"column":13}},"38":{"start":{"line":106,"column":20},"end":{"line":106,"column":81}},"39":{"start":{"line":108,"column":20},"end":{"line":108,"column":71}},"40":{"start":{"line":111,"column":20},"end":{"line":111,"column":73}},"41":{"start":{"line":113,"column":20},"end":{"line":113,"column":67}},"42":{"start":{"line":116,"column":20},"end":{"line":116,"column":72}},"43":{"start":{"line":118,"column":20},"end":{"line":118,"column":82}},"44":{"start":{"line":120,"column":20},"end":{"line":120,"column":73}},"45":{"start":{"line":124,"column":33},"end":{"line":124,"column":85}},"46":{"start":{"line":125,"column":12},"end":{"line":125,"column":86}},"47":{"start":{"line":132,"column":26},"end":{"line":132,"column":61}},"48":{"start":{"line":133,"column":19},"end":{"line":133,"column":57}},"49":{"start":{"line":134,"column":8},"end":{"line":141,"column":9}},"50":{"start":{"line":137,"column":12},"end":{"line":139,"column":44}},"51":{"start":{"line":140,"column":12},"end":{"line":140,"column":54}},"52":{"start":{"line":143,"column":8},"end":{"line":143,"column":83}},"53":{"start":{"line":146,"column":19},"end":{"line":146,"column":44}},"54":{"start":{"line":147,"column":19},"end":{"line":147,"column":74}},"55":{"start":{"line":147,"column":53},"end":{"line":147,"column":73}},"56":{"start":{"line":148,"column":8},"end":{"line":154,"column":9}},"57":{"start":{"line":149,"column":12},"end":{"line":149,"column":45}},"58":{"start":{"line":150,"column":12},"end":{"line":150,"column":100}},"59":{"start":{"line":153,"column":12},"end":{"line":153,"column":119}},"60":{"start":{"line":157,"column":19},"end":{"line":162,"column":9}},"61":{"start":{"line":163,"column":8},"end":{"line":163,"column":36}},"62":{"start":{"line":164,"column":8},"end":{"line":166,"column":40}},"63":{"start":{"line":168,"column":8},"end":{"line":173,"column":9}},"64":{"start":{"line":169,"column":12},"end":{"line":169,"column":25}},"65":{"start":{"line":170,"column":12},"end":{"line":172,"column":13}},"66":{"start":{"line":171,"column":16},"end":{"line":171,"column":46}},"67":{"start":{"line":176,"column":8},"end":{"line":176,"column":110}},"68":{"start":{"line":176,"column":44},"end":{"line":176,"column":100}},"69":{"start":{"line":180,"column":19},"end":{"line":180,"column":60}},"70":{"start":{"line":181,"column":8},"end":{"line":181,"column":36}},"71":{"start":{"line":182,"column":8},"end":{"line":184,"column":11}},"72":{"start":{"line":183,"column":12},"end":{"line":183,"column":29}},"73":{"start":{"line":187,"column":8},"end":{"line":190,"column":9}},"74":{"start":{"line":189,"column":12},"end":{"line":189,"column":159}},"75":{"start":{"line":191,"column":38},"end":{"line":191,"column":101}},"76":{"start":{"line":191,"column":55},"end":{"line":191,"column":100}},"77":{"start":{"line":192,"column":8},"end":{"line":198,"column":9}},"78":{"start":{"line":193,"column":12},"end":{"line":193,"column":67}},"79":{"start":{"line":197,"column":12},"end":{"line":197,"column":78}},"80":{"start":{"line":202,"column":32},"end":{"line":202,"column":101}},"81":{"start":{"line":203,"column":25},"end":{"line":203,"column":75}},"82":{"start":{"line":203,"column":51},"end":{"line":203,"column":74}},"83":{"start":{"line":204,"column":8},"end":{"line":211,"column":9}},"84":{"start":{"line":206,"column":23},"end":{"line":206,"column":62}},"85":{"start":{"line":207,"column":12},"end":{"line":207,"column":40}},"86":{"start":{"line":210,"column":12},"end":{"line":210,"column":123}},"87":{"start":{"line":214,"column":27},"end":{"line":214,"column":72}},"88":{"start":{"line":215,"column":8},"end":{"line":217,"column":9}},"89":{"start":{"line":216,"column":12},"end":{"line":216,"column":154}},"90":{"start":{"line":218,"column":52},"end":{"line":228,"column":9}},"91":{"start":{"line":220,"column":32},"end":{"line":220,"column":71}},"92":{"start":{"line":220,"column":57},"end":{"line":220,"column":69}},"93":{"start":{"line":221,"column":12},"end":{"line":227,"column":15}},"94":{"start":{"line":222,"column":40},"end":{"line":222,"column":88}},"95":{"start":{"line":222,"column":60},"end":{"line":222,"column":87}},"96":{"start":{"line":223,"column":16},"end":{"line":226,"column":18}},"97":{"start":{"line":225,"column":54},"end":{"line":225,"column":71}},"98":{"start":{"line":225,"column":83},"end":{"line":225,"column":101}},"99":{"start":{"line":229,"column":35},"end":{"line":231,"column":9}},"100":{"start":{"line":230,"column":12},"end":{"line":230,"column":62}},"101":{"start":{"line":230,"column":42},"end":{"line":230,"column":60}},"102":{"start":{"line":234,"column":24},"end":{"line":234,"column":39}},"103":{"start":{"line":235,"column":32},"end":{"line":235,"column":103}},"104":{"start":{"line":236,"column":27},"end":{"line":236,"column":93}},"105":{"start":{"line":237,"column":8},"end":{"line":239,"column":9}},"106":{"start":{"line":238,"column":12},"end":{"line":238,"column":145}},"107":{"start":{"line":240,"column":8},"end":{"line":242,"column":9}},"108":{"start":{"line":241,"column":12},"end":{"line":241,"column":154}},"109":{"start":{"line":243,"column":35},"end":{"line":243,"column":98}},"110":{"start":{"line":244,"column":8},"end":{"line":256,"column":9}},"111":{"start":{"line":245,"column":12},"end":{"line":255,"column":13}},"112":{"start":{"line":247,"column":35},"end":{"line":247,"column":80}},"113":{"start":{"line":248,"column":16},"end":{"line":254,"column":17}},"114":{"start":{"line":249,"column":31},"end":{"line":252,"column":21}},"115":{"start":{"line":253,"column":20},"end":{"line":253,"column":71}},"116":{"start":{"line":258,"column":8},"end":{"line":258,"column":141}},"117":{"start":{"line":261,"column":21},"end":{"line":261,"column":53}},"118":{"start":{"line":261,"column":45},"end":{"line":261,"column":52}},"119":{"start":{"line":262,"column":27},"end":{"line":262,"column":78}},"120":{"start":{"line":262,"column":52},"end":{"line":262,"column":70}},"121":{"start":{"line":263,"column":8},"end":{"line":263,"column":31}},"122":{"start":{"line":266,"column":30},"end":{"line":266,"column":57}},"123":{"start":{"line":267,"column":32},"end":{"line":267,"column":118}},"124":{"start":{"line":267,"column":50},"end":{"line":267,"column":117}},"125":{"start":{"line":268,"column":34},"end":{"line":268,"column":112}},"126":{"start":{"line":268,"column":59},"end":{"line":268,"column":71}},"127":{"start":{"line":268,"column":93},"end":{"line":268,"column":111}},"128":{"start":{"line":269,"column":27},"end":{"line":284,"column":10}},"129":{"start":{"line":270,"column":44},"end":{"line":270,"column":112}},"130":{"start":{"line":270,"column":73},"end":{"line":270,"column":91}},"131":{"start":{"line":270,"column":103},"end":{"line":270,"column":111}},"132":{"start":{"line":271,"column":32},"end":{"line":271,"column":102}},"133":{"start":{"line":271,"column":59},"end":{"line":271,"column":101}},"134":{"start":{"line":272,"column":12},"end":{"line":283,"column":14}},"135":{"start":{"line":280,"column":24},"end":{"line":280,"column":44}},"136":{"start":{"line":285,"column":35},"end":{"line":285,"column":106}},"137":{"start":{"line":286,"column":8},"end":{"line":289,"column":9}},"138":{"start":{"line":288,"column":12},"end":{"line":288,"column":145}},"139":{"start":{"line":290,"column":8},"end":{"line":306,"column":9}},"140":{"start":{"line":291,"column":33},"end":{"line":291,"column":54}},"141":{"start":{"line":292,"column":12},"end":{"line":305,"column":13}},"142":{"start":{"line":293,"column":38},"end":{"line":293,"column":88}},"143":{"start":{"line":293,"column":68},"end":{"line":293,"column":80}},"144":{"start":{"line":294,"column":27},"end":{"line":297,"column":17}},"145":{"start":{"line":298,"column":16},"end":{"line":304,"column":17}},"146":{"start":{"line":300,"column":20},"end":{"line":300,"column":78}},"147":{"start":{"line":302,"column":21},"end":{"line":304,"column":17}},"148":{"start":{"line":303,"column":20},"end":{"line":303,"column":85}},"149":{"start":{"line":307,"column":8},"end":{"line":316,"column":9}},"150":{"start":{"line":309,"column":12},"end":{"line":311,"column":29}},"151":{"start":{"line":315,"column":12},"end":{"line":315,"column":141}},"152":{"start":{"line":319,"column":30},"end":{"line":325,"column":9}},"153":{"start":{"line":326,"column":23},"end":{"line":326,"column":39}},"154":{"start":{"line":327,"column":8},"end":{"line":343,"column":9}},"155":{"start":{"line":328,"column":12},"end":{"line":338,"column":13}},"156":{"start":{"line":329,"column":16},"end":{"line":329,"column":94}},"157":{"start":{"line":331,"column":17},"end":{"line":338,"column":13}},"158":{"start":{"line":332,"column":16},"end":{"line":332,"column":91}},"159":{"start":{"line":336,"column":16},"end":{"line":336,"column":98}},"160":{"start":{"line":337,"column":16},"end":{"line":337,"column":161}},"161":{"start":{"line":342,"column":12},"end":{"line":342,"column":65}},"162":{"start":{"line":347,"column":30},"end":{"line":347,"column":109}},"163":{"start":{"line":348,"column":34},"end":{"line":348,"column":122}},"164":{"start":{"line":348,"column":68},"end":{"line":348,"column":121}},"165":{"start":{"line":348,"column":86},"end":{"line":348,"column":115}},"166":{"start":{"line":349,"column":39},"end":{"line":357,"column":10}},"167":{"start":{"line":350,"column":12},"end":{"line":356,"column":14}},"168":{"start":{"line":358,"column":8},"end":{"line":360,"column":9}},"169":{"start":{"line":359,"column":12},"end":{"line":359,"column":158}},"170":{"start":{"line":361,"column":23},"end":{"line":361,"column":39}},"171":{"start":{"line":362,"column":8},"end":{"line":378,"column":9}},"172":{"start":{"line":363,"column":12},"end":{"line":373,"column":13}},"173":{"start":{"line":364,"column":16},"end":{"line":364,"column":101}},"174":{"start":{"line":366,"column":17},"end":{"line":373,"column":13}},"175":{"start":{"line":367,"column":16},"end":{"line":367,"column":98}},"176":{"start":{"line":371,"column":16},"end":{"line":371,"column":108}},"177":{"start":{"line":372,"column":16},"end":{"line":372,"column":171}},"178":{"start":{"line":377,"column":12},"end":{"line":377,"column":72}},"179":{"start":{"line":381,"column":40},"end":{"line":381,"column":49}},"180":{"start":{"line":382,"column":22},"end":{"line":382,"column":90}},"181":{"start":{"line":384,"column":22},"end":{"line":384,"column":24}},"182":{"start":{"line":386,"column":8},"end":{"line":409,"column":9}},"183":{"start":{"line":386,"column":25},"end":{"line":386,"column":26}},"184":{"start":{"line":387,"column":23},"end":{"line":387,"column":35}},"185":{"start":{"line":388,"column":29},"end":{"line":388,"column":78}},"186":{"start":{"line":388,"column":46},"end":{"line":388,"column":77}},"187":{"start":{"line":389,"column":37},"end":{"line":389,"column":86}},"188":{"start":{"line":390,"column":12},"end":{"line":408,"column":13}},"189":{"start":{"line":391,"column":16},"end":{"line":391,"column":56}},"190":{"start":{"line":392,"column":16},"end":{"line":392,"column":115}},"191":{"start":{"line":392,"column":47},"end":{"line":392,"column":113}},"192":{"start":{"line":395,"column":34},"end":{"line":405,"column":17}},"193":{"start":{"line":406,"column":16},"end":{"line":406,"column":116}},"194":{"start":{"line":406,"column":47},"end":{"line":406,"column":114}},"195":{"start":{"line":407,"column":16},"end":{"line":407,"column":38}},"196":{"start":{"line":410,"column":8},"end":{"line":412,"column":43}},"197":{"start":{"line":415,"column":48},"end":{"line":415,"column":57}},"198":{"start":{"line":417,"column":22},"end":{"line":422,"column":10}},"199":{"start":{"line":418,"column":12},"end":{"line":421,"column":14}},"200":{"start":{"line":424,"column":22},"end":{"line":428,"column":10}},"201":{"start":{"line":425,"column":12},"end":{"line":427,"column":14}},"202":{"start":{"line":430,"column":26},"end":{"line":430,"column":46}},"203":{"start":{"line":432,"column":35},"end":{"line":432,"column":100}},"204":{"start":{"line":433,"column":28},"end":{"line":433,"column":105}},"205":{"start":{"line":434,"column":8},"end":{"line":442,"column":33}},"206":{"start":{"line":445,"column":27},"end":{"line":445,"column":54}},"207":{"start":{"line":446,"column":25},"end":{"line":446,"column":83}},"208":{"start":{"line":446,"column":56},"end":{"line":446,"column":82}},"209":{"start":{"line":447,"column":23},"end":{"line":447,"column":95}},"210":{"start":{"line":447,"column":44},"end":{"line":447,"column":94}},"211":{"start":{"line":447,"column":65},"end":{"line":447,"column":93}},"212":{"start":{"line":448,"column":8},"end":{"line":448,"column":22}},"213":{"start":{"line":451,"column":27},"end":{"line":451,"column":54}},"214":{"start":{"line":452,"column":29},"end":{"line":452,"column":70}},"215":{"start":{"line":452,"column":52},"end":{"line":452,"column":69}},"216":{"start":{"line":453,"column":8},"end":{"line":453,"column":28}},"217":{"start":{"line":456,"column":0},"end":{"line":456,"column":38}}},"fnMap":{"0":{"name":"forwardRequest","decl":{"start":{"line":9,"column":15},"end":{"line":9,"column":29}},"loc":{"start":{"line":9,"column":48},"end":{"line":35,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":48,"column":4},"end":{"line":48,"column":5}},"loc":{"start":{"line":48,"column":34},"end":{"line":60,"column":5}},"line":48},"2":{"name":"(anonymous_2)","decl":{"start":{"line":54,"column":19},"end":{"line":54,"column":20}},"loc":{"start":{"line":54,"column":25},"end":{"line":59,"column":9}},"line":54},"3":{"name":"(anonymous_3)","decl":{"start":{"line":61,"column":4},"end":{"line":61,"column":5}},"loc":{"start":{"line":61,"column":23},"end":{"line":69,"column":5}},"line":61},"4":{"name":"(anonymous_4)","decl":{"start":{"line":77,"column":4},"end":{"line":77,"column":5}},"loc":{"start":{"line":77,"column":30},"end":{"line":80,"column":5}},"line":77},"5":{"name":"(anonymous_5)","decl":{"start":{"line":81,"column":4},"end":{"line":81,"column":5}},"loc":{"start":{"line":81,"column":67},"end":{"line":90,"column":5}},"line":81},"6":{"name":"(anonymous_6)","decl":{"start":{"line":82,"column":55},"end":{"line":82,"column":56}},"loc":{"start":{"line":82,"column":62},"end":{"line":82,"column":90}},"line":82},"7":{"name":"(anonymous_7)","decl":{"start":{"line":85,"column":40},"end":{"line":85,"column":41}},"loc":{"start":{"line":85,"column":54},"end":{"line":89,"column":9}},"line":85},"8":{"name":"(anonymous_8)","decl":{"start":{"line":91,"column":4},"end":{"line":91,"column":5}},"loc":{"start":{"line":91,"column":15},"end":{"line":91,"column":18}},"line":91},"9":{"name":"(anonymous_9)","decl":{"start":{"line":92,"column":4},"end":{"line":92,"column":5}},"loc":{"start":{"line":92,"column":57},"end":{"line":95,"column":5}},"line":92},"10":{"name":"(anonymous_10)","decl":{"start":{"line":96,"column":4},"end":{"line":96,"column":5}},"loc":{"start":{"line":96,"column":32},"end":{"line":127,"column":5}},"line":96},"11":{"name":"(anonymous_11)","decl":{"start":{"line":131,"column":4},"end":{"line":131,"column":5}},"loc":{"start":{"line":131,"column":40},"end":{"line":144,"column":5}},"line":131},"12":{"name":"(anonymous_12)","decl":{"start":{"line":145,"column":4},"end":{"line":145,"column":5}},"loc":{"start":{"line":145,"column":34},"end":{"line":155,"column":5}},"line":145},"13":{"name":"(anonymous_13)","decl":{"start":{"line":147,"column":48},"end":{"line":147,"column":49}},"loc":{"start":{"line":147,"column":53},"end":{"line":147,"column":73}},"line":147},"14":{"name":"(anonymous_14)","decl":{"start":{"line":156,"column":4},"end":{"line":156,"column":5}},"loc":{"start":{"line":156,"column":40},"end":{"line":174,"column":5}},"line":156},"15":{"name":"(anonymous_15)","decl":{"start":{"line":175,"column":4},"end":{"line":175,"column":5}},"loc":{"start":{"line":175,"column":40},"end":{"line":177,"column":5}},"line":175},"16":{"name":"(anonymous_16)","decl":{"start":{"line":176,"column":39},"end":{"line":176,"column":40}},"loc":{"start":{"line":176,"column":44},"end":{"line":176,"column":100}},"line":176},"17":{"name":"(anonymous_17)","decl":{"start":{"line":178,"column":4},"end":{"line":178,"column":5}},"loc":{"start":{"line":178,"column":51},"end":{"line":185,"column":5}},"line":178},"18":{"name":"(anonymous_18)","decl":{"start":{"line":182,"column":35},"end":{"line":182,"column":36}},"loc":{"start":{"line":182,"column":41},"end":{"line":184,"column":9}},"line":182},"19":{"name":"(anonymous_19)","decl":{"start":{"line":186,"column":4},"end":{"line":186,"column":5}},"loc":{"start":{"line":186,"column":65},"end":{"line":199,"column":5}},"line":186},"20":{"name":"(anonymous_20)","decl":{"start":{"line":191,"column":50},"end":{"line":191,"column":51}},"loc":{"start":{"line":191,"column":55},"end":{"line":191,"column":100}},"line":191},"21":{"name":"(anonymous_21)","decl":{"start":{"line":200,"column":4},"end":{"line":200,"column":5}},"loc":{"start":{"line":200,"column":55},"end":{"line":212,"column":5}},"line":200},"22":{"name":"(anonymous_22)","decl":{"start":{"line":203,"column":46},"end":{"line":203,"column":47}},"loc":{"start":{"line":203,"column":51},"end":{"line":203,"column":74}},"line":203},"23":{"name":"(anonymous_23)","decl":{"start":{"line":213,"column":4},"end":{"line":213,"column":5}},"loc":{"start":{"line":213,"column":62},"end":{"line":259,"column":5}},"line":213},"24":{"name":"(anonymous_24)","decl":{"start":{"line":218,"column":52},"end":{"line":218,"column":53}},"loc":{"start":{"line":218,"column":72},"end":{"line":228,"column":9}},"line":218},"25":{"name":"(anonymous_25)","decl":{"start":{"line":220,"column":52},"end":{"line":220,"column":53}},"loc":{"start":{"line":220,"column":57},"end":{"line":220,"column":69}},"line":220},"26":{"name":"(anonymous_26)","decl":{"start":{"line":221,"column":47},"end":{"line":221,"column":48}},"loc":{"start":{"line":221,"column":61},"end":{"line":227,"column":13}},"line":221},"27":{"name":"(anonymous_27)","decl":{"start":{"line":222,"column":55},"end":{"line":222,"column":56}},"loc":{"start":{"line":222,"column":60},"end":{"line":222,"column":87}},"line":222},"28":{"name":"(anonymous_28)","decl":{"start":{"line":225,"column":49},"end":{"line":225,"column":50}},"loc":{"start":{"line":225,"column":54},"end":{"line":225,"column":71}},"line":225},"29":{"name":"(anonymous_29)","decl":{"start":{"line":225,"column":77},"end":{"line":225,"column":78}},"loc":{"start":{"line":225,"column":83},"end":{"line":225,"column":101}},"line":225},"30":{"name":"(anonymous_30)","decl":{"start":{"line":229,"column":35},"end":{"line":229,"column":36}},"loc":{"start":{"line":229,"column":51},"end":{"line":231,"column":9}},"line":229},"31":{"name":"(anonymous_31)","decl":{"start":{"line":230,"column":36},"end":{"line":230,"column":37}},"loc":{"start":{"line":230,"column":42},"end":{"line":230,"column":60}},"line":230},"32":{"name":"(anonymous_32)","decl":{"start":{"line":260,"column":4},"end":{"line":260,"column":5}},"loc":{"start":{"line":260,"column":26},"end":{"line":264,"column":5}},"line":260},"33":{"name":"(anonymous_33)","decl":{"start":{"line":261,"column":40},"end":{"line":261,"column":41}},"loc":{"start":{"line":261,"column":45},"end":{"line":261,"column":52}},"line":261},"34":{"name":"(anonymous_34)","decl":{"start":{"line":262,"column":39},"end":{"line":262,"column":40}},"loc":{"start":{"line":262,"column":52},"end":{"line":262,"column":70}},"line":262},"35":{"name":"(anonymous_35)","decl":{"start":{"line":265,"column":4},"end":{"line":265,"column":5}},"loc":{"start":{"line":265,"column":40},"end":{"line":317,"column":5}},"line":265},"36":{"name":"(anonymous_36)","decl":{"start":{"line":267,"column":45},"end":{"line":267,"column":46}},"loc":{"start":{"line":267,"column":50},"end":{"line":267,"column":117}},"line":267},"37":{"name":"(anonymous_37)","decl":{"start":{"line":268,"column":54},"end":{"line":268,"column":55}},"loc":{"start":{"line":268,"column":59},"end":{"line":268,"column":71}},"line":268},"38":{"name":"(anonymous_38)","decl":{"start":{"line":268,"column":80},"end":{"line":268,"column":81}},"loc":{"start":{"line":268,"column":93},"end":{"line":268,"column":111}},"line":268},"39":{"name":"(anonymous_39)","decl":{"start":{"line":269,"column":49},"end":{"line":269,"column":50}},"loc":{"start":{"line":269,"column":54},"end":{"line":284,"column":9}},"line":269},"40":{"name":"(anonymous_40)","decl":{"start":{"line":270,"column":67},"end":{"line":270,"column":68}},"loc":{"start":{"line":270,"column":73},"end":{"line":270,"column":91}},"line":270},"41":{"name":"(anonymous_41)","decl":{"start":{"line":270,"column":97},"end":{"line":270,"column":98}},"loc":{"start":{"line":270,"column":103},"end":{"line":270,"column":111}},"line":270},"42":{"name":"(anonymous_42)","decl":{"start":{"line":271,"column":53},"end":{"line":271,"column":54}},"loc":{"start":{"line":271,"column":59},"end":{"line":271,"column":101}},"line":271},"43":{"name":"(anonymous_43)","decl":{"start":{"line":279,"column":51},"end":{"line":279,"column":52}},"loc":{"start":{"line":279,"column":56},"end":{"line":281,"column":21}},"line":279},"44":{"name":"(anonymous_44)","decl":{"start":{"line":293,"column":63},"end":{"line":293,"column":64}},"loc":{"start":{"line":293,"column":68},"end":{"line":293,"column":80}},"line":293},"45":{"name":"(anonymous_45)","decl":{"start":{"line":318,"column":4},"end":{"line":318,"column":5}},"loc":{"start":{"line":318,"column":45},"end":{"line":344,"column":5}},"line":318},"46":{"name":"(anonymous_46)","decl":{"start":{"line":345,"column":4},"end":{"line":345,"column":5}},"loc":{"start":{"line":345,"column":55},"end":{"line":379,"column":5}},"line":345},"47":{"name":"(anonymous_47)","decl":{"start":{"line":348,"column":55},"end":{"line":348,"column":56}},"loc":{"start":{"line":348,"column":68},"end":{"line":348,"column":121}},"line":348},"48":{"name":"(anonymous_48)","decl":{"start":{"line":348,"column":80},"end":{"line":348,"column":81}},"loc":{"start":{"line":348,"column":86},"end":{"line":348,"column":115}},"line":348},"49":{"name":"(anonymous_49)","decl":{"start":{"line":349,"column":61},"end":{"line":349,"column":62}},"loc":{"start":{"line":349,"column":66},"end":{"line":357,"column":9}},"line":349},"50":{"name":"(anonymous_50)","decl":{"start":{"line":380,"column":4},"end":{"line":380,"column":5}},"loc":{"start":{"line":380,"column":51},"end":{"line":413,"column":5}},"line":380},"51":{"name":"(anonymous_51)","decl":{"start":{"line":388,"column":40},"end":{"line":388,"column":41}},"loc":{"start":{"line":388,"column":46},"end":{"line":388,"column":77}},"line":388},"52":{"name":"(anonymous_52)","decl":{"start":{"line":392,"column":41},"end":{"line":392,"column":42}},"loc":{"start":{"line":392,"column":47},"end":{"line":392,"column":113}},"line":392},"53":{"name":"(anonymous_53)","decl":{"start":{"line":406,"column":41},"end":{"line":406,"column":42}},"loc":{"start":{"line":406,"column":47},"end":{"line":406,"column":114}},"line":406},"54":{"name":"(anonymous_54)","decl":{"start":{"line":414,"column":4},"end":{"line":414,"column":5}},"loc":{"start":{"line":414,"column":41},"end":{"line":443,"column":5}},"line":414},"55":{"name":"(anonymous_55)","decl":{"start":{"line":417,"column":69},"end":{"line":417,"column":70}},"loc":{"start":{"line":417,"column":75},"end":{"line":422,"column":9}},"line":417},"56":{"name":"(anonymous_56)","decl":{"start":{"line":424,"column":89},"end":{"line":424,"column":90}},"loc":{"start":{"line":424,"column":94},"end":{"line":428,"column":9}},"line":424},"57":{"name":"(anonymous_57)","decl":{"start":{"line":444,"column":4},"end":{"line":444,"column":5}},"loc":{"start":{"line":444,"column":44},"end":{"line":449,"column":5}},"line":444},"58":{"name":"(anonymous_58)","decl":{"start":{"line":446,"column":51},"end":{"line":446,"column":52}},"loc":{"start":{"line":446,"column":56},"end":{"line":446,"column":82}},"line":446},"59":{"name":"(anonymous_59)","decl":{"start":{"line":447,"column":39},"end":{"line":447,"column":40}},"loc":{"start":{"line":447,"column":44},"end":{"line":447,"column":94}},"line":447},"60":{"name":"(anonymous_60)","decl":{"start":{"line":447,"column":60},"end":{"line":447,"column":61}},"loc":{"start":{"line":447,"column":65},"end":{"line":447,"column":93}},"line":447},"61":{"name":"(anonymous_61)","decl":{"start":{"line":450,"column":4},"end":{"line":450,"column":5}},"loc":{"start":{"line":450,"column":46},"end":{"line":454,"column":5}},"line":450},"62":{"name":"(anonymous_62)","decl":{"start":{"line":452,"column":47},"end":{"line":452,"column":48}},"loc":{"start":{"line":452,"column":52},"end":{"line":452,"column":69}},"line":452}},"branchMap":{"0":{"loc":{"start":{"line":55,"column":12},"end":{"line":58,"column":13}},"type":"if","locations":[{"start":{"line":55,"column":12},"end":{"line":58,"column":13}},{"start":{},"end":{}}],"line":55},"1":{"loc":{"start":{"line":62,"column":8},"end":{"line":68,"column":9}},"type":"if","locations":[{"start":{"line":62,"column":8},"end":{"line":68,"column":9}},{"start":{},"end":{}}],"line":62},"2":{"loc":{"start":{"line":62,"column":12},"end":{"line":64,"column":92}},"type":"binary-expr","locations":[{"start":{"line":62,"column":12},"end":{"line":62,"column":42}},{"start":{"line":63,"column":12},"end":{"line":63,"column":44}},{"start":{"line":64,"column":13},"end":{"line":64,"column":53}},{"start":{"line":64,"column":57},"end":{"line":64,"column":91}}],"line":62},"3":{"loc":{"start":{"line":86,"column":12},"end":{"line":88,"column":13}},"type":"if","locations":[{"start":{"line":86,"column":12},"end":{"line":88,"column":13}},{"start":{},"end":{}}],"line":86},"4":{"loc":{"start":{"line":98,"column":8},"end":{"line":101,"column":9}},"type":"if","locations":[{"start":{"line":98,"column":8},"end":{"line":101,"column":9}},{"start":{},"end":{}}],"line":98},"5":{"loc":{"start":{"line":103,"column":12},"end":{"line":121,"column":13}},"type":"switch","locations":[{"start":{"line":105,"column":16},"end":{"line":106,"column":81}},{"start":{"line":107,"column":16},"end":{"line":108,"column":71}},{"start":{"line":110,"column":16},"end":{"line":111,"column":73}},{"start":{"line":112,"column":16},"end":{"line":113,"column":67}},{"start":{"line":115,"column":16},"end":{"line":116,"column":72}},{"start":{"line":117,"column":16},"end":{"line":118,"column":82}},{"start":{"line":119,"column":16},"end":{"line":120,"column":73}}],"line":103},"6":{"loc":{"start":{"line":125,"column":56},"end":{"line":125,"column":70}},"type":"binary-expr","locations":[{"start":{"line":125,"column":56},"end":{"line":125,"column":65}},{"start":{"line":125,"column":69},"end":{"line":125,"column":70}}],"line":125},"7":{"loc":{"start":{"line":134,"column":8},"end":{"line":141,"column":9}},"type":"if","locations":[{"start":{"line":134,"column":8},"end":{"line":141,"column":9}},{"start":{},"end":{}}],"line":134},"8":{"loc":{"start":{"line":148,"column":8},"end":{"line":154,"column":9}},"type":"if","locations":[{"start":{"line":148,"column":8},"end":{"line":154,"column":9}},{"start":{"line":152,"column":13},"end":{"line":154,"column":9}}],"line":148},"9":{"loc":{"start":{"line":170,"column":12},"end":{"line":172,"column":13}},"type":"if","locations":[{"start":{"line":170,"column":12},"end":{"line":172,"column":13}},{"start":{},"end":{}}],"line":170},"10":{"loc":{"start":{"line":176,"column":44},"end":{"line":176,"column":100}},"type":"binary-expr","locations":[{"start":{"line":176,"column":44},"end":{"line":176,"column":70}},{"start":{"line":176,"column":74},"end":{"line":176,"column":100}}],"line":176},"11":{"loc":{"start":{"line":187,"column":8},"end":{"line":190,"column":9}},"type":"if","locations":[{"start":{"line":187,"column":8},"end":{"line":190,"column":9}},{"start":{},"end":{}}],"line":187},"12":{"loc":{"start":{"line":192,"column":8},"end":{"line":198,"column":9}},"type":"if","locations":[{"start":{"line":192,"column":8},"end":{"line":198,"column":9}},{"start":{"line":195,"column":13},"end":{"line":198,"column":9}}],"line":192},"13":{"loc":{"start":{"line":204,"column":8},"end":{"line":211,"column":9}},"type":"if","locations":[{"start":{"line":204,"column":8},"end":{"line":211,"column":9}},{"start":{"line":209,"column":13},"end":{"line":211,"column":9}}],"line":204},"14":{"loc":{"start":{"line":215,"column":8},"end":{"line":217,"column":9}},"type":"if","locations":[{"start":{"line":215,"column":8},"end":{"line":217,"column":9}},{"start":{},"end":{}}],"line":215},"15":{"loc":{"start":{"line":237,"column":8},"end":{"line":239,"column":9}},"type":"if","locations":[{"start":{"line":237,"column":8},"end":{"line":239,"column":9}},{"start":{},"end":{}}],"line":237},"16":{"loc":{"start":{"line":240,"column":8},"end":{"line":242,"column":9}},"type":"if","locations":[{"start":{"line":240,"column":8},"end":{"line":242,"column":9}},{"start":{},"end":{}}],"line":240},"17":{"loc":{"start":{"line":244,"column":8},"end":{"line":256,"column":9}},"type":"if","locations":[{"start":{"line":244,"column":8},"end":{"line":256,"column":9}},{"start":{},"end":{}}],"line":244},"18":{"loc":{"start":{"line":245,"column":12},"end":{"line":255,"column":13}},"type":"if","locations":[{"start":{"line":245,"column":12},"end":{"line":255,"column":13}},{"start":{},"end":{}}],"line":245},"19":{"loc":{"start":{"line":248,"column":16},"end":{"line":254,"column":17}},"type":"if","locations":[{"start":{"line":248,"column":16},"end":{"line":254,"column":17}},{"start":{},"end":{}}],"line":248},"20":{"loc":{"start":{"line":286,"column":8},"end":{"line":289,"column":9}},"type":"if","locations":[{"start":{"line":286,"column":8},"end":{"line":289,"column":9}},{"start":{},"end":{}}],"line":286},"21":{"loc":{"start":{"line":290,"column":8},"end":{"line":306,"column":9}},"type":"if","locations":[{"start":{"line":290,"column":8},"end":{"line":306,"column":9}},{"start":{},"end":{}}],"line":290},"22":{"loc":{"start":{"line":292,"column":12},"end":{"line":305,"column":13}},"type":"if","locations":[{"start":{"line":292,"column":12},"end":{"line":305,"column":13}},{"start":{},"end":{}}],"line":292},"23":{"loc":{"start":{"line":298,"column":16},"end":{"line":304,"column":17}},"type":"if","locations":[{"start":{"line":298,"column":16},"end":{"line":304,"column":17}},{"start":{"line":302,"column":21},"end":{"line":304,"column":17}}],"line":298},"24":{"loc":{"start":{"line":298,"column":20},"end":{"line":298,"column":98}},"type":"binary-expr","locations":[{"start":{"line":298,"column":20},"end":{"line":298,"column":38}},{"start":{"line":298,"column":42},"end":{"line":298,"column":98}}],"line":298},"25":{"loc":{"start":{"line":302,"column":21},"end":{"line":304,"column":17}},"type":"if","locations":[{"start":{"line":302,"column":21},"end":{"line":304,"column":17}},{"start":{},"end":{}}],"line":302},"26":{"loc":{"start":{"line":307,"column":8},"end":{"line":316,"column":9}},"type":"if","locations":[{"start":{"line":307,"column":8},"end":{"line":316,"column":9}},{"start":{"line":313,"column":13},"end":{"line":316,"column":9}}],"line":307},"27":{"loc":{"start":{"line":327,"column":8},"end":{"line":343,"column":9}},"type":"if","locations":[{"start":{"line":327,"column":8},"end":{"line":343,"column":9}},{"start":{"line":340,"column":13},"end":{"line":343,"column":9}}],"line":327},"28":{"loc":{"start":{"line":328,"column":12},"end":{"line":338,"column":13}},"type":"if","locations":[{"start":{"line":328,"column":12},"end":{"line":338,"column":13}},{"start":{"line":331,"column":17},"end":{"line":338,"column":13}}],"line":328},"29":{"loc":{"start":{"line":331,"column":17},"end":{"line":338,"column":13}},"type":"if","locations":[{"start":{"line":331,"column":17},"end":{"line":338,"column":13}},{"start":{"line":334,"column":17},"end":{"line":338,"column":13}}],"line":331},"30":{"loc":{"start":{"line":358,"column":8},"end":{"line":360,"column":9}},"type":"if","locations":[{"start":{"line":358,"column":8},"end":{"line":360,"column":9}},{"start":{},"end":{}}],"line":358},"31":{"loc":{"start":{"line":362,"column":8},"end":{"line":378,"column":9}},"type":"if","locations":[{"start":{"line":362,"column":8},"end":{"line":378,"column":9}},{"start":{"line":375,"column":13},"end":{"line":378,"column":9}}],"line":362},"32":{"loc":{"start":{"line":363,"column":12},"end":{"line":373,"column":13}},"type":"if","locations":[{"start":{"line":363,"column":12},"end":{"line":373,"column":13}},{"start":{"line":366,"column":17},"end":{"line":373,"column":13}}],"line":363},"33":{"loc":{"start":{"line":366,"column":17},"end":{"line":373,"column":13}},"type":"if","locations":[{"start":{"line":366,"column":17},"end":{"line":373,"column":13}},{"start":{"line":369,"column":17},"end":{"line":373,"column":13}}],"line":366},"34":{"loc":{"start":{"line":390,"column":12},"end":{"line":408,"column":13}},"type":"if","locations":[{"start":{"line":390,"column":12},"end":{"line":408,"column":13}},{"start":{"line":394,"column":17},"end":{"line":408,"column":13}}],"line":390},"35":{"loc":{"start":{"line":398,"column":37},"end":{"line":398,"column":68}},"type":"binary-expr","locations":[{"start":{"line":398,"column":37},"end":{"line":398,"column":51}},{"start":{"line":398,"column":55},"end":{"line":398,"column":68}}],"line":398},"36":{"loc":{"start":{"line":433,"column":28},"end":{"line":433,"column":105}},"type":"cond-expr","locations":[{"start":{"line":433,"column":60},"end":{"line":433,"column":93}},{"start":{"line":433,"column":96},"end":{"line":433,"column":105}}],"line":433}},"s":{"0":1,"1":1,"2":1,"3":1,"4":11,"5":11,"6":11,"7":11,"8":6,"9":6,"10":6,"11":6,"12":6,"13":6,"14":6,"15":2,"16":2,"17":4,"18":4,"19":4,"20":4,"21":176,"22":176,"23":176,"24":176,"25":176,"26":6,"27":10,"28":6,"29":1,"30":1,"31":9,"32":9,"33":260,"34":260,"35":1,"36":259,"37":259,"38":3,"39":11,"40":88,"41":1,"42":21,"43":8,"44":5,"45":0,"46":0,"47":5,"48":5,"49":5,"50":4,"51":4,"52":5,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":0,"60":88,"61":88,"62":88,"63":88,"64":4,"65":4,"66":4,"67":10,"68":13,"69":5,"70":5,"71":5,"72":5,"73":14,"74":5,"75":9,"76":10,"77":9,"78":3,"79":6,"80":3,"81":3,"82":1,"83":3,"84":1,"85":1,"86":2,"87":8,"88":8,"89":3,"90":5,"91":5,"92":4,"93":5,"94":4,"95":4,"96":4,"97":4,"98":4,"99":5,"100":4,"101":4,"102":5,"103":5,"104":5,"105":5,"106":1,"107":4,"108":0,"109":4,"110":4,"111":4,"112":4,"113":4,"114":4,"115":4,"116":0,"117":3,"118":6,"119":3,"120":6,"121":3,"122":5,"123":5,"124":6,"125":5,"126":7,"127":7,"128":5,"129":5,"130":10,"131":7,"132":5,"133":13,"134":5,"135":7,"136":5,"137":5,"138":1,"139":4,"140":3,"141":3,"142":2,"143":3,"144":2,"145":2,"146":1,"147":1,"148":1,"149":2,"150":1,"151":1,"152":21,"153":21,"154":21,"155":17,"156":11,"157":6,"158":5,"159":1,"160":1,"161":4,"162":8,"163":8,"164":18,"165":28,"166":8,"167":13,"168":8,"169":0,"170":8,"171":8,"172":7,"173":3,"174":4,"175":3,"176":1,"177":1,"178":1,"179":3,"180":3,"181":3,"182":3,"183":3,"184":10,"185":10,"186":10,"187":10,"188":10,"189":4,"190":4,"191":1,"192":6,"193":6,"194":2,"195":6,"196":3,"197":11,"198":11,"199":4,"200":11,"201":12,"202":11,"203":11,"204":11,"205":11,"206":11,"207":11,"208":30,"209":11,"210":4,"211":8,"212":11,"213":10,"214":10,"215":37,"216":10,"217":1},"f":{"0":11,"1":6,"2":6,"3":4,"4":176,"5":6,"6":10,"7":1,"8":3,"9":9,"10":260,"11":5,"12":1,"13":1,"14":88,"15":10,"16":13,"17":5,"18":5,"19":14,"20":10,"21":3,"22":1,"23":8,"24":5,"25":4,"26":4,"27":4,"28":4,"29":4,"30":4,"31":4,"32":3,"33":6,"34":6,"35":5,"36":6,"37":7,"38":7,"39":5,"40":10,"41":7,"42":13,"43":7,"44":3,"45":21,"46":8,"47":18,"48":28,"49":13,"50":3,"51":10,"52":1,"53":2,"54":11,"55":4,"56":12,"57":11,"58":30,"59":4,"60":8,"61":10,"62":37},"b":{"0":[2,4],"1":[4,0],"2":[4,4,4,3],"3":[1,0],"4":[1,259],"5":[3,11,88,1,21,8,5],"6":[0,0],"7":[4,1],"8":[1,0],"9":[4,0],"10":[13,9],"11":[5,9],"12":[3,6],"13":[1,2],"14":[3,5],"15":[1,4],"16":[0,4],"17":[4,0],"18":[4,0],"19":[4,0],"20":[1,4],"21":[3,1],"22":[2,1],"23":[1,1],"24":[2,1],"25":[1,0],"26":[1,1],"27":[17,4],"28":[11,6],"29":[5,1],"30":[0,8],"31":[7,1],"32":[3,4],"33":[3,1],"34":[4,6],"35":[6,0],"36":[8,3]},"inputSourceMap":{"version":3,"file":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/IntentHandler.ts","sources":["/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/IntentHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { MessageHandler } from '../BasicFDC3Server';\nimport { AppRegistration, InstanceID, ServerContext } from '../ServerContext';\nimport { Directory, DirectoryIntent } from '../directory/DirectoryInterface';\nimport { Context } from '@finos/fdc3-context';\nimport { AppIntent, ResolveError, AppIdentifier } from '@finos/fdc3-standard';\nimport {\n  errorResponse,\n  errorResponseId,\n  FullAppIdentifier,\n  isFullAppIdentifier,\n  successResponse,\n  successResponseId,\n} from './support';\nimport {\n  IntentEvent,\n  FindIntentsByContextRequest,\n  FindIntentRequest,\n  AddIntentListenerRequest,\n  IntentListenerUnsubscribeRequest,\n  RaiseIntentRequest,\n  RaiseIntentForContextRequest,\n  IntentResultRequest,\n  AppRequestMessage,\n  AgentResponseMessage,\n} from '@finos/fdc3-schema/dist/generated/api/BrowserTypes';\n\ntype ListenerRegistration = {\n  appId: string;\n  instanceId: string;\n  intentName: string;\n  listenerUUID: string;\n};\n\ntype IntentRequest = {\n  intent: string;\n  context: Context;\n  requestUuid: string;\n  from: FullAppIdentifier;\n  type: 'raiseIntentResponse' | 'raiseIntentForContextResponse';\n};\n\n/**\n * Re-writes the request to forward it on to the target application\n */\nasync function forwardRequest(\n  arg0: IntentRequest,\n  to: FullAppIdentifier,\n  sc: ServerContext<AppRegistration>,\n  ih: IntentHandler\n): Promise<void> {\n  const out: IntentEvent = {\n    type: 'intentEvent',\n    payload: {\n      context: arg0.context,\n      intent: arg0.intent,\n      originatingApp: {\n        appId: arg0.from.appId,\n        instanceId: arg0.from.instanceId,\n      },\n      raiseIntentRequestUuid: arg0.requestUuid,\n    },\n    meta: {\n      eventUuid: sc.createUUID(),\n      timestamp: new Date(),\n    },\n  };\n\n  // register the resolution destination\n  ih.pendingResolutions.set(arg0.requestUuid, arg0.from);\n  await sc.post(out, to.instanceId);\n  successResponseId(\n    sc,\n    arg0.requestUuid,\n    arg0.from,\n    {\n      intentResolution: {\n        intent: arg0.intent,\n        source: { appId: to.appId, instanceId: to.instanceId }, //make sure we're not carrying any excess fields from internal state\n      },\n    },\n    arg0.type\n  );\n}\n\n/**\n * A pending intent is one for an app that hasn't registered it's intent listener yet.\n * (Possibly it is being opened)\n *\n * Pending intents wait for that registration and then message the app.\n */\nclass PendingIntent {\n  complete: boolean = false;\n  r: IntentRequest;\n  appId: AppIdentifier;\n  sc: ServerContext<AppRegistration>;\n  ih: IntentHandler;\n\n  constructor(r: IntentRequest, sc: ServerContext<AppRegistration>, ih: IntentHandler, appId: AppIdentifier) {\n    this.r = r;\n    this.appId = appId;\n    this.sc = sc;\n    this.ih = ih;\n\n    // handle the timeout\n    setTimeout(() => {\n      if (!this.complete) {\n        errorResponseId(sc, r.requestUuid, r.from, ResolveError.IntentDeliveryFailed, r.type);\n        this.ih.pendingIntents.delete(this);\n      }\n    }, ih.timeoutMs);\n  }\n\n  async accept(arg0: ListenerRegistration): Promise<void> {\n    if (\n      arg0.appId == this.appId.appId &&\n      arg0.intentName == this.r.intent &&\n      (arg0.instanceId == this.appId.instanceId || this.appId.instanceId == undefined)\n    ) {\n      this.complete = true;\n      this.ih.pendingIntents.delete(this);\n      forwardRequest(this.r, { appId: arg0.appId, instanceId: arg0.instanceId }, this.sc, this.ih);\n    }\n  }\n}\n\nexport class IntentHandler implements MessageHandler {\n  private readonly directory: Directory;\n  private registrations: ListenerRegistration[] = [];\n  readonly pendingIntents: Set<PendingIntent> = new Set();\n  readonly pendingResolutions: Map<string, FullAppIdentifier> = new Map();\n  readonly timeoutMs: number;\n\n  constructor(d: Directory, timeoutMs: number) {\n    this.directory = d;\n    this.timeoutMs = timeoutMs;\n  }\n\n  cleanup(instanceId: InstanceID /*, _sc: ServerContext<AppRegistration> */): void {\n    this.registrations = this.registrations.filter(reg => reg.instanceId != instanceId);\n    //don't clean up pendingIntents as some apps may load\n\n    //cleanup pendingResolutions\n    this.pendingResolutions.forEach((val, key) => {\n      if (val.instanceId === instanceId) {\n        this.pendingResolutions.delete(key);\n      }\n    });\n  }\n\n  shutdown(): void { }\n\n  async narrowIntents(\n    raiser: AppIdentifier,\n    appIntents: AppIntent[],\n    context: Context,\n    sc: ServerContext<AppRegistration>\n  ): Promise<AppIntent[]> {\n    const out = await sc.narrowIntents(raiser, appIntents, context);\n    return out;\n  }\n\n  async accept(msg: AppRequestMessage, sc: ServerContext<AppRegistration>, uuid: InstanceID): Promise<void> {\n    const from = sc.getInstanceDetails(uuid);\n\n    if (from == null) {\n      // this handler only deals with connected apps\n      return;\n    }\n\n    try {\n      switch (msg.type as string) {\n        // finding intents\n        case 'findIntentsByContextRequest':\n          return await this.findIntentsByContextRequest(msg as FindIntentsByContextRequest, sc, from);\n        case 'findIntentRequest':\n          return await this.findIntentRequest(msg as FindIntentRequest, sc, from);\n\n        // listeners\n        case 'addIntentListenerRequest':\n          return await this.onAddIntentListener(msg as AddIntentListenerRequest, sc, from);\n        case 'intentListenerUnsubscribeRequest':\n          return await this.onUnsubscribe(msg as IntentListenerUnsubscribeRequest, sc, from);\n\n        // raising intents and returning results\n        case 'raiseIntentRequest':\n          return await this.raiseIntentRequest(msg as RaiseIntentRequest, sc, from);\n        case 'raiseIntentForContextRequest':\n          return await this.raiseIntentForContextRequest(msg as RaiseIntentForContextRequest, sc, from);\n        case 'intentResultRequest':\n          return await this.intentResultRequest(msg as IntentResultRequest, sc, from);\n      }\n    } catch (e) {\n      const responseType = msg.type.replace(new RegExp('Request$'), 'Response') as AgentResponseMessage['type'];\n      errorResponse(sc, msg, from, (e as Error).message ?? e, responseType);\n    }\n  }\n\n  /**\n   * Called when target app handles an intent\n   */\n  intentResultRequest(\n    arg0: IntentResultRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ): void | PromiseLike<void> {\n    const requestId = arg0.payload.raiseIntentRequestUuid;\n    const to = this.pendingResolutions.get(requestId);\n    if (to) {\n      // post the result to the app that raised the intent\n      //   if its still connected, otherwise do nothing\n      successResponseId(\n        sc,\n        requestId,\n        to,\n        {\n          intentResult: arg0.payload.intentResult,\n        },\n        'raiseIntentResultResponse'\n      );\n\n      this.pendingResolutions.delete(requestId);\n    }\n    // respond to the app that handled the intent\n    successResponse(sc, arg0, from, {}, 'intentResultResponse');\n  }\n\n  onUnsubscribe(\n    arg0: IntentListenerUnsubscribeRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ): void {\n    const id = arg0.payload.listenerUUID;\n    const fi = this.registrations.findIndex(e => e.listenerUUID == id);\n    if (fi > -1) {\n      this.registrations.splice(fi, 1);\n      successResponse(sc, arg0, from, {}, 'intentListenerUnsubscribeResponse');\n    } else {\n      errorResponse(sc, arg0, from, 'Non-Existent Listener', 'intentListenerUnsubscribeResponse');\n    }\n  }\n\n  onAddIntentListener(\n    arg0: AddIntentListenerRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ): void {\n    const lr: ListenerRegistration = {\n      appId: from.appId,\n      instanceId: from.instanceId,\n      intentName: arg0.payload.intent,\n      listenerUUID: sc.createUUID(),\n    };\n\n    this.registrations.push(lr);\n    successResponse(\n      sc,\n      arg0,\n      from,\n      {\n        listenerUUID: lr.listenerUUID,\n      },\n      'addIntentListenerResponse'\n    );\n\n    // see if this intent listener is the destination for any pending intents\n    for (const x of this.pendingIntents) {\n      x.accept(lr);\n      if (x.complete) {\n        this.pendingIntents.delete(x);\n      }\n    }\n  }\n\n  hasListener(instanceId: string, intentName: string): boolean {\n    return this.registrations.find(r => r.instanceId == instanceId && r.intentName == intentName) != null;\n  }\n\n  async startWithPendingIntent(\n    arg0: IntentRequest,\n    sc: ServerContext<AppRegistration>,\n    target: AppIdentifier\n  ): Promise<void> {\n    // app exists but needs starting\n    const pi = new PendingIntent(arg0, sc, this, target);\n    this.pendingIntents.add(pi);\n    sc.open(target.appId).then(() => {\n      return undefined;\n    });\n  }\n\n  async raiseIntentRequestToSpecificInstance(\n    arg0: IntentRequest[],\n    sc: ServerContext<AppRegistration>,\n    target: FullAppIdentifier\n  ): Promise<void> {\n    if (!(await sc.isAppConnected(target.instanceId))) {\n      // instance doesn't exist\n      return errorResponseId(\n        sc,\n        arg0[0].requestUuid,\n        arg0[0].from,\n        ResolveError.TargetInstanceUnavailable,\n        arg0[0].type\n      );\n    }\n\n    const requestsWithListeners = arg0.filter(r => this.hasListener(target.instanceId, r.intent));\n\n    if (requestsWithListeners.length == 0) {\n      this.createPendingIntentIfAllowed(arg0[0], sc, target);\n    } else {\n      // ok, deliver to the current running app.\n      return forwardRequest(requestsWithListeners[0], target, sc, this);\n    }\n  }\n\n  async createPendingIntentIfAllowed(ir: IntentRequest, sc: ServerContext<AppRegistration>, target: AppIdentifier) {\n    // if this app declares that it supports the intent, we'll create a pending intent\n    const matchingIntents: DirectoryIntent[] = this.directory.retrieveIntents(ir.context.type, ir.intent, undefined);\n    const declared = matchingIntents.find(i => i.appId == target.appId);\n\n    if (declared) {\n      // maybe listener hasn't been registered yet - create a pending intent\n      const pi = new PendingIntent(ir, sc, this, target);\n      this.pendingIntents.add(pi);\n    } else {\n      errorResponseId(sc, ir.requestUuid, ir.from, ResolveError.NoAppsFound, ir.type);\n    }\n  }\n\n  async raiseIntentRequestToSpecificAppId(\n    arg0: IntentRequest[],\n    sc: ServerContext<AppRegistration>,\n    target: AppIdentifier\n  ): Promise<void> {\n\n    const appRecords = this.directory.retrieveAppsById(target.appId);\n    if (appRecords.length == 0) {\n      return errorResponseId(sc, arg0[0].requestUuid, arg0[0].from, ResolveError.TargetAppUnavailable, arg0[0].type);\n    }\n\n    const convertDirectoryIntentsToAppIntents = (intents: DirectoryIntent[], appId: string): AppIntent[] => {\n      // group by intent name\n      const intentNames = new Set(intents.map(i => i.intentName));\n      return Array.from(intentNames).map(intentName => {\n        const intentsWithName = intents.filter(i => i.intentName === intentName);\n        return {\n          intent: { name: intentName, displayName: intentName },\n          apps: intentsWithName.filter(i => i.appId === appId).map(i => ({ appId: i.appId })),\n        };\n      });\n    };\n\n    const intentsAllHaveApps = (appIntents: AppIntent[]): boolean => {\n      return appIntents.every(ai => ai.apps.length > 0);\n    }\n\n    // in this version of the method, we always open an app as no\n    // specific instance is specified.  But only if the app supports the intent.\n    const context: Context = arg0[0].context;\n    const matchingIntents: DirectoryIntent[] = this.directory.retrieveIntents(context.type, arg0[0].intent, undefined);\n    const appIntents = convertDirectoryIntentsToAppIntents(matchingIntents, target.appId);\n\n    if (appIntents.length == 0) {\n      return errorResponseId(sc, arg0[0].requestUuid, arg0[0].from, ResolveError.NoAppsFound, arg0[0].type);\n    }\n\n    if (!intentsAllHaveApps(appIntents)) {\n      return errorResponseId(sc, arg0[0].requestUuid, arg0[0].from, ResolveError.IntentDeliveryFailed, arg0[0].type);\n    }\n\n    const narrowedAppIntents = await this.narrowIntents(arg0[0].from, appIntents, context, sc);\n\n    if (narrowedAppIntents.length == 1) {\n      if (narrowedAppIntents[0].apps.length == 1) {\n        // no running instance, single app\n        const appRecords = this.directory.retrieveAppsById(target.appId);\n        if (appRecords.length >= 1) {\n          const ir: IntentRequest = {\n            ...arg0[0],\n            intent: narrowedAppIntents[0].intent.name,\n          };\n          return this.startWithPendingIntent(ir, sc, target);\n        }\n      }\n    }\n    // app doesn't exist\n    return errorResponseId(sc, arg0[0].requestUuid, arg0[0].from, ResolveError.NoAppsFound, arg0[0].type);\n  }\n\n  oneAppOnly(appIntent: AppIntent): boolean {\n    const apps = appIntent.apps.map(a => a.appId);\n    const uniqueApps = apps.filter((v, i, a) => a.indexOf(v) === i).length;\n    return uniqueApps == 1;\n  }\n\n  async raiseIntentToAnyApp(arg0: IntentRequest[], sc: ServerContext<AppRegistration>): Promise<void> {\n    const connectedApps = await sc.getConnectedApps();\n    const matchingIntents = arg0.flatMap(i => this.directory.retrieveIntents(i.context.type, i.intent, undefined));\n    const uniqueIntentNames = matchingIntents.map(i => i.intentName).filter((v, i, a) => a.indexOf(v) === i);\n\n    const appIntents: AppIntent[] = uniqueIntentNames.map(i => {\n      const directoryAppsWithIntent = matchingIntents.filter(mi => mi.intentName == i).map(mi => mi.appId);\n      const runningApps = connectedApps.filter(ca => directoryAppsWithIntent.includes(ca.appId));\n\n      return {\n        intent: {\n          name: i,\n          displayName: i,\n        },\n        apps: [\n          ...runningApps,\n          ...directoryAppsWithIntent.map(d => {\n            return { appId: d };\n          }),\n        ],\n      };\n    });\n\n    const narrowedAppIntents = await this.narrowIntents(arg0[0].from, appIntents, arg0[0].context, sc);\n\n    if (narrowedAppIntents.length == 0) {\n      // nothing can resolve the intent, fail\n      return errorResponseId(sc, arg0[0].requestUuid, arg0[0].from, ResolveError.NoAppsFound, arg0[0].type);\n    }\n\n    if (narrowedAppIntents.length == 1) {\n      const theAppIntent = narrowedAppIntents[0];\n      if (this.oneAppOnly(theAppIntent)) {\n        const instanceCount = theAppIntent.apps.filter(a => a.instanceId).length;\n        const ir: IntentRequest = {\n          ...arg0[0],\n          intent: narrowedAppIntents[0].intent.name,\n        };\n        if (instanceCount == 1 && isFullAppIdentifier(theAppIntent.apps[0])) {\n          // app is running\n          return forwardRequest(ir, theAppIntent.apps[0], sc, this);\n        } else if (instanceCount == 0) {\n          return this.startWithPendingIntent(ir, sc, theAppIntent.apps[0]);\n        }\n      }\n    }\n\n    if (arg0[0].type == 'raiseIntentResponse') {\n      // raise intent\n      return successResponseId(\n        sc,\n        arg0[0].requestUuid,\n        arg0[0].from,\n        {\n          appIntent: narrowedAppIntents[0],\n        },\n        arg0[0].type\n      );\n    } else {\n      // raise intent for context\n      return successResponseId(sc, arg0[0].requestUuid, arg0[0].from, { appIntents: narrowedAppIntents }, arg0[0].type);\n    }\n  }\n\n  async raiseIntentRequest(\n    arg0: RaiseIntentRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ): Promise<void> {\n    const intentRequest: IntentRequest = {\n      context: arg0.payload.context,\n      from,\n      intent: arg0.payload.intent,\n      requestUuid: arg0.meta.requestUuid,\n      type: 'raiseIntentResponse',\n    };\n\n    const target = arg0.payload.app;\n    if (target) {\n      if (isFullAppIdentifier(target)) {\n        return this.raiseIntentRequestToSpecificInstance([intentRequest], sc, target);\n      } else if (target.appId) {\n        return this.raiseIntentRequestToSpecificAppId([intentRequest], sc, target);\n      } else {\n        //invalid target\n        console.warn('Received an invalid target argument for raiseIntent', target, arg0);\n        return errorResponseId(\n          sc,\n          arg0.meta.requestUuid,\n          from,\n          ResolveError.TargetAppUnavailable,\n          'raiseIntentResponse'\n        );\n      }\n    } else {\n      //No target\n      return this.raiseIntentToAnyApp([intentRequest], sc);\n    }\n  }\n\n  async raiseIntentForContextRequest(\n    arg0: RaiseIntentForContextRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ): Promise<void> {\n    // dealing with a specific instance of an app\n    const mappedIntents = this.directory.retrieveIntents(arg0.payload.context.type, undefined, undefined);\n    const uniqueIntentNames = mappedIntents.filter((v, i, a) => a.findIndex(v2 => v2.intentName == v.intentName) == i);\n    const possibleIntentRequests: IntentRequest[] = uniqueIntentNames.map(i => {\n      return {\n        context: arg0.payload.context,\n        from,\n        intent: i.intentName,\n        requestUuid: arg0.meta.requestUuid,\n        type: 'raiseIntentForContextResponse',\n      };\n    });\n\n    if (possibleIntentRequests.length == 0) {\n      return errorResponseId(\n        sc,\n        arg0.meta.requestUuid,\n        from,\n        ResolveError.NoAppsFound,\n        'raiseIntentForContextResponse'\n      );\n    }\n\n    const target = arg0.payload.app;\n    if (target) {\n      if (isFullAppIdentifier(target)) {\n        return this.raiseIntentRequestToSpecificInstance(possibleIntentRequests, sc, target);\n      } else if (target.appId) {\n        return this.raiseIntentRequestToSpecificAppId(possibleIntentRequests, sc, target);\n      } else {\n        //invalid target\n        console.warn('Received an invalid target argument for raiseIntentForContext', target, arg0);\n        return errorResponseId(\n          sc,\n          arg0.meta.requestUuid,\n          from,\n          ResolveError.TargetAppUnavailable,\n          'raiseIntentForContextResponse'\n        );\n      }\n    } else {\n      //No target\n      return this.raiseIntentToAnyApp(possibleIntentRequests, sc);\n    }\n  }\n\n  async findIntentsByContextRequest(\n    r: FindIntentsByContextRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ): Promise<void> {\n    const { context, resultType } = r.payload;\n\n    const apps1 = this.directory.retrieveIntents(context?.type, undefined, resultType);\n\n    // fold apps so same intents aren't duplicated\n    const apps2: AppIntent[] = [];\n    //don't use foreach as the handling function is async and needs to process serially\n    for (let index = 0; index < apps1.length; index++) {\n      const a1 = apps1[index];\n      const existing = apps2.find(a2 => a2.intent.name == a1.intentName);\n      const runningInstances = await this.retrieveRunningInstances(a1.appId, sc);\n      if (existing) {\n        existing.apps.push({ appId: a1.appId });\n        runningInstances.forEach(ri => existing.apps.push({ appId: a1.appId, instanceId: ri.instanceId }));\n      } else {\n        const appIntent: AppIntent = {\n          intent: {\n            name: a1.intentName,\n            displayName: a1.displayName ?? a1.intentName,\n          },\n          apps: [\n            {\n              appId: a1.appId,\n            },\n          ],\n        };\n        runningInstances.forEach(ri => appIntent.apps.push({ appId: a1.appId, instanceId: ri.instanceId }));\n        apps2.push(appIntent);\n      }\n    }\n\n    successResponse(\n      sc,\n      r,\n      from,\n      {\n        appIntents: apps2,\n      },\n      'findIntentsByContextResponse'\n    );\n  }\n\n  async findIntentRequest(\n    r: FindIntentRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ): Promise<void> {\n    const { intent, context, resultType } = r.payload;\n\n    // listeners for connected applications\n    const apps2 = (await this.retrieveListeners(intent, sc)).map(lr => {\n      return {\n        appId: lr.appId,\n        instanceId: lr.instanceId,\n      };\n    }) as AppIdentifier[];\n\n    // directory entries\n    const apps1 = this.directory.retrieveApps(context?.type, intent, resultType).map(a => {\n      return {\n        appId: a.appId,\n      };\n    });\n\n    //combine the lists, no need to de-duplicate as we should return both a directory record with just appId + any instance with appId/instanceId\n    const finalApps = [...apps1, ...apps2];\n\n    // just need this for the (deprecated) display name\n    const allMatchingIntents = this.directory.retrieveIntents(context?.type, intent, resultType);\n    const displayName = allMatchingIntents.length > 0 ? allMatchingIntents[0].displayName : undefined;\n\n    successResponse(\n      sc,\n      r,\n      from,\n      {\n        appIntent: {\n          intent: {\n            name: intent,\n            displayName,\n          },\n          apps: finalApps,\n        },\n      },\n      'findIntentResponse'\n    );\n  }\n\n  async retrieveListeners(\n    intentName: string | undefined,\n    sc: ServerContext<AppRegistration>\n  ): Promise<ListenerRegistration[]> {\n    const activeApps = await sc.getConnectedApps();\n    const matching = this.registrations.filter(r => r.intentName == intentName);\n    const active = matching.filter(r => activeApps.find(a => a.instanceId == r.instanceId));\n    return active;\n  }\n\n  async retrieveRunningInstances(appId: string, sc: ServerContext<AppRegistration>) {\n    const activeApps = await sc.getConnectedApps();\n    const filteredApps = activeApps.filter(a => a.appId === appId);\n    return filteredApps;\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b5d5fdbab263f4eec101d4af8c1ea9aff93a8666","contentHash":"e50e0b656fe294223383e66eb2576640cdc3000e76623e3b8d75af80fd269dfd"},"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/OpenHandler.ts":{"path":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/OpenHandler.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":24},"end":{"line":4,"column":51}},"3":{"start":{"line":5,"column":24},"end":{"line":5,"column":55}},"4":{"start":{"line":6,"column":18},"end":{"line":6,"column":38}},"5":{"start":{"line":7,"column":23},"end":{"line":7,"column":84}},"6":{"start":{"line":9,"column":0},"end":{"line":13,"column":32}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":50}},"8":{"start":{"line":11,"column":4},"end":{"line":11,"column":70}},"9":{"start":{"line":12,"column":4},"end":{"line":12,"column":44}},"10":{"start":{"line":19,"column":12},"end":{"line":19,"column":28}},"11":{"start":{"line":20,"column":16},"end":{"line":20,"column":25}},"12":{"start":{"line":22,"column":8},"end":{"line":22,"column":31}},"13":{"start":{"line":23,"column":8},"end":{"line":23,"column":29}},"14":{"start":{"line":24,"column":8},"end":{"line":24,"column":21}},"15":{"start":{"line":25,"column":8},"end":{"line":25,"column":23}},"16":{"start":{"line":26,"column":8},"end":{"line":30,"column":22}},"17":{"start":{"line":27,"column":12},"end":{"line":29,"column":13}},"18":{"start":{"line":28,"column":16},"end":{"line":28,"column":31}},"19":{"start":{"line":33,"column":8},"end":{"line":33,"column":88}},"20":{"start":{"line":34,"column":8},"end":{"line":39,"column":27}},"21":{"start":{"line":42,"column":8},"end":{"line":42,"column":123}},"22":{"start":{"line":45,"column":8},"end":{"line":45,"column":35}},"23":{"start":{"line":46,"column":8},"end":{"line":51,"column":9}},"24":{"start":{"line":47,"column":12},"end":{"line":47,"column":52}},"25":{"start":{"line":50,"column":12},"end":{"line":50,"column":27}},"26":{"start":{"line":54,"column":8},"end":{"line":54,"column":35}},"27":{"start":{"line":55,"column":8},"end":{"line":55,"column":25}},"28":{"start":{"line":60,"column":14},"end":{"line":60,"column":23}},"29":{"start":{"line":63,"column":8},"end":{"line":63,"column":27}},"30":{"start":{"line":64,"column":8},"end":{"line":64,"column":35}},"31":{"start":{"line":71,"column":8},"end":{"line":104,"column":9}},"32":{"start":{"line":72,"column":12},"end":{"line":72,"column":54}},"33":{"start":{"line":74,"column":13},"end":{"line":104,"column":9}},"34":{"start":{"line":77,"column":12},"end":{"line":77,"column":64}},"35":{"start":{"line":80,"column":25},"end":{"line":80,"column":52}},"36":{"start":{"line":81,"column":12},"end":{"line":103,"column":13}},"37":{"start":{"line":82,"column":16},"end":{"line":99,"column":17}},"38":{"start":{"line":83,"column":20},"end":{"line":94,"column":21}},"39":{"start":{"line":84,"column":24},"end":{"line":84,"column":56}},"40":{"start":{"line":86,"column":25},"end":{"line":94,"column":21}},"41":{"start":{"line":87,"column":24},"end":{"line":87,"column":65}},"42":{"start":{"line":89,"column":25},"end":{"line":94,"column":21}},"43":{"start":{"line":90,"column":24},"end":{"line":90,"column":66}},"44":{"start":{"line":92,"column":25},"end":{"line":94,"column":21}},"45":{"start":{"line":93,"column":24},"end":{"line":93,"column":59}},"46":{"start":{"line":97,"column":41},"end":{"line":97,"column":93}},"47":{"start":{"line":98,"column":20},"end":{"line":98,"column":94}},"48":{"start":{"line":102,"column":16},"end":{"line":102,"column":90}},"49":{"start":{"line":110,"column":28},"end":{"line":110,"column":50}},"50":{"start":{"line":111,"column":8},"end":{"line":136,"column":9}},"51":{"start":{"line":112,"column":32},"end":{"line":112,"column":56}},"52":{"start":{"line":113,"column":12},"end":{"line":135,"column":13}},"53":{"start":{"line":114,"column":16},"end":{"line":134,"column":17}},"54":{"start":{"line":116,"column":36},"end":{"line":130,"column":21}},"55":{"start":{"line":131,"column":20},"end":{"line":131,"column":42}},"56":{"start":{"line":132,"column":20},"end":{"line":132,"column":46}},"57":{"start":{"line":133,"column":20},"end":{"line":133,"column":43}},"58":{"start":{"line":139,"column":8},"end":{"line":149,"column":10}},"59":{"start":{"line":152,"column":22},"end":{"line":152,"column":38}},"60":{"start":{"line":153,"column":24},"end":{"line":153,"column":68}},"61":{"start":{"line":154,"column":8},"end":{"line":161,"column":9}},"62":{"start":{"line":155,"column":12},"end":{"line":157,"column":41}},"63":{"start":{"line":160,"column":12},"end":{"line":160,"column":134}},"64":{"start":{"line":164,"column":22},"end":{"line":164,"column":44}},"65":{"start":{"line":165,"column":25},"end":{"line":165,"column":52}},"66":{"start":{"line":166,"column":25},"end":{"line":173,"column":10}},"67":{"start":{"line":167,"column":25},"end":{"line":167,"column":41}},"68":{"start":{"line":169,"column":12},"end":{"line":172,"column":14}},"69":{"start":{"line":174,"column":8},"end":{"line":176,"column":36}},"70":{"start":{"line":179,"column":23},"end":{"line":179,"column":39}},"71":{"start":{"line":180,"column":24},"end":{"line":180,"column":44}},"72":{"start":{"line":181,"column":8},"end":{"line":187,"column":9}},"73":{"start":{"line":182,"column":25},"end":{"line":182,"column":52}},"74":{"start":{"line":183,"column":12},"end":{"line":183,"column":92}},"75":{"start":{"line":186,"column":12},"end":{"line":186,"column":89}},"76":{"start":{"line":190,"column":29},"end":{"line":193,"column":10}},"77":{"start":{"line":194,"column":8},"end":{"line":196,"column":30}},"78":{"start":{"line":199,"column":28},"end":{"line":199,"column":120}},"79":{"start":{"line":200,"column":8},"end":{"line":210,"column":10}},"80":{"start":{"line":213,"column":29},"end":{"line":216,"column":9}},"81":{"start":{"line":217,"column":28},"end":{"line":226,"column":9}},"82":{"start":{"line":218,"column":24},"end":{"line":224,"column":13}},"83":{"start":{"line":225,"column":12},"end":{"line":225,"column":31}},"84":{"start":{"line":227,"column":30},"end":{"line":240,"column":9}},"85":{"start":{"line":228,"column":33},"end":{"line":228,"column":90}},"86":{"start":{"line":229,"column":24},"end":{"line":238,"column":13}},"87":{"start":{"line":239,"column":12},"end":{"line":239,"column":37}},"88":{"start":{"line":241,"column":8},"end":{"line":256,"column":9}},"89":{"start":{"line":243,"column":12},"end":{"line":243,"column":83}},"90":{"start":{"line":244,"column":32},"end":{"line":244,"column":80}},"91":{"start":{"line":245,"column":12},"end":{"line":255,"column":13}},"92":{"start":{"line":247,"column":16},"end":{"line":247,"column":131}},"93":{"start":{"line":248,"column":16},"end":{"line":248,"column":57}},"94":{"start":{"line":249,"column":16},"end":{"line":249,"column":70}},"95":{"start":{"line":250,"column":16},"end":{"line":250,"column":80}},"96":{"start":{"line":254,"column":16},"end":{"line":254,"column":113}},"97":{"start":{"line":258,"column":28},"end":{"line":258,"column":55}},"98":{"start":{"line":259,"column":8},"end":{"line":272,"column":9}},"99":{"start":{"line":260,"column":12},"end":{"line":260,"column":84}},"100":{"start":{"line":261,"column":12},"end":{"line":261,"column":69}},"101":{"start":{"line":263,"column":32},"end":{"line":263,"column":54}},"102":{"start":{"line":264,"column":12},"end":{"line":268,"column":13}},"103":{"start":{"line":265,"column":16},"end":{"line":267,"column":17}},"104":{"start":{"line":266,"column":20},"end":{"line":266,"column":55}},"105":{"start":{"line":271,"column":12},"end":{"line":271,"column":26}},"106":{"start":{"line":275,"column":0},"end":{"line":275,"column":34}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":1},"end":{"line":9,"column":2}},"loc":{"start":{"line":9,"column":21},"end":{"line":13,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":53},"end":{"line":31,"column":5}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":19},"end":{"line":26,"column":20}},"loc":{"start":{"line":26,"column":25},"end":{"line":30,"column":9}},"line":26},"3":{"name":"(anonymous_3)","decl":{"start":{"line":32,"column":4},"end":{"line":32,"column":5}},"loc":{"start":{"line":32,"column":16},"end":{"line":40,"column":5}},"line":32},"4":{"name":"(anonymous_4)","decl":{"start":{"line":41,"column":4},"end":{"line":41,"column":5}},"loc":{"start":{"line":41,"column":14},"end":{"line":43,"column":5}},"line":41},"5":{"name":"(anonymous_5)","decl":{"start":{"line":44,"column":4},"end":{"line":44,"column":5}},"loc":{"start":{"line":44,"column":25},"end":{"line":52,"column":5}},"line":44},"6":{"name":"(anonymous_6)","decl":{"start":{"line":53,"column":4},"end":{"line":53,"column":5}},"loc":{"start":{"line":53,"column":14},"end":{"line":56,"column":5}},"line":53},"7":{"name":"(anonymous_7)","decl":{"start":{"line":62,"column":4},"end":{"line":62,"column":5}},"loc":{"start":{"line":62,"column":30},"end":{"line":65,"column":5}},"line":62},"8":{"name":"(anonymous_8)","decl":{"start":{"line":66,"column":4},"end":{"line":66,"column":5}},"loc":{"start":{"line":66,"column":77},"end":{"line":68,"column":5}},"line":66},"9":{"name":"(anonymous_9)","decl":{"start":{"line":69,"column":4},"end":{"line":69,"column":5}},"loc":{"start":{"line":69,"column":15},"end":{"line":69,"column":18}},"line":69},"10":{"name":"(anonymous_10)","decl":{"start":{"line":70,"column":4},"end":{"line":70,"column":5}},"loc":{"start":{"line":70,"column":32},"end":{"line":105,"column":5}},"line":70},"11":{"name":"(anonymous_11)","decl":{"start":{"line":109,"column":4},"end":{"line":109,"column":5}},"loc":{"start":{"line":109,"column":45},"end":{"line":137,"column":5}},"line":109},"12":{"name":"(anonymous_12)","decl":{"start":{"line":138,"column":4},"end":{"line":138,"column":5}},"loc":{"start":{"line":138,"column":37},"end":{"line":150,"column":5}},"line":138},"13":{"name":"(anonymous_13)","decl":{"start":{"line":151,"column":4},"end":{"line":151,"column":5}},"loc":{"start":{"line":151,"column":35},"end":{"line":162,"column":5}},"line":151},"14":{"name":"(anonymous_14)","decl":{"start":{"line":163,"column":4},"end":{"line":163,"column":5}},"loc":{"start":{"line":163,"column":40},"end":{"line":177,"column":5}},"line":163},"15":{"name":"(anonymous_15)","decl":{"start":{"line":167,"column":20},"end":{"line":167,"column":21}},"loc":{"start":{"line":167,"column":25},"end":{"line":167,"column":41}},"line":167},"16":{"name":"(anonymous_16)","decl":{"start":{"line":168,"column":17},"end":{"line":168,"column":18}},"loc":{"start":{"line":168,"column":22},"end":{"line":173,"column":9}},"line":168},"17":{"name":"(anonymous_17)","decl":{"start":{"line":178,"column":4},"end":{"line":178,"column":5}},"loc":{"start":{"line":178,"column":31},"end":{"line":188,"column":5}},"line":178},"18":{"name":"(anonymous_18)","decl":{"start":{"line":189,"column":4},"end":{"line":189,"column":5}},"loc":{"start":{"line":189,"column":34},"end":{"line":197,"column":5}},"line":189},"19":{"name":"(anonymous_19)","decl":{"start":{"line":198,"column":4},"end":{"line":198,"column":5}},"loc":{"start":{"line":198,"column":47},"end":{"line":211,"column":5}},"line":198},"20":{"name":"(anonymous_20)","decl":{"start":{"line":212,"column":4},"end":{"line":212,"column":5}},"loc":{"start":{"line":212,"column":41},"end":{"line":273,"column":5}},"line":212},"21":{"name":"(anonymous_21)","decl":{"start":{"line":217,"column":28},"end":{"line":217,"column":29}},"loc":{"start":{"line":217,"column":34},"end":{"line":226,"column":9}},"line":217},"22":{"name":"(anonymous_22)","decl":{"start":{"line":227,"column":30},"end":{"line":227,"column":31}},"loc":{"start":{"line":227,"column":53},"end":{"line":240,"column":9}},"line":227}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":3},"end":{"line":13,"column":30}},"type":"binary-expr","locations":[{"start":{"line":13,"column":3},"end":{"line":13,"column":11}},{"start":{"line":13,"column":16},"end":{"line":13,"column":29}}],"line":13},"1":{"loc":{"start":{"line":27,"column":12},"end":{"line":29,"column":13}},"type":"if","locations":[{"start":{"line":27,"column":12},"end":{"line":29,"column":13}},{"start":{},"end":{}}],"line":27},"2":{"loc":{"start":{"line":46,"column":8},"end":{"line":51,"column":9}},"type":"if","locations":[{"start":{"line":46,"column":8},"end":{"line":51,"column":9}},{"start":{"line":49,"column":13},"end":{"line":51,"column":9}}],"line":46},"3":{"loc":{"start":{"line":71,"column":8},"end":{"line":104,"column":9}},"type":"if","locations":[{"start":{"line":71,"column":8},"end":{"line":104,"column":9}},{"start":{"line":74,"column":13},"end":{"line":104,"column":9}}],"line":71},"4":{"loc":{"start":{"line":74,"column":13},"end":{"line":104,"column":9}},"type":"if","locations":[{"start":{"line":74,"column":13},"end":{"line":104,"column":9}},{"start":{"line":79,"column":13},"end":{"line":104,"column":9}}],"line":74},"5":{"loc":{"start":{"line":81,"column":12},"end":{"line":103,"column":13}},"type":"if","locations":[{"start":{"line":81,"column":12},"end":{"line":103,"column":13}},{"start":{"line":101,"column":17},"end":{"line":103,"column":13}}],"line":81},"6":{"loc":{"start":{"line":83,"column":20},"end":{"line":94,"column":21}},"type":"if","locations":[{"start":{"line":83,"column":20},"end":{"line":94,"column":21}},{"start":{"line":86,"column":25},"end":{"line":94,"column":21}}],"line":83},"7":{"loc":{"start":{"line":86,"column":25},"end":{"line":94,"column":21}},"type":"if","locations":[{"start":{"line":86,"column":25},"end":{"line":94,"column":21}},{"start":{"line":89,"column":25},"end":{"line":94,"column":21}}],"line":86},"8":{"loc":{"start":{"line":89,"column":25},"end":{"line":94,"column":21}},"type":"if","locations":[{"start":{"line":89,"column":25},"end":{"line":94,"column":21}},{"start":{"line":92,"column":25},"end":{"line":94,"column":21}}],"line":89},"9":{"loc":{"start":{"line":92,"column":25},"end":{"line":94,"column":21}},"type":"if","locations":[{"start":{"line":92,"column":25},"end":{"line":94,"column":21}},{"start":{},"end":{}}],"line":92},"10":{"loc":{"start":{"line":98,"column":64},"end":{"line":98,"column":78}},"type":"binary-expr","locations":[{"start":{"line":98,"column":64},"end":{"line":98,"column":73}},{"start":{"line":98,"column":77},"end":{"line":98,"column":78}}],"line":98},"11":{"loc":{"start":{"line":111,"column":8},"end":{"line":136,"column":9}},"type":"if","locations":[{"start":{"line":111,"column":8},"end":{"line":136,"column":9}},{"start":{},"end":{}}],"line":111},"12":{"loc":{"start":{"line":113,"column":12},"end":{"line":135,"column":13}},"type":"if","locations":[{"start":{"line":113,"column":12},"end":{"line":135,"column":13}},{"start":{},"end":{}}],"line":113},"13":{"loc":{"start":{"line":113,"column":16},"end":{"line":113,"column":86}},"type":"binary-expr","locations":[{"start":{"line":113,"column":16},"end":{"line":113,"column":35}},{"start":{"line":113,"column":39},"end":{"line":113,"column":86}}],"line":113},"14":{"loc":{"start":{"line":114,"column":16},"end":{"line":134,"column":17}},"type":"if","locations":[{"start":{"line":114,"column":16},"end":{"line":134,"column":17}},{"start":{},"end":{}}],"line":114},"15":{"loc":{"start":{"line":114,"column":20},"end":{"line":114,"column":87}},"type":"binary-expr","locations":[{"start":{"line":114,"column":20},"end":{"line":114,"column":59}},{"start":{"line":114,"column":63},"end":{"line":114,"column":87}}],"line":114},"16":{"loc":{"start":{"line":154,"column":8},"end":{"line":161,"column":9}},"type":"if","locations":[{"start":{"line":154,"column":8},"end":{"line":161,"column":9}},{"start":{"line":159,"column":13},"end":{"line":161,"column":9}}],"line":154},"17":{"loc":{"start":{"line":186,"column":57},"end":{"line":186,"column":71}},"type":"binary-expr","locations":[{"start":{"line":186,"column":57},"end":{"line":186,"column":66}},{"start":{"line":186,"column":70},"end":{"line":186,"column":71}}],"line":186},"18":{"loc":{"start":{"line":241,"column":8},"end":{"line":256,"column":9}},"type":"if","locations":[{"start":{"line":241,"column":8},"end":{"line":256,"column":9}},{"start":{},"end":{}}],"line":241},"19":{"loc":{"start":{"line":245,"column":12},"end":{"line":255,"column":13}},"type":"if","locations":[{"start":{"line":245,"column":12},"end":{"line":255,"column":13}},{"start":{"line":252,"column":17},"end":{"line":255,"column":13}}],"line":245},"20":{"loc":{"start":{"line":259,"column":8},"end":{"line":272,"column":9}},"type":"if","locations":[{"start":{"line":259,"column":8},"end":{"line":272,"column":9}},{"start":{"line":270,"column":13},"end":{"line":272,"column":9}}],"line":259},"21":{"loc":{"start":{"line":264,"column":12},"end":{"line":268,"column":13}},"type":"if","locations":[{"start":{"line":264,"column":12},"end":{"line":268,"column":13}},{"start":{},"end":{}}],"line":264},"22":{"loc":{"start":{"line":265,"column":16},"end":{"line":267,"column":17}},"type":"if","locations":[{"start":{"line":265,"column":16},"end":{"line":267,"column":17}},{"start":{},"end":{}}],"line":265}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":4,"11":4,"12":4,"13":4,"14":4,"15":4,"16":4,"17":4,"18":1,"19":3,"20":3,"21":1,"22":4,"23":4,"24":2,"25":2,"26":3,"27":3,"28":176,"29":176,"30":176,"31":260,"32":14,"33":246,"34":19,"35":227,"36":227,"37":227,"38":227,"39":5,"40":222,"41":2,"42":220,"43":2,"44":218,"45":1,"46":0,"47":0,"48":0,"49":19,"50":19,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":15,"59":2,"60":2,"61":2,"62":1,"63":1,"64":2,"65":2,"66":2,"67":4,"68":2,"69":2,"70":5,"71":5,"72":5,"73":5,"74":4,"75":1,"76":1,"77":1,"78":14,"79":14,"80":14,"81":14,"82":1,"83":1,"84":14,"85":13,"86":13,"87":13,"88":14,"89":2,"90":2,"91":2,"92":1,"93":1,"94":1,"95":1,"96":1,"97":13,"98":13,"99":12,"100":12,"101":12,"102":12,"103":4,"104":4,"105":1,"106":1},"f":{"0":1,"1":4,"2":4,"3":3,"4":1,"5":4,"6":3,"7":176,"8":6,"9":3,"10":260,"11":19,"12":15,"13":2,"14":2,"15":4,"16":2,"17":5,"18":1,"19":14,"20":14,"21":1,"22":13},"b":{"0":[1,1],"1":[1,3],"2":[2,2],"3":[14,246],"4":[19,227],"5":[227,0],"6":[5,222],"7":[2,220],"8":[2,218],"9":[1,217],"10":[0,0],"11":[1,18],"12":[1,0],"13":[1,1],"14":[1,0],"15":[1,0],"16":[1,1],"17":[1,0],"18":[2,12],"19":[1,1],"20":[12,1],"21":[4,8],"22":[4,0]},"inputSourceMap":{"version":3,"file":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/OpenHandler.ts","sources":["/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/OpenHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { MessageHandler } from '../BasicFDC3Server';\nimport { AppRegistration, InstanceID, ServerContext, State } from '../ServerContext';\nimport { Directory, DirectoryApp } from '../directory/DirectoryInterface';\nimport { ContextElement } from '@finos/fdc3-context';\nimport { OpenError, ResolveError, AppIdentifier, AppMetadata, ImplementationMetadata } from '@finos/fdc3-standard';\nimport { BrowserTypes } from '@finos/fdc3-schema';\nimport { errorResponse, FullAppIdentifier, successResponse } from './support';\nimport {\n  AgentResponseMessage,\n  AppRequestMessage,\n  GetInfoRequest,\n  isAddContextListenerRequest,\n  isFindInstancesRequest,\n  isGetAppMetadataRequest,\n  isGetInfoRequest,\n  isOpenRequest,\n  isWebConnectionProtocol4ValidateAppIdentity,\n} from '@finos/fdc3-schema/dist/generated/api/BrowserTypes';\n\ntype BroadcastEvent = BrowserTypes.BroadcastEvent;\ntype AddContextListenerRequest = BrowserTypes.AddContextListenerRequest;\ntype FindInstancesRequest = BrowserTypes.FindInstancesRequest;\ntype GetAppMetadataRequest = BrowserTypes.GetAppMetadataRequest;\ntype OpenRequest = BrowserTypes.OpenRequest;\ntype WebConnectionProtocol4ValidateAppIdentity = BrowserTypes.WebConnectionProtocol4ValidateAppIdentity;\ntype WebConnectionProtocol5ValidateAppIdentityFailedResponse =\n  BrowserTypes.WebConnectionProtocol5ValidateAppIdentityFailedResponse;\ntype WebConnectionProtocol5ValidateAppIdentitySuccessResponse =\n  BrowserTypes.WebConnectionProtocol5ValidateAppIdentitySuccessResponse;\n\nenum AppState {\n  Opening,\n  DeliveringContext,\n  Done,\n}\n\nclass PendingApp {\n  private readonly sc: ServerContext<AppRegistration>;\n  private readonly msg: OpenRequest;\n  readonly context: ContextElement | undefined;\n  readonly source: FullAppIdentifier;\n  state: AppState = AppState.Opening;\n  private openedApp: AppIdentifier | undefined = undefined;\n\n  constructor(\n    sc: ServerContext<AppRegistration>,\n    msg: OpenRequest,\n    context: ContextElement | undefined,\n    source: FullAppIdentifier,\n    timeoutMs: number\n  ) {\n    this.context = context;\n    this.source = source;\n    this.sc = sc;\n    this.msg = msg;\n\n    setTimeout(() => {\n      if (this.state != AppState.Done) {\n        this.onError();\n      }\n    }, timeoutMs);\n  }\n\n  private onSuccess() {\n    this.sc.setAppState(this.openedApp!.instanceId!, State.Connected);\n    successResponse(\n      this.sc,\n      this.msg,\n      this.source,\n      {\n        appIdentifier: {\n          appId: this.openedApp!.appId,\n          instanceId: this.openedApp!.instanceId,\n        },\n      },\n      'openResponse'\n    );\n  }\n\n  private onError() {\n    errorResponse(this.sc, this.msg, this.source, OpenError.AppTimeout, 'openResponse');\n  }\n\n  setOpened(openedApp: AppIdentifier) {\n    this.openedApp = openedApp;\n    if (this.context) {\n      this.state = AppState.DeliveringContext;\n    } else {\n      this.setDone();\n    }\n  }\n\n  setDone() {\n    this.state = AppState.Done;\n    this.onSuccess();\n  }\n}\n\nexport class OpenHandler implements MessageHandler {\n  private readonly directory: Directory;\n  readonly pending: Map<InstanceID, PendingApp> = new Map();\n  readonly timeoutMs: number;\n\n  constructor(d: Directory, timeoutMs: number) {\n    this.directory = d;\n    this.timeoutMs = timeoutMs;\n  }\n\n  cleanup(/*instanceId: InstanceID, sc: ServerContext<AppRegistration>*/): void {\n    //don't cleanup pending if the opening app closes as we should still deliver context\n  }\n\n  shutdown(): void {}\n\n  async accept(\n    msg: AppRequestMessage | WebConnectionProtocol4ValidateAppIdentity,\n    sc: ServerContext<AppRegistration>,\n    uuid: InstanceID\n  ): Promise<void> {\n    if (isWebConnectionProtocol4ValidateAppIdentity(msg)) {\n      return this.handleValidate(msg as WebConnectionProtocol4ValidateAppIdentity, sc, uuid);\n    } else if (isAddContextListenerRequest(msg)) {\n      //handle context listener adds for pending applications (i.e. opened but awaiting context listener addition to deliver context)\n      //  additional handling is performed in BroadcastHandler\n      return this.handleAddContextListener(msg as AddContextListenerRequest, sc, uuid);\n    } else {\n      const from = sc.getInstanceDetails(uuid);\n      if (from) {\n        try {\n          if (isOpenRequest(msg)) {\n            return this.open(msg, sc, from);\n          } else if (isFindInstancesRequest(msg)) {\n            return this.findInstances(msg, sc, from);\n          } else if (isGetAppMetadataRequest(msg)) {\n            return this.getAppMetadata(msg, sc, from);\n          } else if (isGetInfoRequest(msg)) {\n            return this.getInfo(msg, sc, from);\n          }\n        } catch (e) {\n          const responseType = msg.type.replace(new RegExp('Request$'), 'Response') as AgentResponseMessage['type'];\n          errorResponse(sc, msg, from, (e as Error).message ?? e, responseType);\n        }\n      } else {\n        console.warn('Received message from unknown source, ignoring', msg, uuid);\n      }\n    }\n  }\n\n  /**\n   * This deals with sending pending context to listeners of newly-opened apps.\n   */\n  handleAddContextListener(\n    arg0: AddContextListenerRequest,\n    sc: ServerContext<AppRegistration>,\n    from: InstanceID\n  ): void {\n    const pendingOpen = this.pending.get(from);\n    if (pendingOpen) {\n      const contextType = arg0.payload.contextType;\n      if (pendingOpen.context && pendingOpen.state == AppState.DeliveringContext) {\n        if (contextType == pendingOpen.context.type || contextType == undefined) {\n          // ok, we can deliver to this listener\n          const message: BroadcastEvent = {\n            meta: {\n              eventUuid: sc.createUUID(),\n              timestamp: new Date(),\n            },\n            type: 'broadcastEvent',\n            payload: {\n              channelId: null,\n              context: pendingOpen.context,\n              originatingApp: {\n                appId: pendingOpen.source.appId,\n                instanceId: pendingOpen.source.instanceId,\n              },\n            },\n          };\n\n          pendingOpen.setDone();\n          this.pending.delete(from);\n          sc.post(message, from);\n        }\n      }\n    }\n  }\n\n  filterPublicDetails(appD: DirectoryApp, appID: AppIdentifier): AppMetadata {\n    return {\n      appId: appD.appId,\n      name: appD.name,\n      version: appD.version,\n      title: appD.title,\n      tooltip: appD.tooltip,\n      description: appD.description,\n      icons: appD.icons,\n      screenshots: appD.screenshots,\n      instanceId: appID.instanceId,\n    };\n  }\n\n  getAppMetadata(arg0: GetAppMetadataRequest, sc: ServerContext<AppRegistration>, from: FullAppIdentifier): void {\n    const appID = arg0.payload.app;\n    const details = this.directory.retrieveAppsById(appID.appId);\n    if (details.length > 0) {\n      successResponse(\n        sc,\n        arg0,\n        from,\n        {\n          appMetadata: this.filterPublicDetails(details[0], appID),\n        },\n        'getAppMetadataResponse'\n      );\n    } else {\n      errorResponse(sc, arg0, from, ResolveError.TargetAppUnavailable, 'getAppMetadataResponse');\n    }\n  }\n\n  async findInstances(\n    arg0: FindInstancesRequest,\n    sc: ServerContext<AppRegistration>,\n    from: FullAppIdentifier\n  ): Promise<void> {\n    const appId = arg0.payload.app.appId;\n    const openApps = await sc.getConnectedApps();\n    const matching = openApps\n      .filter(a => a.appId == appId)\n      .map(a => {\n        return {\n          appId: a.appId,\n          instanceId: a.instanceId,\n        };\n      });\n    successResponse(\n      sc,\n      arg0,\n      from,\n      {\n        appIdentifiers: matching,\n      },\n      'findInstancesResponse'\n    );\n  }\n\n  async open(arg0: OpenRequest, sc: ServerContext<AppRegistration>, from: FullAppIdentifier): Promise<void> {\n    const toOpen = arg0.payload.app;\n    const context = arg0.payload.context;\n\n    try {\n      const uuid = await sc.open(toOpen.appId);\n      this.pending.set(uuid, new PendingApp(sc, arg0, context, from, this.timeoutMs));\n    } catch (e) {\n      errorResponse(sc, arg0, from, (e as Error).message ?? e, 'openResponse');\n    }\n  }\n\n  async getInfo(arg0: GetInfoRequest, sc: ServerContext<AppRegistration>, from: FullAppIdentifier): Promise<void> {\n    const implMetadata: ImplementationMetadata = this.getImplementationMetadata(sc, {\n      appId: from.appId,\n      instanceId: from.instanceId,\n    });\n    successResponse(\n      sc,\n      arg0,\n      from,\n      {\n        implementationMetadata: implMetadata,\n      },\n      'getInfoResponse'\n    );\n  }\n\n  getImplementationMetadata(sc: ServerContext<AppRegistration>, appIdentity: AppIdentifier) {\n    const appMetadata = this.filterPublicDetails(this.directory.retrieveAppsById(appIdentity.appId)[0], appIdentity);\n    return {\n      provider: sc.provider(),\n      providerVersion: sc.providerVersion(),\n      fdc3Version: sc.fdc3Version(),\n      optionalFeatures: {\n        DesktopAgentBridging: false,\n        OriginatingAppMetadata: true,\n        UserChannelMembershipAPIs: true,\n      },\n      appMetadata: appMetadata,\n    };\n  }\n\n  async handleValidate(\n    arg0: WebConnectionProtocol4ValidateAppIdentity,\n    sc: ServerContext<AppRegistration>,\n    from: InstanceID\n  ): Promise<void> {\n    const responseMeta = {\n      connectionAttemptUuid: arg0.meta.connectionAttemptUuid,\n      timestamp: new Date(),\n    };\n\n    const returnError = () => {\n      const msg: WebConnectionProtocol5ValidateAppIdentityFailedResponse = {\n        meta: responseMeta,\n        type: 'WCP5ValidateAppIdentityFailedResponse',\n        payload: {\n          message: 'App Instance not found',\n        },\n      };\n      sc.post(msg, from);\n    };\n\n    const returnSuccess = (appId: string, instanceId: string) => {\n      const implMetadata: ImplementationMetadata = this.getImplementationMetadata(sc, { appId, instanceId });\n      const msg: WebConnectionProtocol5ValidateAppIdentitySuccessResponse = {\n        meta: responseMeta,\n        type: 'WCP5ValidateAppIdentityResponse',\n        payload: {\n          appId: appId,\n          instanceId: instanceId,\n          instanceUuid: from,\n          implementationMetadata: implMetadata,\n        },\n      };\n      sc.post(msg, instanceId);\n    };\n\n    if (arg0.payload.instanceUuid) {\n      // existing app reconnecting\n      console.log('App attempting to reconnect:', arg0.payload.instanceUuid);\n      const appIdentity = sc.getInstanceDetails(arg0.payload.instanceUuid);\n\n      if (appIdentity) {\n        // in this case, the app is reconnecting, so let's just re-assign the identity\n        console.log(\n          `Reassigned existing identity, appId: `,\n          appIdentity.appId,\n          ', instanceId',\n          arg0.payload.instanceUuid\n        );\n        sc.setInstanceDetails(from, appIdentity);\n        sc.setAppState(from, State.Connected);\n        return returnSuccess(appIdentity.appId, appIdentity.instanceId);\n      } else {\n        //we didn't find the identity, assign a new one\n        console.log('Existing identity not found for, assigning a new one: ', arg0.payload.instanceUuid);\n      }\n    }\n\n    // we need to assign an identity to this app - this should have been generated when it was launched\n    const appIdentity = sc.getInstanceDetails(from);\n    if (appIdentity) {\n      sc.setAppState(appIdentity.instanceId, State.Connected);\n      returnSuccess(appIdentity.appId, appIdentity.instanceId);\n\n      // make sure, if the opener is listening for this app to open, then it gets informed\n      const pendingOpen = this.pending.get(from);\n      if (pendingOpen) {\n        if (pendingOpen.state == AppState.Opening) {\n          pendingOpen.setOpened(appIdentity);\n        }\n      }\n    } else {\n      returnError();\n    }\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"48cc9b10355cbcf8207e50375709ef427c028ed3","contentHash":"50cf5f7543339639587c0cc42e105b131efca41a4051f104e6966dddb54af1b0"},"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/HeartbeatHandler.ts":{"path":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/HeartbeatHandler.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":34}},"2":{"start":{"line":4,"column":24},"end":{"line":4,"column":51}},"3":{"start":{"line":6,"column":4},"end":{"line":20,"column":5}},"4":{"start":{"line":7,"column":8},"end":{"line":7,"column":25}},"5":{"start":{"line":10,"column":8},"end":{"line":19,"column":9}},"6":{"start":{"line":12,"column":16},"end":{"line":12,"column":33}},"7":{"start":{"line":14,"column":16},"end":{"line":14,"column":35}},"8":{"start":{"line":16,"column":16},"end":{"line":16,"column":40}},"9":{"start":{"line":18,"column":16},"end":{"line":18,"column":36}},"10":{"start":{"line":26,"column":15},"end":{"line":26,"column":17}},"11":{"start":{"line":27,"column":21},"end":{"line":27,"column":30}},"12":{"start":{"line":30,"column":8},"end":{"line":65,"column":25}},"13":{"start":{"line":31,"column":12},"end":{"line":64,"column":15}},"14":{"start":{"line":32,"column":29},"end":{"line":32,"column":50}},"15":{"start":{"line":33,"column":16},"end":{"line":63,"column":19}},"16":{"start":{"line":34,"column":35},"end":{"line":34,"column":131}},"17":{"start":{"line":36,"column":32},"end":{"line":36,"column":52}},"18":{"start":{"line":37,"column":20},"end":{"line":37,"column":48}},"19":{"start":{"line":39,"column":42},"end":{"line":39,"column":81}},"20":{"start":{"line":40,"column":41},"end":{"line":40,"column":50}},"21":{"start":{"line":41,"column":20},"end":{"line":62,"column":21}},"22":{"start":{"line":42,"column":55},"end":{"line":42,"column":74}},"23":{"start":{"line":43,"column":24},"end":{"line":57,"column":25}},"24":{"start":{"line":44,"column":28},"end":{"line":44,"column":140}},"25":{"start":{"line":45,"column":28},"end":{"line":45,"column":92}},"26":{"start":{"line":47,"column":29},"end":{"line":57,"column":25}},"27":{"start":{"line":48,"column":28},"end":{"line":48,"column":148}},"28":{"start":{"line":49,"column":28},"end":{"line":49,"column":96}},"29":{"start":{"line":51,"column":29},"end":{"line":57,"column":25}},"30":{"start":{"line":52,"column":28},"end":{"line":52,"column":144}},"31":{"start":{"line":53,"column":28},"end":{"line":53,"column":93}},"32":{"start":{"line":61,"column":24},"end":{"line":61,"column":69}},"33":{"start":{"line":72,"column":20},"end":{"line":72,"column":40}},"34":{"start":{"line":73,"column":8},"end":{"line":81,"column":50}},"35":{"start":{"line":75,"column":12},"end":{"line":79,"column":14}},"36":{"start":{"line":78,"column":61},"end":{"line":78,"column":88}},"37":{"start":{"line":78,"column":107},"end":{"line":78,"column":113}},"38":{"start":{"line":81,"column":25},"end":{"line":81,"column":48}},"39":{"start":{"line":84,"column":8},"end":{"line":84,"column":42}},"40":{"start":{"line":87,"column":8},"end":{"line":89,"column":9}},"41":{"start":{"line":88,"column":12},"end":{"line":88,"column":35}},"42":{"start":{"line":90,"column":8},"end":{"line":95,"column":9}},"43":{"start":{"line":91,"column":24},"end":{"line":91,"column":51}},"44":{"start":{"line":92,"column":12},"end":{"line":94,"column":13}},"45":{"start":{"line":93,"column":16},"end":{"line":93,"column":78}},"46":{"start":{"line":96,"column":8},"end":{"line":101,"column":9}},"47":{"start":{"line":97,"column":24},"end":{"line":97,"column":51}},"48":{"start":{"line":98,"column":12},"end":{"line":100,"column":13}},"49":{"start":{"line":99,"column":16},"end":{"line":99,"column":71}},"50":{"start":{"line":104,"column":22},"end":{"line":111,"column":9}},"51":{"start":{"line":112,"column":8},"end":{"line":112,"column":39}},"52":{"start":{"line":115,"column":0},"end":{"line":115,"column":44}}},"fnMap":{"0":{"name":"convertToText","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":22}},"loc":{"start":{"line":5,"column":26},"end":{"line":21,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":82},"end":{"line":66,"column":5}},"line":29},"2":{"name":"(anonymous_2)","decl":{"start":{"line":30,"column":41},"end":{"line":30,"column":42}},"loc":{"start":{"line":30,"column":47},"end":{"line":65,"column":9}},"line":30},"3":{"name":"(anonymous_3)","decl":{"start":{"line":31,"column":34},"end":{"line":31,"column":35}},"loc":{"start":{"line":31,"column":48},"end":{"line":64,"column":13}},"line":31},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":28},"end":{"line":34,"column":29}},"loc":{"start":{"line":34,"column":35},"end":{"line":34,"column":131}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":35,"column":29},"end":{"line":35,"column":30}},"loc":{"start":{"line":35,"column":36},"end":{"line":63,"column":17}},"line":35},"6":{"name":"(anonymous_6)","decl":{"start":{"line":68,"column":4},"end":{"line":68,"column":5}},"loc":{"start":{"line":68,"column":30},"end":{"line":70,"column":5}},"line":68},"7":{"name":"(anonymous_7)","decl":{"start":{"line":71,"column":4},"end":{"line":71,"column":5}},"loc":{"start":{"line":71,"column":21},"end":{"line":82,"column":5}},"line":71},"8":{"name":"(anonymous_8)","decl":{"start":{"line":74,"column":17},"end":{"line":74,"column":18}},"loc":{"start":{"line":74,"column":22},"end":{"line":80,"column":9}},"line":74},"9":{"name":"(anonymous_9)","decl":{"start":{"line":78,"column":55},"end":{"line":78,"column":56}},"loc":{"start":{"line":78,"column":61},"end":{"line":78,"column":88}},"line":78},"10":{"name":"(anonymous_10)","decl":{"start":{"line":78,"column":97},"end":{"line":78,"column":98}},"loc":{"start":{"line":78,"column":107},"end":{"line":78,"column":113}},"line":78},"11":{"name":"(anonymous_11)","decl":{"start":{"line":81,"column":20},"end":{"line":81,"column":21}},"loc":{"start":{"line":81,"column":25},"end":{"line":81,"column":48}},"line":81},"12":{"name":"(anonymous_12)","decl":{"start":{"line":83,"column":4},"end":{"line":83,"column":5}},"loc":{"start":{"line":83,"column":15},"end":{"line":85,"column":5}},"line":83},"13":{"name":"(anonymous_13)","decl":{"start":{"line":86,"column":4},"end":{"line":86,"column":5}},"loc":{"start":{"line":86,"column":32},"end":{"line":102,"column":5}},"line":86},"14":{"name":"(anonymous_14)","decl":{"start":{"line":103,"column":4},"end":{"line":103,"column":5}},"loc":{"start":{"line":103,"column":33},"end":{"line":113,"column":5}},"line":103}},"branchMap":{"0":{"loc":{"start":{"line":6,"column":4},"end":{"line":20,"column":5}},"type":"if","locations":[{"start":{"line":6,"column":4},"end":{"line":20,"column":5}},{"start":{"line":9,"column":9},"end":{"line":20,"column":5}}],"line":6},"1":{"loc":{"start":{"line":10,"column":8},"end":{"line":19,"column":9}},"type":"switch","locations":[{"start":{"line":11,"column":12},"end":{"line":12,"column":33}},{"start":{"line":13,"column":12},"end":{"line":14,"column":35}},{"start":{"line":15,"column":12},"end":{"line":16,"column":40}},{"start":{"line":17,"column":12},"end":{"line":18,"column":36}}],"line":10},"2":{"loc":{"start":{"line":29,"column":16},"end":{"line":29,"column":35}},"type":"default-arg","locations":[{"start":{"line":29,"column":31},"end":{"line":29,"column":35}}],"line":29},"3":{"loc":{"start":{"line":29,"column":37},"end":{"line":29,"column":61}},"type":"default-arg","locations":[{"start":{"line":29,"column":57},"end":{"line":29,"column":61}}],"line":29},"4":{"loc":{"start":{"line":29,"column":63},"end":{"line":29,"column":80}},"type":"default-arg","locations":[{"start":{"line":29,"column":75},"end":{"line":29,"column":80}}],"line":29},"5":{"loc":{"start":{"line":34,"column":35},"end":{"line":34,"column":131}},"type":"binary-expr","locations":[{"start":{"line":34,"column":35},"end":{"line":34,"column":79}},{"start":{"line":34,"column":83},"end":{"line":34,"column":131}}],"line":34},"6":{"loc":{"start":{"line":41,"column":20},"end":{"line":62,"column":21}},"type":"if","locations":[{"start":{"line":41,"column":20},"end":{"line":62,"column":21}},{"start":{"line":59,"column":25},"end":{"line":62,"column":21}}],"line":41},"7":{"loc":{"start":{"line":43,"column":24},"end":{"line":57,"column":25}},"type":"if","locations":[{"start":{"line":43,"column":24},"end":{"line":57,"column":25}},{"start":{"line":47,"column":29},"end":{"line":57,"column":25}}],"line":43},"8":{"loc":{"start":{"line":43,"column":28},"end":{"line":43,"column":121}},"type":"binary-expr","locations":[{"start":{"line":43,"column":28},"end":{"line":43,"column":70}},{"start":{"line":43,"column":74},"end":{"line":43,"column":121}}],"line":43},"9":{"loc":{"start":{"line":47,"column":29},"end":{"line":57,"column":25}},"type":"if","locations":[{"start":{"line":47,"column":29},"end":{"line":57,"column":25}},{"start":{"line":51,"column":29},"end":{"line":57,"column":25}}],"line":47},"10":{"loc":{"start":{"line":47,"column":33},"end":{"line":47,"column":126}},"type":"binary-expr","locations":[{"start":{"line":47,"column":33},"end":{"line":47,"column":75}},{"start":{"line":47,"column":79},"end":{"line":47,"column":126}}],"line":47},"11":{"loc":{"start":{"line":51,"column":29},"end":{"line":57,"column":25}},"type":"if","locations":[{"start":{"line":51,"column":29},"end":{"line":57,"column":25}},{"start":{"line":55,"column":29},"end":{"line":57,"column":25}}],"line":51},"12":{"loc":{"start":{"line":51,"column":33},"end":{"line":51,"column":122}},"type":"binary-expr","locations":[{"start":{"line":51,"column":33},"end":{"line":51,"column":67}},{"start":{"line":51,"column":71},"end":{"line":51,"column":122}}],"line":51},"13":{"loc":{"start":{"line":78,"column":107},"end":{"line":78,"column":113}},"type":"binary-expr","locations":[{"start":{"line":78,"column":107},"end":{"line":78,"column":108}},{"start":{"line":78,"column":112},"end":{"line":78,"column":113}}],"line":78},"14":{"loc":{"start":{"line":87,"column":8},"end":{"line":89,"column":9}},"type":"if","locations":[{"start":{"line":87,"column":8},"end":{"line":89,"column":9}},{"start":{},"end":{}}],"line":87},"15":{"loc":{"start":{"line":90,"column":8},"end":{"line":95,"column":9}},"type":"if","locations":[{"start":{"line":90,"column":8},"end":{"line":95,"column":9}},{"start":{},"end":{}}],"line":90},"16":{"loc":{"start":{"line":92,"column":12},"end":{"line":94,"column":13}},"type":"if","locations":[{"start":{"line":92,"column":12},"end":{"line":94,"column":13}},{"start":{},"end":{}}],"line":92},"17":{"loc":{"start":{"line":96,"column":8},"end":{"line":101,"column":9}},"type":"if","locations":[{"start":{"line":96,"column":8},"end":{"line":101,"column":9}},{"start":{},"end":{}}],"line":96},"18":{"loc":{"start":{"line":98,"column":12},"end":{"line":100,"column":13}},"type":"if","locations":[{"start":{"line":98,"column":12},"end":{"line":100,"column":13}},{"start":{},"end":{}}],"line":98}},"s":{"0":1,"1":1,"2":1,"3":2,"4":0,"5":2,"6":0,"7":1,"8":0,"9":1,"10":3,"11":3,"12":3,"13":30,"14":30,"15":30,"16":30,"17":27,"18":27,"19":27,"20":27,"21":27,"22":24,"23":24,"24":0,"25":0,"26":24,"27":1,"28":1,"29":23,"30":1,"31":1,"32":3,"33":2,"34":2,"35":2,"36":2,"37":0,"38":2,"39":3,"40":9,"41":3,"42":9,"43":5,"44":5,"45":5,"46":9,"47":1,"48":1,"49":1,"50":27,"51":27,"52":1},"f":{"0":2,"1":3,"2":30,"3":30,"4":30,"5":27,"6":0,"7":2,"8":2,"9":2,"10":0,"11":2,"12":3,"13":9,"14":27},"b":{"0":[0,2],"1":[0,1,0,1],"2":[0],"3":[0],"4":[0],"5":[30,8],"6":[24,3],"7":[0,24],"8":[24,18],"9":[1,23],"10":[24,6],"11":[1,22],"12":[23,1],"13":[0,0],"14":[3,6],"15":[5,4],"16":[5,0],"17":[1,8],"18":[1,0]},"inputSourceMap":{"version":3,"file":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/HeartbeatHandler.ts","sources":["/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/handlers/HeartbeatHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { MessageHandler } from '../BasicFDC3Server';\nimport { AppRegistration, InstanceID, ServerContext, State } from '../ServerContext';\nimport {\n  AppRequestMessage,\n  HeartbeatEvent,\n  WebConnectionProtocol6Goodbye,\n} from '@finos/fdc3-schema/dist/generated/api/BrowserTypes';\nimport { FullAppIdentifier } from './support';\n\ntype HeartbeatDetails = {\n  instanceId: string;\n  time: number;\n  state: string;\n};\n\nfunction convertToText(s?: State): string {\n  if (s == undefined) {\n    return 'Unknown';\n  } else {\n    switch (s) {\n      case State.Pending:\n        return 'Pending';\n      case State.Connected:\n        return 'Connected';\n      case State.NotResponding:\n        return 'Not Responding';\n      case State.Terminated:\n        return 'Terminated';\n    }\n  }\n}\n\n/*\n * Handles heartbeat pings and responses\n */\nexport class HeartbeatHandler implements MessageHandler {\n  private readonly contexts: ServerContext<AppRegistration>[] = [];\n  private readonly lastHeartbeats: Map<InstanceID, number> = new Map();\n  private readonly timerFunction: NodeJS.Timeout;\n\n  constructor(pingInterval: number = 1000, disconnectedAfter: number = 5000, deadAfter: number = 20000) {\n    this.timerFunction = setInterval(() => {\n      this.contexts.forEach(async sc => {\n        const apps = await sc.getAllApps();\n        apps\n          .filter(app => app.state == State.Connected || app.state == State.NotResponding)\n          .forEach(app => {\n            const now = new Date().getTime();\n            this.sendHeartbeat(sc, app);\n\n            // check when the last heartbeat happened\n            const lastHeartbeat = this.lastHeartbeats.get(app.instanceId);\n            const currentState = app.state;\n\n            if (lastHeartbeat != undefined) {\n              const timeSinceLastHeartbeat = now - lastHeartbeat;\n\n              if (timeSinceLastHeartbeat < disconnectedAfter && currentState != State.Connected) {\n                console.error(\n                  `Heartbeat from ${app.instanceId} for ${timeSinceLastHeartbeat}ms. App is considered connected.`\n                );\n                sc.setAppState(app.instanceId, State.Connected);\n              } else if (timeSinceLastHeartbeat > disconnectedAfter && currentState == State.Connected) {\n                console.error(\n                  `No heartbeat from ${app.instanceId} for ${timeSinceLastHeartbeat}ms. App is considered not responding.`\n                );\n                sc.setAppState(app.instanceId, State.NotResponding);\n              } else if (timeSinceLastHeartbeat > deadAfter && currentState == State.NotResponding) {\n                console.error(\n                  `No heartbeat from ${app.instanceId} for ${timeSinceLastHeartbeat}ms. App is considered terminated.`\n                );\n                sc.setAppState(app.instanceId, State.Terminated);\n              } else {\n                // no action\n              }\n            } else {\n              // start the clock\n              this.lastHeartbeats.set(app.instanceId, now);\n            }\n          });\n      });\n    }, pingInterval);\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  cleanup(_instanceId: InstanceID, _sc: ServerContext<AppRegistration>): void {\n    //TODO: Consider whether to clean-up last heartbeat times\n  }\n\n  heartbeatTimes(): HeartbeatDetails[] {\n    const now = new Date().getTime();\n    return Array.from(this.lastHeartbeats)\n      .map(e => {\n        return {\n          instanceId: e[0],\n          time: now - e[1],\n          state: convertToText(this.contexts.map(sc => sc.getInstanceDetails(e[0])).reduce((a, b) => a || b)?.state),\n        } as HeartbeatDetails;\n      })\n      .filter(e => e.state != 'Terminated');\n  }\n\n  shutdown(): void {\n    clearInterval(this.timerFunction);\n  }\n\n  async accept(\n    msg: AppRequestMessage | WebConnectionProtocol6Goodbye,\n    sc: ServerContext<AppRegistration>,\n    from: InstanceID\n  ): Promise<void> {\n    if (!this.contexts.includes(sc)) {\n      this.contexts.push(sc);\n    }\n\n    if (msg.type == 'heartbeatAcknowledgementRequest') {\n      const app = sc.getInstanceDetails(from);\n      if (app) {\n        this.lastHeartbeats.set(app.instanceId, new Date().getTime());\n      }\n    }\n\n    if (msg.type == 'WCP6Goodbye') {\n      const app = sc.getInstanceDetails(from);\n      if (app) {\n        sc.setAppState(from, State.Terminated);\n      }\n    }\n  }\n\n  async sendHeartbeat(sc: ServerContext<AppRegistration>, app: FullAppIdentifier): Promise<void> {\n    const event: HeartbeatEvent = {\n      type: 'heartbeatEvent',\n      meta: {\n        timestamp: new Date(),\n        eventUuid: sc.createUUID(),\n      },\n      payload: {},\n    };\n    sc.post(event, app.instanceId);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"0ce02ab15562b2abbcf7e27acabbf1964948b42b","contentHash":"8d9c16888f229d6aa88152569ca6653b7b89f4af1bbcc76c0305440296bdfacb"},"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/directory/BasicDirectory.ts":{"path":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/directory/BasicDirectory.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":64}},"2":{"start":{"line":5,"column":4},"end":{"line":19,"column":5}},"3":{"start":{"line":6,"column":8},"end":{"line":6,"column":20}},"4":{"start":{"line":8,"column":9},"end":{"line":19,"column":5}},"5":{"start":{"line":9,"column":8},"end":{"line":9,"column":20}},"6":{"start":{"line":11,"column":9},"end":{"line":19,"column":5}},"7":{"start":{"line":12,"column":8},"end":{"line":12,"column":21}},"8":{"start":{"line":14,"column":9},"end":{"line":19,"column":5}},"9":{"start":{"line":15,"column":8},"end":{"line":15,"column":20}},"10":{"start":{"line":18,"column":8},"end":{"line":18,"column":21}},"11":{"start":{"line":21,"column":0},"end":{"line":21,"column":54}},"12":{"start":{"line":28,"column":8},"end":{"line":28,"column":28}},"13":{"start":{"line":31,"column":20},"end":{"line":33,"column":59}},"14":{"start":{"line":34,"column":8},"end":{"line":34,"column":19}},"15":{"start":{"line":37,"column":19},"end":{"line":37,"column":55}},"16":{"start":{"line":38,"column":20},"end":{"line":38,"column":38}},"17":{"start":{"line":39,"column":28},"end":{"line":45,"column":10}},"18":{"start":{"line":40,"column":12},"end":{"line":44,"column":14}},"19":{"start":{"line":46,"column":8},"end":{"line":46,"column":27}},"20":{"start":{"line":49,"column":27},"end":{"line":49,"column":93}},"21":{"start":{"line":49,"column":63},"end":{"line":49,"column":92}},"22":{"start":{"line":50,"column":8},"end":{"line":50,"column":26}},"23":{"start":{"line":53,"column":32},"end":{"line":53,"column":129}},"24":{"start":{"line":53,"column":70},"end":{"line":53,"column":128}},"25":{"start":{"line":54,"column":8},"end":{"line":54,"column":31}},"26":{"start":{"line":57,"column":23},"end":{"line":57,"column":171}},"27":{"start":{"line":57,"column":58},"end":{"line":57,"column":170}},"28":{"start":{"line":57,"column":100},"end":{"line":57,"column":158}},"29":{"start":{"line":58,"column":8},"end":{"line":58,"column":22}},"30":{"start":{"line":61,"column":8},"end":{"line":61,"column":68}},"31":{"start":{"line":61,"column":50},"end":{"line":61,"column":66}},"32":{"start":{"line":64,"column":8},"end":{"line":64,"column":28}},"33":{"start":{"line":67,"column":0},"end":{"line":67,"column":40}}},"fnMap":{"0":{"name":"genericResultTypeSame","decl":{"start":{"line":4,"column":9},"end":{"line":4,"column":30}},"loc":{"start":{"line":4,"column":47},"end":{"line":20,"column":1}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":27,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":27,"column":22},"end":{"line":29,"column":5}},"line":27},"2":{"name":"(anonymous_2)","decl":{"start":{"line":30,"column":4},"end":{"line":30,"column":5}},"loc":{"start":{"line":30,"column":58},"end":{"line":35,"column":5}},"line":30},"3":{"name":"(anonymous_3)","decl":{"start":{"line":36,"column":4},"end":{"line":36,"column":5}},"loc":{"start":{"line":36,"column":29},"end":{"line":47,"column":5}},"line":36},"4":{"name":"(anonymous_4)","decl":{"start":{"line":39,"column":36},"end":{"line":39,"column":37}},"loc":{"start":{"line":39,"column":54},"end":{"line":45,"column":9}},"line":39},"5":{"name":"(anonymous_5)","decl":{"start":{"line":48,"column":4},"end":{"line":48,"column":5}},"loc":{"start":{"line":48,"column":25},"end":{"line":51,"column":5}},"line":48},"6":{"name":"(anonymous_6)","decl":{"start":{"line":49,"column":58},"end":{"line":49,"column":59}},"loc":{"start":{"line":49,"column":63},"end":{"line":49,"column":92}},"line":49},"7":{"name":"(anonymous_7)","decl":{"start":{"line":52,"column":4},"end":{"line":52,"column":5}},"loc":{"start":{"line":52,"column":57},"end":{"line":55,"column":5}},"line":52},"8":{"name":"(anonymous_8)","decl":{"start":{"line":53,"column":65},"end":{"line":53,"column":66}},"loc":{"start":{"line":53,"column":70},"end":{"line":53,"column":128}},"line":53},"9":{"name":"(anonymous_9)","decl":{"start":{"line":56,"column":4},"end":{"line":56,"column":5}},"loc":{"start":{"line":56,"column":54},"end":{"line":59,"column":5}},"line":56},"10":{"name":"(anonymous_10)","decl":{"start":{"line":57,"column":53},"end":{"line":57,"column":54}},"loc":{"start":{"line":57,"column":58},"end":{"line":57,"column":170}},"line":57},"11":{"name":"(anonymous_11)","decl":{"start":{"line":57,"column":95},"end":{"line":57,"column":96}},"loc":{"start":{"line":57,"column":100},"end":{"line":57,"column":158}},"line":57},"12":{"name":"(anonymous_12)","decl":{"start":{"line":60,"column":4},"end":{"line":60,"column":5}},"loc":{"start":{"line":60,"column":28},"end":{"line":62,"column":5}},"line":60},"13":{"name":"(anonymous_13)","decl":{"start":{"line":61,"column":45},"end":{"line":61,"column":46}},"loc":{"start":{"line":61,"column":50},"end":{"line":61,"column":66}},"line":61},"14":{"name":"(anonymous_14)","decl":{"start":{"line":63,"column":4},"end":{"line":63,"column":5}},"loc":{"start":{"line":63,"column":22},"end":{"line":65,"column":5}},"line":63}},"branchMap":{"0":{"loc":{"start":{"line":5,"column":4},"end":{"line":19,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":19,"column":5}},{"start":{"line":8,"column":9},"end":{"line":19,"column":5}}],"line":5},"1":{"loc":{"start":{"line":8,"column":9},"end":{"line":19,"column":5}},"type":"if","locations":[{"start":{"line":8,"column":9},"end":{"line":19,"column":5}},{"start":{"line":11,"column":9},"end":{"line":19,"column":5}}],"line":8},"2":{"loc":{"start":{"line":11,"column":9},"end":{"line":19,"column":5}},"type":"if","locations":[{"start":{"line":11,"column":9},"end":{"line":19,"column":5}},{"start":{"line":14,"column":9},"end":{"line":19,"column":5}}],"line":11},"3":{"loc":{"start":{"line":14,"column":9},"end":{"line":19,"column":5}},"type":"if","locations":[{"start":{"line":14,"column":9},"end":{"line":19,"column":5}},{"start":{"line":17,"column":9},"end":{"line":19,"column":5}}],"line":14},"4":{"loc":{"start":{"line":14,"column":13},"end":{"line":14,"column":65}},"type":"binary-expr","locations":[{"start":{"line":14,"column":13},"end":{"line":14,"column":40}},{"start":{"line":14,"column":44},"end":{"line":14,"column":65}}],"line":14},"5":{"loc":{"start":{"line":31,"column":20},"end":{"line":33,"column":59}},"type":"binary-expr","locations":[{"start":{"line":31,"column":21},"end":{"line":31,"column":44}},{"start":{"line":31,"column":48},"end":{"line":31,"column":74}},{"start":{"line":32,"column":13},"end":{"line":32,"column":37}},{"start":{"line":32,"column":41},"end":{"line":32,"column":81}},{"start":{"line":33,"column":12},"end":{"line":33,"column":59}}],"line":31},"6":{"loc":{"start":{"line":32,"column":42},"end":{"line":32,"column":58}},"type":"binary-expr","locations":[{"start":{"line":32,"column":42},"end":{"line":32,"column":52}},{"start":{"line":32,"column":56},"end":{"line":32,"column":58}}],"line":32},"7":{"loc":{"start":{"line":37,"column":19},"end":{"line":37,"column":55}},"type":"binary-expr","locations":[{"start":{"line":37,"column":19},"end":{"line":37,"column":49}},{"start":{"line":37,"column":53},"end":{"line":37,"column":55}}],"line":37}},"s":{"0":1,"1":1,"2":68,"3":60,"4":8,"5":2,"6":6,"7":0,"8":6,"9":2,"10":4,"11":1,"12":176,"13":270,"14":270,"15":174,"16":174,"17":174,"18":270,"19":174,"20":36,"21":130,"22":36,"23":36,"24":193,"25":36,"26":11,"27":44,"28":77,"29":11,"30":28,"31":80,"32":75,"33":1},"f":{"0":68,"1":176,"2":270,"3":174,"4":270,"5":36,"6":130,"7":36,"8":193,"9":11,"10":44,"11":77,"12":28,"13":80,"14":75},"b":{"0":[60,8],"1":[2,6],"2":[0,6],"3":[2,4],"4":[6,2],"5":[270,217,97,89,68],"6":[89,0],"7":[174,0]},"inputSourceMap":{"version":3,"file":"/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/directory/BasicDirectory.ts","sources":["/Users/rob/Documents/finos/fdc3-general/FDC3/toolbox/fdc3-for-web/fdc3-web-impl/src/directory/BasicDirectory.ts"],"names":[],"mappings":"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","sourcesContent":["import { Directory, DirectoryApp, DirectoryIntent } from './DirectoryInterface';\n\nexport function genericResultTypeSame(real: string | undefined, required: string | undefined) {\n  if (required == undefined) {\n    return true;\n  } else if (real == required) {\n    return true;\n  } else if (real == undefined) {\n    return false; // required is not undefined, so asking for something\n  } else if (real.startsWith('channel<') && required == 'channel') {\n    return true;\n  } else {\n    return false;\n  }\n}\n\n/**\n * Basic directory implementation that allows queries over a set of apps.\n */\nexport class BasicDirectory implements Directory {\n  allApps: DirectoryApp[];\n\n  constructor(apps: DirectoryApp[]) {\n    this.allApps = apps;\n  }\n\n  private intentMatches(\n    i: DirectoryIntent,\n    contextType: string | undefined,\n    intentName: string | undefined,\n    resultType: string | undefined\n  ): boolean {\n    const out =\n      (intentName == undefined || i.intentName == intentName) &&\n      (contextType == undefined || (i.contexts ?? []).includes(contextType)) &&\n      genericResultTypeSame(i.resultType, resultType);\n    return out;\n  }\n\n  private retrieveIntentsForApp(a: DirectoryApp): DirectoryIntent[] {\n    const lf = a.interop?.intents?.listensFor ?? {};\n    const lfa = Object.entries(lf);\n    const lfAugmented = lfa.map(([key, value]) => {\n      return {\n        intentName: key,\n        ...value,\n        appId: a.appId,\n      };\n    });\n    return lfAugmented;\n  }\n\n  retrieveAllIntents(): DirectoryIntent[] {\n    const allIntents = this.retrieveAllApps().flatMap(a => this.retrieveIntentsForApp(a));\n\n    return allIntents;\n  }\n\n  retrieveIntents(\n    contextType: string | undefined,\n    intentName: string | undefined,\n    resultType: string | undefined\n  ): DirectoryIntent[] {\n    const matchingIntents = this.retrieveAllIntents().filter(i =>\n      this.intentMatches(i, contextType, intentName, resultType)\n    );\n    return matchingIntents;\n  }\n\n  retrieveApps(\n    contextType: string | undefined,\n    intentName?: string | undefined,\n    resultType?: string | undefined\n  ): DirectoryApp[] {\n    const result = this.retrieveAllApps().filter(\n      a =>\n        this.retrieveIntentsForApp(a).filter(i => this.intentMatches(i, contextType, intentName, resultType)).length > 0\n    );\n\n    return result;\n  }\n\n  retrieveAppsById(appId: string): DirectoryApp[] {\n    return this.retrieveAllApps().filter(a => a.appId == appId);\n  }\n\n  retrieveAllApps(): DirectoryApp[] {\n    return this.allApps;\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7377b013c8305a0a0588bf70e599eacdd53b3bcb","contentHash":"5a34f9c330a7de347f850f39f34d91eff087b488f5264a961cccb1a0fc702a6d"}}